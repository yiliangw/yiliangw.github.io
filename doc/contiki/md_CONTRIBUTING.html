<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Contiki 3.0: Code Contributions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Contiki 3.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Code Contributions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Do you have a new cool feature that you'd like to contribute to Contiki? Or a fix for a bug? Great! The Contiki project loves code contributions, improvements, and bugfixes, but we require that they follow a set of guidelines and that they are contributed in a specific way.</p>
<p>Additional rules apply for contributions of a new hardware platform.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
General Advice</h1>
<p>The chance of getting your pull request accepted increases considerably if you adhere to the following rules in addition to the aforementioned formatting and naming standards:</p>
<ul>
<li>Ensure that all contributed files have a valid copyright statement and an open-source license.</li>
<li>Do not bundle commits that are unrelated to each other &ndash; create separate pull requests instead.</li>
<li>Adhere to ISO C99 in all C language source files. Exceptions are allowed for those platform-dependent source files that rely on the extensions of a specific set of compilers.</li>
<li>Clean up the commit history. "git rebase -i" is useful for this purpose.</li>
<li>Do not include executable binary files, because they are usually rejected for security reasons. Instead, provide instructions for how to compile the file, so that a trusted member of the merge team can commit it.</li>
<li>Write a descriptive pull request message. Explain the advantages and disadvantages of your proposed changes.</li>
<li>Before starting to work on a major contribution, discuss your idea with experienced Contiki programmers (e.g., on the contiki-developers mailing list) to avoid wasting time on things that have no chance of getting merged into Contiki.</li>
</ul>
<p>Source code that goes into the mainline Contiki repository must be of interest to a large part of the Contiki community. It must be well-tested and the merge team must have confidence that the code can be maintained over a longer period. See below for more details pertaining to platform contributions.</p>
<p>Contributions that have been made in research projects, and typically do not get maintained thereafter, are better suited for inclusion in the Contiki projects repository.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Structuring Commits</h1>
<ul>
<li>Write descriptive commit messages. They don't have to be very long, but you should mention what the commit achieves. Commit messages like "modified foo/bar.c" are not helpful, should not be used, and are likely to result in you having to re-write them.</li>
<li>Please do not add / remove irrelevant new line markers. Don't remove the new line marker at the EOF.</li>
<li>Please, make sure that your patch doesn't add lines with trailing whitespaces. If you run uncrustify as discussed above, this should get taken care of for you automatically.</li>
<li>More generally speaking, make sure that each commit in your history only includes changes necessary to implement whatever it is the commit is trying to achieve. All changes should be mentioned in the commit message.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Code Formatting</h1>
<p>We require that all code contributed to the Contiki tree follows the same code formatting as the existing Contiki code. We are very strict on this.</p>
<p>Code must be formatted according to <a href="https://github.com/contiki-os/contiki/blob/master/doc/code-style.c">contiki/doc/code-style.c</a>.</p>
<p>The Contiki source tree contains scripts to assist with correct code formatting and we recommend <a href="http://uncrustify.sourceforge.net/">Uncrustify</a> as the preferred auto formatter. Everything is under <a href="https://github.com/contiki-os/contiki/tree/master/tools/code-style">tools/code-style</a>.</p>
<p>If you wish, you can format all changed resources in your working tree automatically if the <a href="https://github.com/contiki-os/contiki/blob/master/tools/code-style/uncrustify-changed.sh">tools/code-style/uncrustify-changed.sh</a> script is added as a <a href="http://git-scm.com/book/en/Customizing-Git-Git-Hooks">Git pre-commit hook</a> to your Git configuration.</p>
<p>Here are some examples of what you can do:</p><ul>
<li>To check a file's style without changing the file on disk, you can run this: <code>./tools/code-style/uncrustify-check-style.sh &lt;path-to-file&gt;</code> This script will only accept a single file as its argument.</li>
<li>To auto format a file (and change it on disk) you can run this: <code>./tools/code-style/uncrustify-fix-style.sh &lt;path-to-file&gt;</code></li>
<li><code>uncrustify-fix-style.sh</code> will accept a space-delimited list of files as its argument. Thus, you can auto-format an entire directory by running something like this: <code>./tools/code-style/uncrustify-fix-style.sh `find cpu/cc2538 -type f -name "*.[ch]"`</code></li>
</ul>
<p>This is <em>not</em> a silver bullet and developer intervention is still required. Below are some examples of code which will get misformatted by uncrustify:</p><ul>
<li>Math symbol following a cast to a typedef <div class="fragment"><div class="line">a = (uint8_t) ~P0_1; /* Cast to a typedef. Space gets added here (incorrect) */</div>
<div class="line">a = (int)~P0_1;      /* Cast to a known type. Space gets removed (correct) */</div>
<div class="line">a = (uint8_t)P0_1;   /* Variable directly after the cast. Space gets removed (correct) */</div>
</div><!-- fragment --></li>
<li><code>while(&lt;condition&gt;);</code> will become <code>while(&lt;condition&gt;) ;</code> (space incorrectly added after closing paren)</li>
<li>﻿﻿<code>asm("wfi");</code> becomes <code>asm ("wfi");</code>: A space gets added before the opening paren, because the <code>asm</code> keyword stops this from getting interpreted as a normal function call / macro invocation. This is only a problem with <code>asm</code>. For instance, ﻿﻿<code>foo("bar");</code> gets formatted correctly.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Naming</h1>
<p>We require that all code contributed to the Contiki tree follow the Contiki source code naming standard:</p>
<ul>
<li>File names are composed of lower-case characters and dashes. Like this: simple-udp.c</li>
<li>Variable and function names are composed of lower-case characters and underscores. Like this: simple_udp_send();</li>
<li>Variable and function names that are visible outside of their module must begin with the name of the module. Like this: simple_udp_send(), which is in the simple-udp module, declared in simple-udp.h, and implemented in simple-udp.c.</li>
<li>C macros are composed of upper-case characters and underscores. Like this: PROCESS_THREAD().</li>
<li>Configuration definitions begin with the module name and CONF_. Like this: PROCESS_CONF_NUMEVENTS.</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
How to Contribute Code</h1>
<p>When your code is formatted according to the Contiki code style and follows the Contiki naming standard, it is time to send it to the Contiki maintainers to look at!</p>
<p>All code contributions to Contiki are submitted as <a href="https://help.github.com/articles/using-pull-requests">Github pull requests</a>. Pull requests will be reviewed and accepted according to the guidelines found in the [[Pull Request Policy]]</p>
<p>The basic guidelines to to start a Pull-Request:</p><ul>
<li>Create a new branch for your modifications. This branch should be based on the latest contiki master branch.</li>
<li>If you already added the commits to another branch you can <a href="http://git-scm.com/docs/git-cherry-pick">cherry-pick</a> them onto your new branch.</li>
<li>Push the new branch to github.</li>
<li>Raise the new Pull Requests on this new branch. Raising a Pull Request for the master branch is almost always a bad idea.</li>
<li>If changes are requested do not close the pull request but rewrite your history. <a href="http://git-scm.com/book/en/Git-Tools-Rewriting-History">Details about rewriting your history</a></li>
<li>You now force-push the changes to github. The pull-request is automatically updated.</li>
</ul>
<p>In Git terminology this is equivalent to:</p><ul>
<li>Make sure you have the original contiki repo as origin. <div class="fragment"><div class="line">$ git remote -v</div>
<div class="line">contiki-orig     https://github.com/contiki-os/contiki.git</div>
</div><!-- fragment --></li>
<li>If not add it <div class="fragment"><div class="line">$ git remote add contiki-orig https://github.com/contiki-os/contiki.git</div>
</div><!-- fragment --></li>
<li>Make sure you have the latest version of your remotes <div class="fragment"><div class="line">$ git remote update</div>
</div><!-- fragment --></li>
<li>Create a new branch "my_new_feature" based on the latest contiki master branch <div class="fragment"><div class="line">$ git checkout contiki-orig/master -b my_new_feature</div>
</div><!-- fragment --></li>
<li>Add your work. For example by cherry-picking your changes from another branch. <div class="fragment"><div class="line">$ git cherry-pick &lt;HASH OF COMMIT&gt;</div>
</div><!-- fragment --></li>
<li>Push to <em>your</em> github repository <div class="fragment"><div class="line">$ git push origin my_new_feature</div>
</div><!-- fragment --></li>
<li>Make a Pull Request for that branch</li>
<li>Rewrite your history if requested <div class="fragment"><div class="line">$ git rebase -i contiki-orig/master</div>
</div><!-- fragment --></li>
<li>As rewriting your history can break things you must force-push the changes. <b>Warning</b>: Force-pushing normally is dangerous and you might break things. Make sure you are never force-pushing branches other people are supposed to work with. <div class="fragment"><div class="line">$ git push origin my_new_feature -f</div>
</div><!-- fragment --></li>
<li>NOTE: To avoid all the pain of selectively picking commits, rebasing and force-pushing - begin your development with a branch OTHER THAN your master branch, and push changes to that branch after any local commits.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Travis / Regression testing</h1>
<p><a href="https://travis-ci.org/">Travis</a> is a service that runs regression tests. If you make a pull-request for Contiki this is automatically forwarded to Travis and regression tests are run. A box with information about the state of you pull request should show up after a minute or two.</p>
<p>If the test fails it is likely that something is wrong with your code. Please look carefully at the log. It might also be that some package on the testing VM was updated and causes the build to fail. If you are sure that is is not your code causing the tests to fail start a new issue describing the problem. Also note this in your pull request.</p>
<p>You can also register at <a href="https://travis-ci.org/">Travis</a> for free. Once you activated your Contiki repository, every push will be tested at Travis. The configuration is part of the contiki repository and testing will therefore work out-of-the-box. At Travis you then get an overview of the state of each of your branches.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
New Platforms</h1>
<p>A new hardware port will be considered for inclusion in mainline Contiki if it satisfies the following rules:</p>
<ul>
<li>There must be at least one person willing and committed to maintain it. They may but do not have to be the people who wrote the code. Similarly, they may but do not have to be affiliated with the hardware manufacturer. In the first instance, code maintenance would mean keeping the port up to speed by submitting pull requests as Contiki moves forward. In the longer term, people who maintain a reasonable level of commitment and who demonstrate that they know what they're doing may be invited to become repo collaborators.</li>
<li>The hardware must be commercially available and of interest to a wide audience. In other words, ports for bespoke hardware built for e.g. a specific project / a single customer / niche markets are more suitable for a Contiki fork.</li>
<li>The code must strictly adhere to the Contiki code style, as discussed above.</li>
<li>The new files must have a clear copyright notice and license header. Contiki's preferred software license is the <a href="http://opensource.org/licenses/BSD-3-Clause">3-clause BSD</a>. Other licenses may also be considered as long as they are compatible with the 3-clause BSD (e.g. the Apache 2.0 license). Conversely, code distributed under GPL cannot be considered. The same applies to bespoke licenses, such as those allowing use or redistribution only together with certain kinds of hardware.</li>
<li>The port must demonstrate a certain degree of completeness and maturity. Common sense applies here.</li>
<li>The port must be accompanied by examples demonstrating basic functionality. This could be a set of examples under <code>examples/&lt;new-hardware-port&gt;</code> and/or documentation of which existing examples are meant to work.</li>
<li>The port must provide compile regression tests by extending the existing travis integration testing framework. Again, we can't specify explicitly what those tests should be, but something more interesting than hello-world is expected.</li>
<li>The work must be documented. The documentation could be README.md files under the platform / cpu / example dirs or wiki pages. Doxygen comments are also encouraged. The documentation should include:<ul>
<li>A getting started guide, including a list of tools required to use the platform (e.g. toolchain, software to program the device), where to get them from and brief notes how to install them (can simply be a list of links to external guides)</li>
<li>A list of things which will work off the shelf</li>
<li>A list of things which are not meant to work, if any</li>
<li>Additional reading resources (e.g. datasheets, hardware user guides, web resources)</li>
<li>A ToDo list, if applicable.</li>
</ul>
</li>
<li>It must be possible to use the port using free software. We do not discourage the use of commercial software (e.g. support for a commercial toolchain), quite the opposite. However, we will insist on the existence of a free alternative for everything.</li>
</ul>
<p>After the port has been accepted, things meant to work off the shelf should keep working off the shelf as Contiki moves forward.</p>
<p>We appreciate that, for many people, contributing to Contiki is a spare time activity and our expectations from port maintainers take this into consideration. All we ask from maintainers is to comment on and address relevant pull requests at a reasonable frequency and to make sure travis keeps passing. In other words, we just want platforms to stay healthy over time and to thus avoid becoming very broken / obsolete. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
