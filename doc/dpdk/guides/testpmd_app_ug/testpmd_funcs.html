
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4. Testpmd Runtime Functions &#8212; Data Plane Development Kit 23.11.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Network Interface Controller Drivers" href="../nics/index.html" />
    <link rel="prev" title="3. Running the Application" href="run_app.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="testpmd-runtime-functions">
<span id="testpmd-runtime"></span><h1><span class="section-number">4. </span>Testpmd Runtime Functions</h1>
<p>Where the testpmd application is started in interactive mode, (<code class="docutils literal notranslate"><span class="pre">-i|--interactive</span></code>),
it displays a prompt that can be used to start and stop forwarding,
configure the application, display statistics (including the extended NIC
statistics aka xstats) , set the Flow Director and other tasks:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt;
</pre></div>
</div>
<p>The testpmd prompt has some, limited, readline support.
Common bash command-line functions such as <code class="docutils literal notranslate"><span class="pre">Ctrl+a</span></code> and <code class="docutils literal notranslate"><span class="pre">Ctrl+e</span></code> to go to the start and end of the prompt line are supported
as well as access to the command history via the up-arrow.</p>
<p>There is also support for tab completion.
If you type a partial command and hit <code class="docutils literal notranslate"><span class="pre">&lt;TAB&gt;</span></code> you get a list of the available completions:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show port &lt;TAB&gt;</span>

<span class="go">    info [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|dcb_tc|cap X</span>
<span class="go">    info [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|dcb_tc|cap all</span>
<span class="go">    stats [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|dcb_tc|cap X</span>
<span class="go">    stats [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|dcb_tc|cap all</span>
<span class="go">    ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some examples in this document are too long to fit on one line are shown wrapped at <cite>“\”</cite> for display purposes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set flow_ctrl rx (on|off) tx (on|off) (high_water) (low_water) \
         (pause_time) (send_xon) (port_id)
</pre></div>
</div>
</div>
<p>In the real <code class="docutils literal notranslate"><span class="pre">testpmd&gt;</span></code> prompt these commands should be on a single line.</p>
<section id="help-functions">
<h2><span class="section-number">4.1. </span>Help Functions</h2>
<p>The testpmd has on-line help for the functions that are available at runtime.
These are divided into sections and can be accessed using help, help section or help all:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; help</span>
<span class="go">    Help is available for the following sections:</span>

<span class="go">        help control                    : Start and stop forwarding.</span>
<span class="go">        help display                    : Displaying port, stats and config information.</span>
<span class="go">        help config                     : Configuration information.</span>
<span class="go">        help ports                      : Configuring ports.</span>
<span class="go">        help filters                    : Filters configuration help.</span>
<span class="go">        help traffic_management         : Traffic Management commands.</span>
<span class="go">        help devices                    : Device related commands.</span>
<span class="go">        help drivers                    : Driver specific commands.</span>
<span class="go">        help all                        : All of the above sections.</span>
</pre></div>
</div>
</section>
<section id="command-file-functions">
<h2><span class="section-number">4.2. </span>Command File Functions</h2>
<p>To facilitate loading large number of commands or to avoid cutting and pasting where not
practical or possible testpmd supports alternative methods for executing commands.</p>
<ul class="simple">
<li><p>If started with the <code class="docutils literal notranslate"><span class="pre">--cmdline-file=FILENAME</span></code> command line argument testpmd
will execute all CLI commands contained within the file immediately before
starting packet forwarding or entering interactive mode.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./dpdk-testpmd -n4 -r2 ... -- -i --cmdline-file=/home/ubuntu/flow-create-commands.txt</span>
<span class="go">Interactive-mode selected</span>
<span class="go">CLI commands to be read from /home/ubuntu/flow-create-commands.txt</span>
<span class="go">Configuring Port 0 (socket 0)</span>
<span class="go">Port 0: 7C:FE:90:CB:74:CE</span>
<span class="go">Configuring Port 1 (socket 0)</span>
<span class="go">Port 1: 7C:FE:90:CB:74:CA</span>
<span class="go">Checking link statuses...</span>
<span class="go">Port 0 Link Up - speed 10000 Mbps - full-duplex</span>
<span class="go">Port 1 Link Up - speed 10000 Mbps - full-duplex</span>
<span class="go">Done</span>
<span class="go">Flow rule #0 created</span>
<span class="go">Flow rule #1 created</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">Flow rule #498 created</span>
<span class="go">Flow rule #499 created</span>
<span class="go">Read all CLI commands from /home/ubuntu/flow-create-commands.txt</span>
<span class="go">testpmd&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>At run-time additional commands can be loaded in bulk by invoking the <code class="docutils literal notranslate"><span class="pre">load</span> <span class="pre">FILENAME</span></code>
command.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; load /home/ubuntu/flow-create-commands.txt</span>
<span class="go">Flow rule #0 created</span>
<span class="go">Flow rule #1 created</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">Flow rule #498 created</span>
<span class="go">Flow rule #499 created</span>
<span class="go">Read all CLI commands from /home/ubuntu/flow-create-commands.txt</span>
<span class="go">testpmd&gt;</span>
</pre></div>
</div>
<p>In all cases output from any included command will be displayed as standard output.
Execution will continue until the end of the file is reached regardless of
whether any errors occur.  The end user must examine the output to determine if
any failures occurred.</p>
</section>
<section id="control-functions">
<h2><span class="section-number">4.3. </span>Control Functions</h2>
<section id="start">
<h3><span class="section-number">4.3.1. </span>start</h3>
<p>Start packet forwarding with current configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; start
</pre></div>
</div>
</section>
<section id="start-tx-first">
<h3><span class="section-number">4.3.2. </span>start tx_first</h3>
<p>Start packet forwarding with current configuration after sending specified number of bursts of packets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; start tx_first (&quot;&quot;|burst_num)
</pre></div>
</div>
<p>The default burst number is 1 when <code class="docutils literal notranslate"><span class="pre">burst_num</span></code> not presented.</p>
</section>
<section id="stop">
<h3><span class="section-number">4.3.3. </span>stop</h3>
<p>Stop packet forwarding, and display accumulated statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; stop
</pre></div>
</div>
</section>
<section id="quit">
<h3><span class="section-number">4.3.4. </span>quit</h3>
<p>Quit to prompt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; quit
</pre></div>
</div>
</section>
</section>
<section id="display-functions">
<h2><span class="section-number">4.4. </span>Display Functions</h2>
<p>The functions in the following sections are used to display information about the
testpmd configuration or the NIC status.</p>
<section id="show-port">
<h3><span class="section-number">4.4.1. </span>show port</h3>
<p>Display information for a given port or all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (info|summary|stats|xstats|fdir|dcb_tc|cap) (port_id|all)
</pre></div>
</div>
<p>The available information categories are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">info</span></code>: General port information such as MAC address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">summary</span></code>: Brief port summary such as Device Name, Driver Name etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats</span></code>: RX/TX statistics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xstats</span></code>: RX/TX extended NIC statistics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fdir</span></code>: Flow Director information and statistics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcb_tc</span></code>: DCB information such as TC mapping.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show port info 0</span>

<span class="go">********************* Infos for port 0 *********************</span>

<span class="go">MAC address: XX:XX:XX:XX:XX:XX</span>
<span class="go">Connect to socket: 0</span>
<span class="go">memory allocation on the socket: 0</span>
<span class="go">Link status: up</span>
<span class="go">Link speed: 40000 Mbps</span>
<span class="go">Link duplex: full-duplex</span>
<span class="go">Promiscuous mode: enabled</span>
<span class="go">Allmulticast mode: disabled</span>
<span class="go">Maximum number of MAC addresses: 64</span>
<span class="go">Maximum number of MAC addresses of hash filtering: 0</span>
<span class="go">VLAN offload:</span>
<span class="go">    strip on, filter on, extend off, qinq strip off</span>
<span class="go">Redirection table size: 512</span>
<span class="go">Supported flow types:</span>
<span class="go">  ipv4-frag</span>
<span class="go">  ipv4-tcp</span>
<span class="go">  ipv4-udp</span>
<span class="go">  ipv4-sctp</span>
<span class="go">  ipv4-other</span>
<span class="go">  ipv6-frag</span>
<span class="go">  ipv6-tcp</span>
<span class="go">  ipv6-udp</span>
<span class="go">  ipv6-sctp</span>
<span class="go">  ipv6-other</span>
<span class="go">  l2_payload</span>
<span class="go">  port</span>
<span class="go">  vxlan</span>
<span class="go">  geneve</span>
<span class="go">  nvgre</span>
<span class="go">  vxlan-gpe</span>
</pre></div>
</div>
</section>
<section id="show-port-module-eeprom-eeprom">
<h3><span class="section-number">4.4.2. </span>show port (module_eeprom|eeprom)</h3>
<p>Display the EEPROM information of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) (module_eeprom|eeprom)
</pre></div>
</div>
</section>
<section id="show-port-rss-reta">
<h3><span class="section-number">4.4.3. </span>show port rss reta</h3>
<p>Display the rss redirection table entry indicated by masks on port X:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rss reta (size) (mask0, mask1...)
</pre></div>
</div>
<p>size is used to indicate the hardware supported reta size</p>
</section>
<section id="show-port-rss-hash">
<h3><span class="section-number">4.4.4. </span>show port rss-hash</h3>
<p>Display the RSS hash functions and RSS hash key or RSS hash algorithm of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rss-hash [key | algorithm]
</pre></div>
</div>
</section>
<section id="clear-port">
<h3><span class="section-number">4.4.5. </span>clear port</h3>
<p>Clear the port statistics and forward engine statistics for a given port or for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear port (info|stats|xstats|fdir) (port_id|all)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear port stats all
</pre></div>
</div>
</section>
<section id="show-rxq-txq">
<h3><span class="section-number">4.4.6. </span>show (rxq|txq)</h3>
<p>Display information for a given port’s RX/TX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show (rxq|txq) info (port_id) (queue_id)
</pre></div>
</div>
</section>
<section id="show-desc-status-rxq-txq">
<h3><span class="section-number">4.4.7. </span>show desc status(rxq|txq)</h3>
<p>Display information for a given port’s RX/TX descriptor status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) (rxq|txq) (queue_id) desc (desc_id) status
</pre></div>
</div>
</section>
<section id="show-rxq-desc-used-count">
<h3><span class="section-number">4.4.8. </span>show rxq desc used count</h3>
<p>Display the number of receive packet descriptors currently filled by hardware
and ready to be processed by the driver on a given RX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rxq (queue_id) desc used count
</pre></div>
</div>
</section>
<section id="show-config">
<h3><span class="section-number">4.4.9. </span>show config</h3>
<p>Displays the configuration of the application.
The configuration comes from the command-line, the runtime or the application defaults:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show config (rxtx|cores|fwd|rxoffs|rxpkts|rxhdrs|txpkts|txtimes)
</pre></div>
</div>
<p>The available information categories are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rxtx</span></code>: RX/TX configuration items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cores</span></code>: List of forwarding cores.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwd</span></code>: Packet forwarding configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxoffs</span></code>: Packet offsets for RX split.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxpkts</span></code>: Packets to RX length-based split configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxhdrs</span></code>: Packets to RX proto-based split configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txpkts</span></code>: Packets to TX configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txtimes</span></code>: Burst time pattern for Tx only mode.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show config rxtx</span>

<span class="go">io packet forwarding - CRC stripping disabled - packets/burst=16</span>
<span class="go">nb forwarding cores=2 - nb forwarding ports=1</span>
<span class="go">RX queues=1 - RX desc=128 - RX free threshold=0</span>
<span class="go">RX threshold registers: pthresh=8 hthresh=8 wthresh=4</span>
<span class="go">TX queues=1 - TX desc=512 - TX free threshold=0</span>
<span class="go">TX threshold registers: pthresh=36 hthresh=0 wthresh=0</span>
<span class="go">TX RS bit threshold=0 - TXQ flags=0x0</span>
</pre></div>
</div>
</section>
<section id="set-fwd">
<h3><span class="section-number">4.4.10. </span>set fwd</h3>
<p>Set the packet forwarding mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set fwd (io|mac|macswap|flowgen| \
                  rxonly|txonly|csum|icmpecho|noisy|5tswap|shared-rxq|recycle_mbufs) (&quot;&quot;|retry)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">retry</span></code> can be specified for forwarding engines except <code class="docutils literal notranslate"><span class="pre">rx_only</span></code>.</p>
<p>The available information categories are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">io</span></code>: Forwards packets “as-is” in I/O mode.
This is the fastest possible forwarding operation as it does not access packets data.
This is the default mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mac</span></code>: Changes the source and the destination Ethernet addresses of packets before forwarding them.
Default application behavior is to set source Ethernet address to that of the transmitting interface, and destination
address to a dummy value (set during init). The user may specify a target destination Ethernet address via the ‘eth-peer’ or
‘eth-peers-configfile’ command-line options. It is not currently possible to specify a specific source Ethernet address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">macswap</span></code>: MAC swap forwarding mode.
Swaps the source and the destination Ethernet addresses of packets before forwarding them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flowgen</span></code>: Multi-flow generation mode.
Originates a number of flows (with varying destination IP addresses), and terminate receive traffic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxonly</span></code>: Receives packets but doesn’t transmit them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txonly</span></code>: Generates and transmits packets without receiving any.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">csum</span></code>: Changes the checksum field with hardware or software methods depending on the offload flags on the packet.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmpecho</span></code>: Receives a burst of packets, lookup for ICMP echo requests and, if any, send back ICMP echo replies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ieee1588</span></code>: Demonstrate L2 IEEE1588 V2 PTP timestamping for RX and TX.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noisy</span></code>: Noisy neighbor simulation.
Simulate more realistic behavior of a guest machine engaged in receiving
and sending packets performing Virtual Network Function (VNF).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">5tswap</span></code>: Swap the source and destination of L2,L3,L4 if they exist.</p>
<p>L2 swaps the source address and destination address of Ethernet, as same as <code class="docutils literal notranslate"><span class="pre">macswap</span></code>.</p>
<p>L3 swaps the source address and destination address of IP (v4 and v6).</p>
<p>L4 swaps the source port and destination port of transport layer (TCP and UDP).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">shared-rxq</span></code>: Receive only for shared Rx queue.
Resolve packet source port from mbuf and update stream statistics accordingly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recycle_mbufs</span></code>:  Recycle Tx queue used mbufs for Rx queue mbuf ring.
This mode uses fast path mbuf recycle feature and forwards packets in I/O mode.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set fwd rxonly

Set rxonly packet forwarding mode
</pre></div>
</div>
</section>
<section id="show-fwd">
<h3><span class="section-number">4.4.11. </span>show fwd</h3>
<p>When running, forwarding engines maintain statistics from the time they have been started.
Example for the io forwarding engine, with some packet drops on the tx side:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show fwd stats all

  ------- Forward Stats for RX Port= 0/Queue= 0 -&gt; TX Port= 1/Queue= 0 -------
  RX-packets: 274293770      TX-packets: 274293642      TX-dropped: 128

  ------- Forward Stats for RX Port= 1/Queue= 0 -&gt; TX Port= 0/Queue= 0 -------
  RX-packets: 274301850      TX-packets: 274301850      TX-dropped: 0

  ---------------------- Forward statistics for port 0  ----------------------
  RX-packets: 274293802      RX-dropped: 0             RX-total: 274293802
  TX-packets: 274301862      TX-dropped: 0             TX-total: 274301862
  ----------------------------------------------------------------------------

  ---------------------- Forward statistics for port 1  ----------------------
  RX-packets: 274301894      RX-dropped: 0             RX-total: 274301894
  TX-packets: 274293706      TX-dropped: 128           TX-total: 274293834
  ----------------------------------------------------------------------------

  +++++++++++++++ Accumulated forward statistics for all ports+++++++++++++++
  RX-packets: 548595696      RX-dropped: 0             RX-total: 548595696
  TX-packets: 548595568      TX-dropped: 128           TX-total: 548595696
  ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</pre></div>
</div>
</section>
<section id="clear-fwd">
<h3><span class="section-number">4.4.12. </span>clear fwd</h3>
<p>Clear the forwarding engines statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear fwd stats all
</pre></div>
</div>
</section>
<section id="read-rxd">
<h3><span class="section-number">4.4.13. </span>read rxd</h3>
<p>Display an RX descriptor for a port RX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read rxd (port_id) (queue_id) (rxd_id)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read rxd 0 0 4
     0x0000000B - 0x001D0180 / 0x0000000B - 0x001D0180
</pre></div>
</div>
</section>
<section id="read-txd">
<h3><span class="section-number">4.4.14. </span>read txd</h3>
<p>Display a TX descriptor for a port TX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read txd (port_id) (queue_id) (txd_id)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read txd 0 0 4
     0x00000001 - 0x24C3C440 / 0x000F0000 - 0x2330003C
</pre></div>
</div>
</section>
<section id="show-vf-stats">
<h3><span class="section-number">4.4.15. </span>show vf stats</h3>
<p>Display VF statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show vf stats (port_id) (vf_id)
</pre></div>
</div>
</section>
<section id="clear-vf-stats">
<h3><span class="section-number">4.4.16. </span>clear vf stats</h3>
<p>Reset VF statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear vf stats (port_id) (vf_id)
</pre></div>
</div>
</section>
<section id="show-rx-offloading-capabilities">
<h3><span class="section-number">4.4.17. </span>show rx offloading capabilities</h3>
<p>List all per queue and per port Rx offloading capabilities of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rx_offload capabilities
</pre></div>
</div>
</section>
<section id="show-rx-offloading-configuration">
<h3><span class="section-number">4.4.18. </span>show rx offloading configuration</h3>
<p>List port level and all queue level Rx offloading configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rx_offload configuration
</pre></div>
</div>
</section>
<section id="show-tx-offloading-capabilities">
<h3><span class="section-number">4.4.19. </span>show tx offloading capabilities</h3>
<p>List all per queue and per port Tx offloading capabilities of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) tx_offload capabilities
</pre></div>
</div>
</section>
<section id="show-tx-offloading-configuration">
<h3><span class="section-number">4.4.20. </span>show tx offloading configuration</h3>
<p>List port level and all queue level Tx offloading configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) tx_offload configuration
</pre></div>
</div>
</section>
<section id="show-tx-metadata-setting">
<h3><span class="section-number">4.4.21. </span>show tx metadata setting</h3>
<p>Show Tx metadata value set for a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) tx_metadata
</pre></div>
</div>
</section>
<section id="show-port-supported-ptypes">
<h3><span class="section-number">4.4.22. </span>show port supported ptypes</h3>
<p>Show ptypes supported for a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) ptypes
</pre></div>
</div>
</section>
<section id="set-port-supported-ptypes">
<h3><span class="section-number">4.4.23. </span>set port supported ptypes</h3>
<p>set packet types classification for a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) ptypes_mask (mask)
</pre></div>
</div>
</section>
<section id="show-port-mac-addresses-info">
<h3><span class="section-number">4.4.24. </span>show port mac addresses info</h3>
<p>Show mac addresses added for a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) macs
</pre></div>
</div>
</section>
<section id="show-port-multicast-mac-addresses-info">
<h3><span class="section-number">4.4.25. </span>show port multicast mac addresses info</h3>
<p>Show multicast mac addresses added for a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) mcast_macs
</pre></div>
</div>
</section>
<section id="show-flow-transfer-proxy-port-id-for-the-given-port">
<h3><span class="section-number">4.4.26. </span>show flow transfer proxy port ID for the given port</h3>
<p>Show proxy port ID to use as the 1st argument in commands to
manage <code class="docutils literal notranslate"><span class="pre">transfer</span></code> flows and their indirect components.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) flow transfer proxy
</pre></div>
</div>
</section>
<section id="show-device-info">
<h3><span class="section-number">4.4.27. </span>show device info</h3>
<p>Show general information about devices probed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show device info (&lt;identifier&gt;|all)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show device info net_pcap0</span>

<span class="go">********************* Infos for device net_pcap0 *********************</span>
<span class="go">Bus name: vdev</span>
<span class="go">Driver name: net_pcap</span>
<span class="go">Devargs: iface=enP2p6s0,phy_mac=1</span>
<span class="go">Connect to socket: -1</span>

<span class="go">        Port id: 2</span>
<span class="go">        MAC address: 1E:37:93:28:04:B8</span>
<span class="go">        Device name: net_pcap0</span>
</pre></div>
</div>
</section>
<section id="dump-physmem">
<h3><span class="section-number">4.4.28. </span>dump physmem</h3>
<p>Dumps all physical memory segment layouts:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_physmem
</pre></div>
</div>
</section>
<section id="dump-memzone">
<h3><span class="section-number">4.4.29. </span>dump memzone</h3>
<p>Dumps the layout of all memory zones:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_memzone
</pre></div>
</div>
</section>
<section id="dump-socket-memory">
<h3><span class="section-number">4.4.30. </span>dump socket memory</h3>
<p>Dumps the memory usage of all sockets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_socket_mem
</pre></div>
</div>
</section>
<section id="dump-struct-size">
<h3><span class="section-number">4.4.31. </span>dump struct size</h3>
<p>Dumps the size of all memory structures:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_struct_sizes
</pre></div>
</div>
</section>
<section id="dump-ring">
<h3><span class="section-number">4.4.32. </span>dump ring</h3>
<p>Dumps the status of all or specific element in DPDK rings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_ring [ring_name]
</pre></div>
</div>
</section>
<section id="dump-mempool">
<h3><span class="section-number">4.4.33. </span>dump mempool</h3>
<p>Dumps the statistics of all or specific memory pool:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_mempool [mempool_name]
</pre></div>
</div>
</section>
<section id="dump-devargs">
<h3><span class="section-number">4.4.34. </span>dump devargs</h3>
<p>Dumps the user device list:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_devargs
</pre></div>
</div>
</section>
<section id="dump-lcores">
<h3><span class="section-number">4.4.35. </span>dump lcores</h3>
<p>Dumps the logical cores list:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_lcores
</pre></div>
</div>
</section>
<section id="dump-trace">
<h3><span class="section-number">4.4.36. </span>dump trace</h3>
<p>Dumps the tracing data to the folder according to the current EAL settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_trace
</pre></div>
</div>
</section>
<section id="dump-log-types">
<h3><span class="section-number">4.4.37. </span>dump log types</h3>
<p>Dumps the log level for all the dpdk modules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; dump_log_types
</pre></div>
</div>
</section>
<section id="show-raw-encap-raw-decap">
<h3><span class="section-number">4.4.38. </span>show (raw_encap|raw_decap)</h3>
<p>Display content of raw_encap/raw_decap buffers in hex:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show &lt;raw_encap|raw_decap&gt; &lt;index&gt;
testpmd&gt; show &lt;raw_encap|raw_decap&gt; all
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show raw_encap 6

index: 6 at [0x1c565b0], len=50
00000000: 00 00 00 00 00 00 16 26 36 46 56 66 08 00 45 00 | .......&amp;6FVf..E.
00000010: 00 00 00 00 00 00 00 11 00 00 C0 A8 01 06 C0 A8 | ................
00000020: 03 06 00 00 00 FA 00 00 00 00 08 00 00 00 00 00 | ................
00000030: 06 00                                           | ..
</pre></div>
</div>
</section>
<section id="show-fec-capabilities">
<h3><span class="section-number">4.4.39. </span>show fec capabilities</h3>
<p>Show fec capabilities of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) fec capabilities
</pre></div>
</div>
</section>
<section id="show-fec-mode">
<h3><span class="section-number">4.4.40. </span>show fec mode</h3>
<p>Show fec mode of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) fec_mode
</pre></div>
</div>
</section>
</section>
<section id="configuration-functions">
<h2><span class="section-number">4.5. </span>Configuration Functions</h2>
<p>The testpmd application can be configured from the runtime as well as from the command-line.</p>
<p>This section details the available configuration functions that are available.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Configuration changes only become active when forwarding is started/restarted.</p>
</div>
<section id="set-default">
<h3><span class="section-number">4.5.1. </span>set default</h3>
<p>Reset forwarding to the default configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set default
</pre></div>
</div>
</section>
<section id="set-verbose">
<h3><span class="section-number">4.5.2. </span>set verbose</h3>
<p>Set the debug verbosity level:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set verbose (level)
</pre></div>
</div>
<p>Available levels are as following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> silent except for error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> fully verbose except for Tx packets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> fully verbose except for Rx packets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">2</span></code> fully verbose.</p></li>
</ul>
</section>
<section id="set-log">
<h3><span class="section-number">4.5.3. </span>set log</h3>
<p>Set the log level for a log type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set log global|(type) (level)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> is the log name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> is the log level.</p></li>
</ul>
<p>For example, to change the global log level:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set log global (level)
</pre></div>
</div>
<p>Regexes can also be used for type. To change log level of user1, user2 and user3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set log user[1-3] (level)
</pre></div>
</div>
</section>
<section id="set-nbport">
<h3><span class="section-number">4.5.4. </span>set nbport</h3>
<p>Set the number of ports used by the application:</p>
<p>set nbport (num)</p>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--nb-ports</span></code> command-line option.</p>
</section>
<section id="set-nbcore">
<h3><span class="section-number">4.5.5. </span>set nbcore</h3>
<p>Set the number of cores used by the application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set nbcore (num)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--nb-cores</span></code> command-line option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The number of cores used must not be greater than number of ports used multiplied by the number of queues per port.</p>
</div>
</section>
<section id="set-coremask">
<h3><span class="section-number">4.5.6. </span>set coremask</h3>
<p>Set the forwarding cores hexadecimal mask:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set coremask (mask)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--coremask</span></code> command-line option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The main lcore is reserved for command line parsing only and cannot be masked on for packet forwarding.</p>
</div>
</section>
<section id="set-portmask">
<h3><span class="section-number">4.5.7. </span>set portmask</h3>
<p>Set the forwarding ports hexadecimal mask:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set portmask (mask)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--portmask</span></code> command-line option.</p>
</section>
<section id="set-record-core-cycles">
<h3><span class="section-number">4.5.8. </span>set record-core-cycles</h3>
<p>Set the recording of CPU cycles:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set record-core-cycles (on|off)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code> enables measurement of CPU cycles per packet.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">off</span></code> disables measurement of CPU cycles per packet.</p></li>
</ul>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--record-core-cycles</span> <span class="pre">command-line</span></code> option.</p>
</section>
<section id="set-record-burst-stats">
<h3><span class="section-number">4.5.9. </span>set record-burst-stats</h3>
<p>Set the displaying of RX and TX bursts:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set record-burst-stats (on|off)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code> enables display of RX and TX bursts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">off</span></code> disables display of RX and TX bursts.</p></li>
</ul>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--record-burst-stats</span> <span class="pre">command-line</span></code> option.</p>
</section>
<section id="set-burst">
<h3><span class="section-number">4.5.10. </span>set burst</h3>
<p>Set number of packets per burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set burst (num)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--burst</span> <span class="pre">command-line</span></code> option.</p>
<p>When retry is enabled, the transmit delay time and number of retries can also be set:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set burst tx delay (microseconds) retry (num)
</pre></div>
</div>
</section>
<section id="set-rxoffs">
<h3><span class="section-number">4.5.11. </span>set rxoffs</h3>
<p>Set the offsets of segments relating to the data buffer beginning on receiving
if split feature is engaged. Affects only the queues configured with split
offloads (currently BUFFER_SPLIT is supported only).</p>
<blockquote>
<div><p>testpmd&gt; set rxoffs (x[,y]*)</p>
</div></blockquote>
<p>Where x[,y]* represents a CSV list of values, without white space. If the list
of offsets is shorter than the list of segments the zero offsets will be used
for the remaining segments.</p>
</section>
<section id="set-rxpkts">
<h3><span class="section-number">4.5.12. </span>set rxpkts</h3>
<p>Set the length of segments to scatter packets on receiving if split
feature is engaged. Affects only the queues configured with split offloads
(currently BUFFER_SPLIT is supported only). Optionally the multiple memory
pools can be specified with –mbuf-size command line parameter and the mbufs
to receive will be allocated sequentially from these extra memory pools (the
mbuf for the first segment is allocated from the first pool, the second one
from the second pool, and so on, if segment number is greater then pool’s the
mbuf for remaining segments will be allocated from the last valid pool).</p>
<blockquote>
<div><p>testpmd&gt; set rxpkts (x[,y]*)</p>
</div></blockquote>
<p>Where x[,y]* represents a CSV list of values, without white space. Zero value
means to use the corresponding memory pool data buffer size.</p>
</section>
<section id="set-rxhdrs">
<h3><span class="section-number">4.5.13. </span>set rxhdrs</h3>
<p>Set the protocol headers of segments to scatter packets on receiving
if split feature is engaged.
Affects only the queues configured with split offloads
(currently BUFFER_SPLIT is supported only).</p>
<blockquote>
<div><p>testpmd&gt; set rxhdrs (eth[,ipv4]*)</p>
</div></blockquote>
<p>Where eth[,ipv4]* represents a CSV list of values, without white space.
If the list of offsets is shorter than the list of segments,
zero offsets will be used for the remaining segments.</p>
</section>
<section id="set-txpkts">
<h3><span class="section-number">4.5.14. </span>set txpkts</h3>
<p>Set the length of each segment of the TX-ONLY packets or length of packet for FLOWGEN mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set txpkts (x[,y]*)
</pre></div>
</div>
<p>Where x[,y]* represents a CSV list of values, without white space.</p>
</section>
<section id="set-txtimes">
<h3><span class="section-number">4.5.15. </span>set txtimes</h3>
<p>Configure the timing burst pattern for Tx only mode. This command enables
the packet send scheduling on dynamic timestamp mbuf field and configures
timing pattern in Tx only mode. In this mode, if scheduling is enabled
application provides timestamps in the packets being sent. It is possible
to configure delay (in unspecified device clock units) between bursts
and between the packets within the burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set txtimes (inter),(intra)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inter</span></code>  is the delay between the bursts in the device clock units.
If <code class="docutils literal notranslate"><span class="pre">intra</span></code> is zero, this is the time between the beginnings of the
first packets in the neighbour bursts, if <code class="docutils literal notranslate"><span class="pre">intra</span></code> is not zero,
<code class="docutils literal notranslate"><span class="pre">inter</span></code> specifies the time between the beginning of the first packet
of the current burst and the beginning of the last packet of the
previous burst. If <code class="docutils literal notranslate"><span class="pre">inter</span></code> parameter is zero the send scheduling
on timestamps is disabled (default).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intra</span></code> is the delay between the packets within the burst specified
in the device clock units. The number of packets in the burst is defined
by regular burst setting. If <code class="docutils literal notranslate"><span class="pre">intra</span></code> parameter is zero no timestamps
provided in the packets excepting the first one in the burst.</p></li>
</ul>
<p>As the result the bursts of packet will be transmitted with specific
delays between the packets within the burst and specific delay between
the bursts. The rte_eth_read_clock() must be supported by the device(s)
and is supposed to be engaged to get the current device clock value
and provide the reference for the timestamps. If there is no supported
rte_eth_read_clock() there will be no send scheduling provided on the port.</p>
</section>
<section id="set-txsplit">
<h3><span class="section-number">4.5.16. </span>set txsplit</h3>
<p>Set the split policy for the TX packets, applicable for TX-ONLY and CSUM forwarding modes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set txsplit (off|on|rand)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">off</span></code> disable packet copy &amp; split for CSUM mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code> split outgoing packet into multiple segments. Size of each segment
and number of segments per packet is determined by <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">txpkts</span></code> command
(see above).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rand</span></code> same as ‘on’, but number of segments per each packet is a random value between 1 and total number of segments.</p></li>
</ul>
</section>
<section id="set-corelist">
<h3><span class="section-number">4.5.17. </span>set corelist</h3>
<p>Set the list of forwarding cores:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set corelist (x[,y]*)
</pre></div>
</div>
<p>For example, to change the forwarding cores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; set corelist 3,1</span>
<span class="go">testpmd&gt; show config fwd</span>

<span class="go">io packet forwarding - ports=2 - cores=2 - streams=2 - NUMA support disabled</span>
<span class="go">Logical Core 3 (socket 0) forwards packets on 1 streams:</span>
<span class="go">RX P=0/Q=0 (socket 0) -&gt; TX P=1/Q=0 (socket 0) peer=02:00:00:00:00:01</span>
<span class="go">Logical Core 1 (socket 0) forwards packets on 1 streams:</span>
<span class="go">RX P=1/Q=0 (socket 0) -&gt; TX P=0/Q=0 (socket 0) peer=02:00:00:00:00:00</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The cores are used in the same order as specified on the command line.</p>
</div>
</section>
<section id="set-portlist">
<h3><span class="section-number">4.5.18. </span>set portlist</h3>
<p>Set the list of forwarding ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set portlist (x[,y]*)
</pre></div>
</div>
<p>For example, to change the port forwarding:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; set portlist 0,2,1,3</span>
<span class="go">testpmd&gt; show config fwd</span>

<span class="go">io packet forwarding - ports=4 - cores=1 - streams=4</span>
<span class="go">Logical Core 3 (socket 0) forwards packets on 4 streams:</span>
<span class="go">RX P=0/Q=0 (socket 0) -&gt; TX P=2/Q=0 (socket 0) peer=02:00:00:00:00:01</span>
<span class="go">RX P=2/Q=0 (socket 0) -&gt; TX P=0/Q=0 (socket 0) peer=02:00:00:00:00:00</span>
<span class="go">RX P=1/Q=0 (socket 0) -&gt; TX P=3/Q=0 (socket 0) peer=02:00:00:00:00:03</span>
<span class="go">RX P=3/Q=0 (socket 0) -&gt; TX P=1/Q=0 (socket 0) peer=02:00:00:00:00:02</span>
</pre></div>
</div>
</section>
<section id="set-port-setup-on">
<h3><span class="section-number">4.5.19. </span>set port setup on</h3>
<p>Select how to retrieve new ports created after “port attach” command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port setup on (iterator|event)
</pre></div>
</div>
<p>For each new port, a setup is done.
It will find the probed ports via RTE_ETH_FOREACH_MATCHING_DEV loop
in iterator mode, or via RTE_ETH_EVENT_NEW in event mode.</p>
</section>
<section id="set-tx-loopback">
<h3><span class="section-number">4.5.20. </span>set tx loopback</h3>
<p>Enable/disable tx loopback:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set tx loopback (port_id) (on|off)
</pre></div>
</div>
</section>
<section id="set-drop-enable">
<h3><span class="section-number">4.5.21. </span>set drop enable</h3>
<p>set drop enable bit for all queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set all queues drop (port_id) (on|off)
</pre></div>
</div>
</section>
<section id="set-mac-antispoof-for-vf">
<h3><span class="section-number">4.5.22. </span>set mac antispoof (for VF)</h3>
<p>Set mac antispoof for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf mac antispoof  (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="vlan-set-stripq">
<h3><span class="section-number">4.5.23. </span>vlan set stripq</h3>
<p>Set the VLAN strip for a queue on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set stripq (on|off) (port_id,queue_id)
</pre></div>
</div>
</section>
<section id="vlan-set-stripq-for-vf">
<h3><span class="section-number">4.5.24. </span>vlan set stripq (for VF)</h3>
<p>Set VLAN strip for all queues in a pool for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan stripq (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="vlan-set-insert-for-vf">
<h3><span class="section-number">4.5.25. </span>vlan set insert (for VF)</h3>
<p>Set VLAN insert for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan insert (port_id) (vf_id) (vlan_id)
</pre></div>
</div>
</section>
<section id="vlan-set-antispoof-for-vf">
<h3><span class="section-number">4.5.26. </span>vlan set antispoof (for VF)</h3>
<p>Set VLAN antispoof for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan antispoof (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="vlan-set-strip-filter-qinq-strip-extend">
<h3><span class="section-number">4.5.27. </span>vlan set (strip|filter|qinq_strip|extend)</h3>
<p>Set the VLAN strip/filter/QinQ strip/extend on for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set (strip|filter|qinq_strip|extend) (on|off) (port_id)
</pre></div>
</div>
</section>
<section id="vlan-set-tpid">
<h3><span class="section-number">4.5.28. </span>vlan set tpid</h3>
<p>Set the inner or outer VLAN TPID for packet filtering on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set (inner|outer) tpid (value) (port_id)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TPID value must be a 16-bit number (value &lt;= 65536).</p>
</div>
</section>
<section id="rx-vlan-add">
<h3><span class="section-number">4.5.29. </span>rx_vlan add</h3>
<p>Add a VLAN ID, or all identifiers, to the set of VLAN identifiers filtered by port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan add (vlan_id|all) (port_id)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VLAN filter must be set on that port. VLAN ID &lt; 4096.
Depending on the NIC used, number of vlan_ids may be limited to the maximum entries
in VFTA table. This is important if enabling all vlan_ids.</p>
</div>
</section>
<section id="rx-vlan-rm">
<h3><span class="section-number">4.5.30. </span>rx_vlan rm</h3>
<p>Remove a VLAN ID, or all identifiers, from the set of VLAN identifiers filtered by port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan rm (vlan_id|all) (port_id)
</pre></div>
</div>
</section>
<section id="rx-vlan-add-for-vf">
<h3><span class="section-number">4.5.31. </span>rx_vlan add (for VF)</h3>
<p>Add a VLAN ID, to the set of VLAN identifiers filtered for VF(s) for port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan add (vlan_id) port (port_id) vf (vf_mask)
</pre></div>
</div>
</section>
<section id="rx-vlan-rm-for-vf">
<h3><span class="section-number">4.5.32. </span>rx_vlan rm (for VF)</h3>
<p>Remove a VLAN ID, from the set of VLAN identifiers filtered for VF(s) for port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan rm (vlan_id) port (port_id) vf (vf_mask)
</pre></div>
</div>
</section>
<section id="rx-vxlan-port-add">
<h3><span class="section-number">4.5.33. </span>rx_vxlan_port add</h3>
<p>Add an UDP port for VXLAN packet filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vxlan_port add (udp_port) (port_id)
</pre></div>
</div>
</section>
<section id="rx-vxlan-port-remove">
<h3><span class="section-number">4.5.34. </span>rx_vxlan_port remove</h3>
<p>Remove an UDP port for VXLAN packet filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vxlan_port rm (udp_port) (port_id)
</pre></div>
</div>
</section>
<section id="tx-vlan-set">
<h3><span class="section-number">4.5.35. </span>tx_vlan set</h3>
<p>Set hardware insertion of VLAN IDs in packets sent on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tx_vlan set (port_id) vlan_id[, vlan_id_outer]
</pre></div>
</div>
<p>For example, set a single VLAN ID (5) insertion on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tx_vlan set 0 5
</pre></div>
</div>
<p>Or, set double VLAN ID (inner: 2, outer: 3) insertion on port 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tx_vlan set 1 2 3
</pre></div>
</div>
</section>
<section id="tx-vlan-set-pvid">
<h3><span class="section-number">4.5.36. </span>tx_vlan set pvid</h3>
<p>Set port based hardware insertion of VLAN ID in packets sent on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tx_vlan set pvid (port_id) (vlan_id) (on|off)
</pre></div>
</div>
</section>
<section id="tx-vlan-reset">
<h3><span class="section-number">4.5.37. </span>tx_vlan reset</h3>
<p>Disable hardware insertion of a VLAN header in packets sent on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tx_vlan reset (port_id)
</pre></div>
</div>
</section>
<section id="csum-set">
<h3><span class="section-number">4.5.38. </span>csum set</h3>
<p>Select hardware or software calculation of the checksum when
transmitting a packet using the <code class="docutils literal notranslate"><span class="pre">csum</span></code> forwarding engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; csum set (ip|udp|tcp|sctp|outer-ip|outer-udp) (hw|sw) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ip|udp|tcp|sctp</span></code> always relate to  the inner layer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outer-ip</span></code> relates to the outer IP layer (only for IPv4) in the case where the packet is recognized
as a tunnel packet by the forwarding engine (geneve, gre, gtp, ipip, vxlan and vxlan-gpe are
supported). See also the <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">parse-tunnel</span></code> command.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outer-udp</span></code> relates to the outer UDP layer in the case where the packet is recognized
as a tunnel packet by the forwarding engine (geneve, gtp, vxlan and vxlan-gpe are
supported). See also the <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">parse-tunnel</span></code> command.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Check the NIC Datasheet for hardware limits.</p>
</div>
</section>
<section id="csum-parse-tunnel">
<h3><span class="section-number">4.5.39. </span>csum parse-tunnel</h3>
<p>Define how tunneled packets should be handled by the csum forward
engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; csum parse-tunnel (on|off) (tx_port_id)
</pre></div>
</div>
<p>If enabled, the csum forward engine will try to recognize supported
tunnel headers (geneve, gtp, gre, ipip, vxlan, vxlan-gpe).</p>
<p>If disabled, treat tunnel packets as non-tunneled packets (a inner
header is handled as a packet payload).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The port argument is the TX port like in the <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">set</span></code> command.</p>
</div>
<p>Example:</p>
<p>Consider a packet in packet like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eth_out/ipv4_out/udp_out/vxlan/eth_in/ipv4_in/tcp_in
</pre></div>
</div>
<ul class="simple">
<li><p>If parse-tunnel is enabled, the <code class="docutils literal notranslate"><span class="pre">ip|udp|tcp|sctp</span></code> parameters of <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">set</span></code>
command relate to the inner headers (here <code class="docutils literal notranslate"><span class="pre">ipv4_in</span></code> and <code class="docutils literal notranslate"><span class="pre">tcp_in</span></code>), and the
<code class="docutils literal notranslate"><span class="pre">outer-ip|outer-udp</span></code> parameter relates to the outer headers (here <code class="docutils literal notranslate"><span class="pre">ipv4_out</span></code> and <code class="docutils literal notranslate"><span class="pre">udp_out</span></code>).</p></li>
<li><dl class="simple">
<dt>If parse-tunnel is disabled, the <code class="docutils literal notranslate"><span class="pre">ip|udp|tcp|sctp</span></code> parameters of <code class="docutils literal notranslate"><span class="pre">csum</span>&#160; <span class="pre">set</span></code></dt><dd><p>command relate to the outer headers, here <code class="docutils literal notranslate"><span class="pre">ipv4_out</span></code> and <code class="docutils literal notranslate"><span class="pre">udp_out</span></code>.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="csum-show">
<h3><span class="section-number">4.5.40. </span>csum show</h3>
<p>Display tx checksum offload configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; csum show (port_id)
</pre></div>
</div>
</section>
<section id="tso-set">
<h3><span class="section-number">4.5.41. </span>tso set</h3>
<p>Enable TCP Segmentation Offload (TSO) in the <code class="docutils literal notranslate"><span class="pre">csum</span></code> forwarding engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tso set (segsize) (port_id)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Check the NIC datasheet for hardware limits.</p>
</div>
</section>
<section id="tso-show">
<h3><span class="section-number">4.5.42. </span>tso show</h3>
<p>Display the status of TCP Segmentation Offload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tso show (port_id)
</pre></div>
</div>
</section>
<section id="tunnel-tso-set">
<h3><span class="section-number">4.5.43. </span>tunnel tso set</h3>
<p>Set tso segment size of tunneled packets for a port in csum engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tunnel_tso set (tso_segsz) (port_id)
</pre></div>
</div>
</section>
<section id="tunnel-tso-show">
<h3><span class="section-number">4.5.44. </span>tunnel tso show</h3>
<p>Display the status of tunneled TCP Segmentation Offload for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tunnel_tso show (port_id)
</pre></div>
</div>
</section>
<section id="set-port-gro">
<h3><span class="section-number">4.5.45. </span>set port - gro</h3>
<p>Enable or disable GRO in <code class="docutils literal notranslate"><span class="pre">csum</span></code> forwarding engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port &lt;port_id&gt; gro on|off
</pre></div>
</div>
<p>If enabled, the csum forwarding engine will perform GRO on the TCP/IPv4
packets received from the given port.</p>
<p>If disabled, packets received from the given port won’t be performed
GRO. By default, GRO is disabled for all ports.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When enable GRO for a port, TCP/IPv4 packets received from the port
will be performed GRO. After GRO, all merged packets have bad
checksums, since the GRO library doesn’t re-calculate checksums for
the merged packets. Therefore, if users want the merged packets to
have correct checksums, please select HW IP checksum calculation and
HW TCP checksum calculation for the port which the merged packets are
transmitted to.</p>
</div>
</section>
<section id="show-port-gro">
<h3><span class="section-number">4.5.46. </span>show port - gro</h3>
<p>Display GRO configuration for a given port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port &lt;port_id&gt; gro
</pre></div>
</div>
</section>
<section id="set-gro-flush">
<h3><span class="section-number">4.5.47. </span>set gro flush</h3>
<p>Set the cycle to flush the GROed packets from reassembly tables:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set gro flush &lt;cycles&gt;
</pre></div>
</div>
<p>When enable GRO, the csum forwarding engine performs GRO on received
packets, and the GROed packets are stored in reassembly tables. Users
can use this command to determine when the GROed packets are flushed
from the reassembly tables.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cycles</span></code> is measured in GRO operation times. The csum forwarding
engine flushes the GROed packets from the tables every <code class="docutils literal notranslate"><span class="pre">cycles</span></code> GRO
operations.</p>
<p>By default, the value of <code class="docutils literal notranslate"><span class="pre">cycles</span></code> is 1, which means flush GROed packets
from the reassembly tables as soon as one GRO operation finishes. The value
of <code class="docutils literal notranslate"><span class="pre">cycles</span></code> should be in the range of 1 to <code class="docutils literal notranslate"><span class="pre">GRO_MAX_FLUSH_CYCLES</span></code>.</p>
<p>Please note that the large value of <code class="docutils literal notranslate"><span class="pre">cycles</span></code> may cause the poor TCP/IP
stack performance. Because the GROed packets are delayed to arrive the
stack, thus causing more duplicated ACKs and TCP retransmissions.</p>
</section>
<section id="set-port-gso">
<h3><span class="section-number">4.5.48. </span>set port - gso</h3>
<p>Toggle per-port GSO support in <code class="docutils literal notranslate"><span class="pre">csum</span></code> forwarding engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port &lt;port_id&gt; gso on|off
</pre></div>
</div>
<p>If enabled, the csum forwarding engine will perform GSO on supported IPv4
packets, transmitted on the given port.</p>
<p>If disabled, packets transmitted on the given port will not undergo GSO.
By default, GSO is disabled for all ports.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When GSO is enabled on a port, supported IPv4 packets transmitted on that
port undergo GSO. Afterwards, the segmented packets are represented by
multi-segment mbufs; however, the csum forwarding engine doesn’t calculation
of checksums for GSO’d segments in SW. As a result, if users want correct
checksums in GSO segments, they should enable HW checksum calculation for
GSO-enabled ports.</p>
<p>For example, HW checksum calculation for VxLAN GSO’d packets may be enabled
by setting the following options in the csum forwarding engine:</p>
<p>testpmd&gt; csum set outer_ip hw &lt;port_id&gt;</p>
<p>testpmd&gt; csum set ip hw &lt;port_id&gt;</p>
<p>testpmd&gt; csum set tcp hw &lt;port_id&gt;</p>
<p>UDP GSO is the same as IP fragmentation, which treats the UDP header
as the payload and does not modify it during segmentation. That is,
after UDP GSO, only the first output fragment has the original UDP
header. Therefore, users need to enable HW IP checksum calculation
and SW UDP checksum calculation for GSO-enabled ports, if they want
correct checksums for UDP/IPv4 packets.</p>
</div>
</section>
<section id="set-gso-segsz">
<h3><span class="section-number">4.5.49. </span>set gso segsz</h3>
<p>Set the maximum GSO segment size (measured in bytes), which includes the
packet header and the packet payload for GSO-enabled ports (global):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set gso segsz &lt;length&gt;
</pre></div>
</div>
</section>
<section id="show-port-gso">
<h3><span class="section-number">4.5.50. </span>show port - gso</h3>
<p>Display the status of Generic Segmentation Offload for a given port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port &lt;port_id&gt; gso
</pre></div>
</div>
</section>
<section id="mac-addr-add">
<h3><span class="section-number">4.5.51. </span>mac_addr add</h3>
<p>Add an alternative MAC address to a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_addr add (port_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</section>
<section id="mac-addr-remove">
<h3><span class="section-number">4.5.52. </span>mac_addr remove</h3>
<p>Remove a MAC address from a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_addr remove (port_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</section>
<section id="mcast-addr-add">
<h3><span class="section-number">4.5.53. </span>mcast_addr add</h3>
<p>To add the multicast MAC address to/from the set of multicast addresses
filtered by port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mcast_addr add (port_id) (mcast_addr)
</pre></div>
</div>
</section>
<section id="mcast-addr-remove">
<h3><span class="section-number">4.5.54. </span>mcast_addr remove</h3>
<p>To remove the multicast MAC address to/from the set of multicast addresses
filtered by port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mcast_addr remove (port_id) (mcast_addr)
</pre></div>
</div>
</section>
<section id="mcast-addr-flush">
<h3><span class="section-number">4.5.55. </span>mcast_addr flush</h3>
<p>Flush all multicast MAC addresses on port_id:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mcast_addr flush (port_id)
</pre></div>
</div>
</section>
<section id="mac-addr-add-for-vf">
<h3><span class="section-number">4.5.56. </span>mac_addr add (for VF)</h3>
<p>Add an alternative MAC address for a VF to a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_add add port (port_id) vf (vf_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</section>
<section id="mac-addr-set">
<h3><span class="section-number">4.5.57. </span>mac_addr set</h3>
<p>Set the default MAC address for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_addr set (port_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</section>
<section id="mac-addr-set-for-vf">
<h3><span class="section-number">4.5.58. </span>mac_addr set (for VF)</h3>
<p>Set the MAC address for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf mac addr (port_id) (vf_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</section>
<section id="set-eth-peer">
<h3><span class="section-number">4.5.59. </span>set eth-peer</h3>
<p>Set the forwarding peer address for certain port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set eth-peer (port_id) (peer_addr)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--eth-peer</span></code> command-line option.</p>
</section>
<section id="set-port-uta">
<h3><span class="section-number">4.5.60. </span>set port-uta</h3>
<p>Set the unicast hash filter(s) on/off for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) uta (XX:XX:XX:XX:XX:XX|all) (on|off)
</pre></div>
</div>
</section>
<section id="set-promisc">
<h3><span class="section-number">4.5.61. </span>set promisc</h3>
<p>Set the promiscuous mode on for a port or for all ports.
In promiscuous mode packets are not dropped if they aren’t for the specified MAC address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set promisc (port_id|all) (on|off)
</pre></div>
</div>
</section>
<section id="set-allmulti">
<h3><span class="section-number">4.5.62. </span>set allmulti</h3>
<p>Set the allmulti mode for a port or for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set allmulti (port_id|all) (on|off)
</pre></div>
</div>
<p>Same as the ifconfig (8) option. Controls how multicast packets are handled.</p>
</section>
<section id="set-flow-ctrl-rx">
<h3><span class="section-number">4.5.63. </span>set flow_ctrl rx</h3>
<p>Set the link flow control parameter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set flow_ctrl rx (on|off) tx (on|off) (high_water) (low_water) \
         (pause_time) (send_xon) mac_ctrl_frame_fwd (on|off) \
         autoneg (on|off) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">high_water</span></code> (integer): High threshold value to trigger XOFF.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">low_water</span></code> (integer): Low threshold value to trigger XON.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pause_time</span></code> (integer): Pause quota in the Pause frame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">send_xon</span></code> (0/1): Send XON frame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mac_ctrl_frame_fwd</span></code>: Enable receiving MAC control frames.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">autoneg</span></code>: Change the auto-negotiation parameter.</p></li>
</ul>
</section>
<section id="show-flow-control">
<h3><span class="section-number">4.5.64. </span>show flow control</h3>
<p>show the link flow control parameter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port &lt;port_id&gt; flow_ctrl
</pre></div>
</div>
</section>
<section id="set-pfc-ctrl-rx">
<h3><span class="section-number">4.5.65. </span>set pfc_ctrl rx</h3>
<p>Set the priority flow control parameter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set pfc_ctrl rx (on|off) tx (on|off) (high_water) (low_water) \
         (pause_time) (priority) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">high_water</span></code> (integer): High threshold value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">low_water</span></code> (integer): Low threshold value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pause_time</span></code> (integer): Pause quota in the Pause frame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code> (0-7): VLAN User Priority.</p></li>
</ul>
</section>
<section id="set-pfc-queue-ctrl">
<h3><span class="section-number">4.5.66. </span>set pfc_queue_ctrl</h3>
<p>Set the priority flow control parameter on a given Rx and Tx queue of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set pfc_queue_ctrl &lt;port_id&gt; rx (on|off) &lt;tx_qid&gt; &lt;tx_tc&gt; \
         tx (on|off) &lt;rx_qid&gt; &lt;rx_tc&gt; &lt;pause_time&gt;
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tx_qid</span></code> (integer): Tx qid for which <code class="docutils literal notranslate"><span class="pre">tx_tc</span></code> will be applied and traffic
will be paused when PFC frame is received with <code class="docutils literal notranslate"><span class="pre">tx_tc</span></code> enabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tx_tc</span></code> (0-15): TC for which traffic is to be paused for xmit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rx_qid</span></code> (integer): Rx qid for which threshold will be applied and PFC
frame will be generated with <code class="docutils literal notranslate"><span class="pre">tx_tc</span></code> when exceeds the threshold.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rx_tc</span></code> (0-15): TC filled in PFC frame for which remote Tx is to be paused.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pause_time</span></code> (integer): Pause quanta filled in the PFC frame for which
interval, remote Tx will be paused. Valid only if Tx pause is on.</p></li>
</ul>
</section>
<section id="set-rx-queue-available-descriptors-threshold">
<h3><span class="section-number">4.5.67. </span>Set Rx queue available descriptors threshold</h3>
<p>Set available descriptors threshold for a specific Rx queue of port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) rxq (queue_id) avail_thresh (0..99)
</pre></div>
</div>
<p>Use 0 value to disable the threshold and corresponding event.</p>
</section>
<section id="set-stat-qmap">
<h3><span class="section-number">4.5.68. </span>set stat_qmap</h3>
<p>Set statistics mapping (qmapping 0..15) for RX/TX queue on port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set stat_qmap (tx|rx) (port_id) (queue_id) (qmapping)
</pre></div>
</div>
<p>For example, to set rx queue 2 on port 0 to mapping 5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt;set stat_qmap rx 0 2 5
</pre></div>
</div>
</section>
<section id="set-xstats-hide-zero">
<h3><span class="section-number">4.5.69. </span>set xstats-hide-zero</h3>
<p>Set the option to hide zero values for xstats display:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set xstats-hide-zero on|off
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the zero values are displayed for xstats.</p>
</div>
</section>
<section id="set-port-rx-tx-for-vf">
<h3><span class="section-number">4.5.70. </span>set port - rx/tx (for VF)</h3>
<p>Set VF receive/transmit from a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) (rx|tx) (on|off)
</pre></div>
</div>
</section>
<section id="set-port-rx-mode-for-vf">
<h3><span class="section-number">4.5.71. </span>set port - rx mode(for VF)</h3>
<p>Set the VF receive mode of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) \
         rxmode (AUPE|ROPE|BAM|MPE) (on|off)
</pre></div>
</div>
<p>The available receive modes are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AUPE</span></code>: Accepts untagged VLAN.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROPE</span></code>: Accepts unicast hash.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BAM</span></code>: Accepts broadcast packets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPE</span></code>: Accepts all multicast packets.</p></li>
</ul>
</section>
<section id="set-port-tx-rate-for-queue">
<h3><span class="section-number">4.5.72. </span>set port - tx_rate (for Queue)</h3>
<p>Set TX rate limitation for a queue on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) queue (queue_id) rate (rate_value)
</pre></div>
</div>
</section>
<section id="set-port-tx-rate-for-vf">
<h3><span class="section-number">4.5.73. </span>set port - tx_rate (for VF)</h3>
<p>Set TX rate limitation for queues in VF on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) rate (rate_value) queue_mask (queue_mask)
</pre></div>
</div>
</section>
<section id="set-flush-rx">
<h3><span class="section-number">4.5.74. </span>set flush_rx</h3>
<p>Set the flush on RX streams before forwarding.
The default is flush <code class="docutils literal notranslate"><span class="pre">on</span></code>.
Mainly used with PCAP drivers to turn off the default behavior of flushing the first 512 packets on RX streams:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set flush_rx off
</pre></div>
</div>
</section>
<section id="set-link-up">
<h3><span class="section-number">4.5.75. </span>set link up</h3>
<p>Set link up for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set link-up port (port id)
</pre></div>
</div>
</section>
<section id="set-link-down">
<h3><span class="section-number">4.5.76. </span>set link down</h3>
<p>Set link down for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set link-down port (port id)
</pre></div>
</div>
</section>
<section id="e-tag-set">
<h3><span class="section-number">4.5.77. </span>E-tag set</h3>
<p>Enable E-tag insertion for a VF on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set insertion on port-tag-id (value) port (port_id) vf (vf_id)
</pre></div>
</div>
<p>Disable E-tag insertion for a VF on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set insertion off port (port_id) vf (vf_id)
</pre></div>
</div>
<p>Enable/disable E-tag stripping on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set stripping (on|off) port (port_id)
</pre></div>
</div>
<p>Enable/disable E-tag based forwarding on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set forwarding (on|off) port (port_id)
</pre></div>
</div>
</section>
<section id="config-per-port-rx-offloading">
<h3><span class="section-number">4.5.78. </span>config per port Rx offloading</h3>
<p>Enable or disable port Rx offloading on all Rx queues of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id|all) rx_offload (offloading) on|off
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">offloading</span></code>: can be any of these offloading capability:</dt><dd><p>all, vlan_strip, ipv4_cksum, udp_cksum, tcp_cksum, tcp_lro,
qinq_strip, outer_ipv4_cksum, macsec_strip,
vlan_filter, vlan_extend, scatter, timestamp, security,
keep_crc, rss_hash</p>
</dd>
</dl>
</li>
</ul>
<p>This command should be run when the port is stopped, or else it will fail.</p>
</section>
<section id="config-per-queue-rx-offloading">
<h3><span class="section-number">4.5.79. </span>config per queue Rx offloading</h3>
<p>Enable or disable a per queue Rx offloading only on a specific Rx queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) rxq (queue_id) rx_offload (offloading) on|off
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">offloading</span></code>: can be any of these offloading capability:</dt><dd><p>all, vlan_strip, ipv4_cksum, udp_cksum, tcp_cksum, tcp_lro,
qinq_strip, outer_ipv4_cksum, macsec_strip,
vlan_filter, vlan_extend, scatter, timestamp, security,
keep_crc</p>
</dd>
</dl>
</li>
</ul>
<p>This command should be run when the port is stopped, or else it will fail.</p>
</section>
<section id="config-per-port-tx-offloading">
<h3><span class="section-number">4.5.80. </span>config per port Tx offloading</h3>
<p>Enable or disable port Tx offloading on all Tx queues of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id|all) tx_offload (offloading) on|off
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">offloading</span></code>: can be any of these offloading capability:</dt><dd><p>all, vlan_insert, ipv4_cksum, udp_cksum, tcp_cksum,
sctp_cksum, tcp_tso, udp_tso, outer_ipv4_cksum,
qinq_insert, vxlan_tnl_tso, gre_tnl_tso,
ipip_tnl_tso, geneve_tnl_tso, macsec_insert,
mt_lockfree, multi_segs, mbuf_fast_free, security</p>
</dd>
</dl>
</li>
</ul>
<p>This command should be run when the port is stopped, or else it will fail.</p>
</section>
<section id="config-per-queue-tx-offloading">
<h3><span class="section-number">4.5.81. </span>config per queue Tx offloading</h3>
<p>Enable or disable a per queue Tx offloading only on a specific Tx queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) txq (queue_id) tx_offload (offloading) on|off
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">offloading</span></code>: can be any of these offloading capability:</dt><dd><p>all, vlan_insert, ipv4_cksum, udp_cksum, tcp_cksum,
sctp_cksum, tcp_tso, udp_tso, outer_ipv4_cksum,
qinq_insert, vxlan_tnl_tso, gre_tnl_tso,
ipip_tnl_tso, geneve_tnl_tso, macsec_insert,
mt_lockfree, multi_segs, mbuf_fast_free, security</p>
</dd>
</dl>
</li>
</ul>
<p>This command should be run when the port is stopped, or else it will fail.</p>
</section>
<section id="config-per-queue-tx-affinity-mapping">
<h3><span class="section-number">4.5.82. </span>config per queue Tx affinity mapping</h3>
<p>Map a Tx queue with an aggregated port of the DPDK port (specified with port_id):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) txq (queue_id) affinity (value)
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">affinity</span></code>: the number of the aggregated port.</dt><dd><p>When multiple ports are aggregated into a single one,
it allows to choose which port to use for Tx via a queue.</p>
</dd>
</dl>
</li>
</ul>
<p>This command should be run when the port is stopped, otherwise it fails.</p>
</section>
<section id="config-vxlan-encap-outer-layers">
<h3><span class="section-number">4.5.83. </span>Config VXLAN Encap outer layers</h3>
<p>Configure the outer layer to encapsulate a packet inside a VXLAN tunnel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set vxlan ip-version (ipv4|ipv6) vni (vni) udp-src (udp-src) \
udp-dst (udp-dst) ip-src (ip-src) ip-dst (ip-dst) eth-src (eth-src) \
eth-dst (eth-dst)

set vxlan-with-vlan ip-version (ipv4|ipv6) vni (vni) udp-src (udp-src) \
udp-dst (udp-dst) ip-src (ip-src) ip-dst (ip-dst) vlan-tci (vlan-tci) \
eth-src (eth-src) eth-dst (eth-dst)

set vxlan-tos-ttl ip-version (ipv4|ipv6) vni (vni) udp-src (udp-src) \
udp-dst (udp-dst) ip-tos (ip-tos) ip-ttl (ip-ttl) ip-src (ip-src) \
ip-dst (ip-dst) eth-src (eth-src) eth-dst (eth-dst)
</pre></div>
</div>
<p>These commands will set an internal configuration inside testpmd, any following
flow rule using the action vxlan_encap will use the last configuration set.
To have a different encapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-nvgre-encap-outer-layers">
<h3><span class="section-number">4.5.84. </span>Config NVGRE Encap outer layers</h3>
<p>Configure the outer layer to encapsulate a packet inside a NVGRE tunnel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set nvgre ip-version (ipv4|ipv6) tni (tni) ip-src (ip-src) ip-dst (ip-dst) \
       eth-src (eth-src) eth-dst (eth-dst)
set nvgre-with-vlan ip-version (ipv4|ipv6) tni (tni) ip-src (ip-src) \
       ip-dst (ip-dst) vlan-tci (vlan-tci) eth-src (eth-src) eth-dst (eth-dst)
</pre></div>
</div>
<p>These commands will set an internal configuration inside testpmd, any following
flow rule using the action nvgre_encap will use the last configuration set.
To have a different encapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-l2-encap">
<h3><span class="section-number">4.5.85. </span>Config L2 Encap</h3>
<p>Configure the l2 to be used when encapsulating a packet with L2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set l2_encap ip-version (ipv4|ipv6) eth-src (eth-src) eth-dst (eth-dst)
set l2_encap-with-vlan ip-version (ipv4|ipv6) vlan-tci (vlan-tci) \
       eth-src (eth-src) eth-dst (eth-dst)
</pre></div>
</div>
<p>Those commands will set an internal configuration inside testpmd, any following
flow rule using the action l2_encap will use the last configuration set.
To have a different encapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-l2-decap">
<h3><span class="section-number">4.5.86. </span>Config L2 Decap</h3>
<p>Configure the l2 to be removed when decapsulating a packet with L2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set l2_decap ip-version (ipv4|ipv6)
set l2_decap-with-vlan ip-version (ipv4|ipv6)
</pre></div>
</div>
<p>Those commands will set an internal configuration inside testpmd, any following
flow rule using the action l2_decap will use the last configuration set.
To have a different encapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-mplsogre-encap-outer-layers">
<h3><span class="section-number">4.5.87. </span>Config MPLSoGRE Encap outer layers</h3>
<p>Configure the outer layer to encapsulate a packet inside a MPLSoGRE tunnel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set mplsogre_encap ip-version (ipv4|ipv6) label (label) \
       ip-src (ip-src) ip-dst (ip-dst) eth-src (eth-src) eth-dst (eth-dst)
set mplsogre_encap-with-vlan ip-version (ipv4|ipv6) label (label) \
       ip-src (ip-src) ip-dst (ip-dst) vlan-tci (vlan-tci) \
       eth-src (eth-src) eth-dst (eth-dst)
</pre></div>
</div>
<p>These commands will set an internal configuration inside testpmd, any following
flow rule using the action mplsogre_encap will use the last configuration set.
To have a different encapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-mplsogre-decap-outer-layers">
<h3><span class="section-number">4.5.88. </span>Config MPLSoGRE Decap outer layers</h3>
<p>Configure the outer layer to decapsulate MPLSoGRE packet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set mplsogre_decap ip-version (ipv4|ipv6)
set mplsogre_decap-with-vlan ip-version (ipv4|ipv6)
</pre></div>
</div>
<p>These commands will set an internal configuration inside testpmd, any following
flow rule using the action mplsogre_decap will use the last configuration set.
To have a different decapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-mplsoudp-encap-outer-layers">
<h3><span class="section-number">4.5.89. </span>Config MPLSoUDP Encap outer layers</h3>
<p>Configure the outer layer to encapsulate a packet inside a MPLSoUDP tunnel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set mplsoudp_encap ip-version (ipv4|ipv6) label (label) udp-src (udp-src) \
       udp-dst (udp-dst) ip-src (ip-src) ip-dst (ip-dst) \
       eth-src (eth-src) eth-dst (eth-dst)
set mplsoudp_encap-with-vlan ip-version (ipv4|ipv6) label (label) \
       udp-src (udp-src) udp-dst (udp-dst) ip-src (ip-src) ip-dst (ip-dst) \
       vlan-tci (vlan-tci) eth-src (eth-src) eth-dst (eth-dst)
</pre></div>
</div>
<p>These commands will set an internal configuration inside testpmd, any following
flow rule using the action mplsoudp_encap will use the last configuration set.
To have a different encapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-mplsoudp-decap-outer-layers">
<h3><span class="section-number">4.5.90. </span>Config MPLSoUDP Decap outer layers</h3>
<p>Configure the outer layer to decapsulate MPLSoUDP packet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set mplsoudp_decap ip-version (ipv4|ipv6)
set mplsoudp_decap-with-vlan ip-version (ipv4|ipv6)
</pre></div>
</div>
<p>These commands will set an internal configuration inside testpmd, any following
flow rule using the action mplsoudp_decap will use the last configuration set.
To have a different decapsulation header, one of those commands must be called
before the flow rule creation.</p>
</section>
<section id="config-raw-encapsulation">
<h3><span class="section-number">4.5.91. </span>Config Raw Encapsulation</h3>
<p>Configure the raw data to be used when encapsulating a packet by
rte_flow_action_raw_encap:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set raw_encap {index} {item} [/ {item} [...]] / end_set
</pre></div>
</div>
<p>There are multiple global buffers for <code class="docutils literal notranslate"><span class="pre">raw_encap</span></code>, this command will set one
internal buffer index by <code class="docutils literal notranslate"><span class="pre">{index}</span></code>.
If there is no <code class="docutils literal notranslate"><span class="pre">{index}</span></code> specified:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set raw_encap {item} [/ {item} [...]] / end_set
</pre></div>
</div>
<p>the default index <code class="docutils literal notranslate"><span class="pre">0</span></code> is used.
In order to use different encapsulating header, <code class="docutils literal notranslate"><span class="pre">index</span></code> must be specified
during the flow rule creation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 egress pattern eth / ipv4 / end actions
       raw_encap index 2 / end
</pre></div>
</div>
<p>Otherwise the default index <code class="docutils literal notranslate"><span class="pre">0</span></code> is used.</p>
</section>
<section id="config-raw-decapsulation">
<h3><span class="section-number">4.5.92. </span>Config Raw Decapsulation</h3>
<p>Configure the raw data to be used when decapsulating a packet by
rte_flow_action_raw_decap:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set raw_decap {index} {item} [/ {item} [...]] / end_set
</pre></div>
</div>
<p>There are multiple global buffers for <code class="docutils literal notranslate"><span class="pre">raw_decap</span></code>, this command will set
one internal buffer index by <code class="docutils literal notranslate"><span class="pre">{index}</span></code>.
If there is no <code class="docutils literal notranslate"><span class="pre">{index}</span></code> specified:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set raw_decap {item} [/ {item} [...]] / end_set
</pre></div>
</div>
<p>the default index <code class="docutils literal notranslate"><span class="pre">0</span></code> is used.
In order to use different decapsulating header, <code class="docutils literal notranslate"><span class="pre">index</span></code> must be specified
during the flow rule creation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 egress pattern eth / ipv4 / end actions
         raw_encap index 3 / end
</pre></div>
</div>
<p>Otherwise the default index <code class="docutils literal notranslate"><span class="pre">0</span></code> is used.</p>
</section>
<section id="set-fec-mode">
<h3><span class="section-number">4.5.93. </span>Set fec mode</h3>
<p>Set fec mode for a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) fec_mode auto|off|rs|baser|llrs
</pre></div>
</div>
</section>
<section id="config-sample-actions-list">
<h3><span class="section-number">4.5.94. </span>Config Sample actions list</h3>
<p>Configure the sample actions list to be used when sampling a packet by
rte_flow_action_sample:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set sample_actions {index} {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>There are multiple global buffers for <code class="docutils literal notranslate"><span class="pre">sample_actions</span></code>, this command will set
one internal buffer index by <code class="docutils literal notranslate"><span class="pre">{index}</span></code>.</p>
<p>In order to use different sample actions list, <code class="docutils literal notranslate"><span class="pre">index</span></code> must be specified
during the flow rule creation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end actions
       sample ratio 2 index 2 / end
</pre></div>
</div>
<p>Otherwise the default index <code class="docutils literal notranslate"><span class="pre">0</span></code> is used.</p>
</section>
</section>
<section id="port-functions">
<h2><span class="section-number">4.6. </span>Port Functions</h2>
<p>The following sections show functions for configuring ports.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Port configuration changes only become active when forwarding is started/restarted.</p>
</div>
<section id="port-attach">
<span id="id1"></span><h3><span class="section-number">4.6.1. </span>port attach</h3>
<p>Attach a port specified by pci address or virtual device args:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port attach (identifier)
</pre></div>
</div>
<p>To attach a new pci device, the device should be recognized by kernel first.
Then it should be moved under DPDK management.
Finally the port can be attached to testpmd.</p>
<p>For example, to move a pci device using ixgbe under DPDK management:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>Check the status of the available devices.
<span class="go">./usertools/dpdk-devbind.py --status</span>

<span class="go">Network devices using DPDK-compatible driver</span>
<span class="go">============================================</span>
<span class="go">&lt;none&gt;</span>

<span class="go">Network devices using kernel driver</span>
<span class="go">===================================</span>
<span class="go">0000:0a:00.0 &#39;82599ES 10-Gigabit&#39; if=eth2 drv=ixgbe unused=</span>


<span class="gp"># </span>Bind the device to igb_uio.
<span class="go">sudo ./usertools/dpdk-devbind.py -b igb_uio 0000:0a:00.0</span>


<span class="gp"># </span>Recheck the status of the devices.
<span class="go">./usertools/dpdk-devbind.py --status</span>
<span class="go">Network devices using DPDK-compatible driver</span>
<span class="go">============================================</span>
<span class="go">0000:0a:00.0 &#39;82599ES 10-Gigabit&#39; drv=igb_uio unused=</span>
</pre></div>
</div>
<p>To attach a port created by virtual device, above steps are not needed.</p>
<p>For example, to attach a port whose pci address is 0000:0a:00.0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port attach 0000:0a:00.0</span>
<span class="go">Attaching a new port...</span>
<span class="go">EAL: PCI device 0000:0a:00.0 on NUMA socket -1</span>
<span class="go">EAL:   probe driver: 8086:10fb rte_ixgbe_pmd</span>
<span class="go">EAL:   PCI memory mapped at 0x7f83bfa00000</span>
<span class="go">EAL:   PCI memory mapped at 0x7f83bfa80000</span>
<span class="go">PMD: eth_ixgbe_dev_init(): MAC: 2, PHY: 18, SFP+: 5</span>
<span class="go">PMD: eth_ixgbe_dev_init(): port 0 vendorID=0x8086 deviceID=0x10fb</span>
<span class="go">Port 0 is attached. Now total ports is 1</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>For example, to attach a port created by pcap PMD.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port attach net_pcap0</span>
<span class="go">Attaching a new port...</span>
<span class="go">PMD: Initializing pmd_pcap for net_pcap0</span>
<span class="go">PMD: Creating pcap-backed ethdev on numa socket 0</span>
<span class="go">Port 0 is attached. Now total ports is 1</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>In this case, identifier is <code class="docutils literal notranslate"><span class="pre">net_pcap0</span></code>.
This identifier format is the same as <code class="docutils literal notranslate"><span class="pre">--vdev</span></code> format of DPDK applications.</p>
<p>For example, to re-attach a bonding port which has been previously detached,
the mode and slave parameters must be given.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port attach net_bond_0,mode=0,slave=1</span>
<span class="go">Attaching a new port...</span>
<span class="go">EAL: Initializing pmd_bond for net_bond_0</span>
<span class="go">EAL: Create bonding device net_bond_0 on port 0 in mode 0 on socket 0.</span>
<span class="go">Port 0 is attached. Now total ports is 1</span>
<span class="go">Done</span>
</pre></div>
</div>
</section>
<section id="port-detach">
<h3><span class="section-number">4.6.2. </span>port detach</h3>
<p>Detach a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port detach (port_id)
</pre></div>
</div>
<p>Before detaching a port, the port should be stopped and closed.</p>
<p>For example, to detach a pci device port 0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port stop 0</span>
<span class="go">Stopping ports...</span>
<span class="go">Done</span>
<span class="go">testpmd&gt; port close 0</span>
<span class="go">Closing ports...</span>
<span class="go">Done</span>

<span class="go">testpmd&gt; port detach 0</span>
<span class="go">Detaching a port...</span>
<span class="go">EAL: PCI device 0000:0a:00.0 on NUMA socket -1</span>
<span class="go">EAL:   remove driver: 8086:10fb rte_ixgbe_pmd</span>
<span class="go">EAL:   PCI memory unmapped at 0x7f83bfa00000</span>
<span class="go">EAL:   PCI memory unmapped at 0x7f83bfa80000</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>For example, to detach a virtual device port 0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port stop 0</span>
<span class="go">Stopping ports...</span>
<span class="go">Done</span>
<span class="go">testpmd&gt; port close 0</span>
<span class="go">Closing ports...</span>
<span class="go">Done</span>

<span class="go">testpmd&gt; port detach 0</span>
<span class="go">Detaching a port...</span>
<span class="go">PMD: Closing pcap ethdev on numa socket 0</span>
<span class="go">Port &#39;net_pcap0&#39; is detached. Now total ports is 0</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>To remove a pci device completely from the system, first detach the port from testpmd.
Then the device should be moved under kernel management.
Finally the device can be removed using kernel pci hotplug functionality.</p>
<p>For example, to move a pci device under kernel management:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ./usertools/dpdk-devbind.py -b ixgbe 0000:0a:00.0</span>

<span class="go">./usertools/dpdk-devbind.py --status</span>

<span class="go">Network devices using DPDK-compatible driver</span>
<span class="go">============================================</span>
<span class="go">&lt;none&gt;</span>

<span class="go">Network devices using kernel driver</span>
<span class="go">===================================</span>
<span class="go">0000:0a:00.0 &#39;82599ES 10-Gigabit&#39; if=eth2 drv=ixgbe unused=igb_uio</span>
</pre></div>
</div>
<p>To remove a port created by a virtual device, above steps are not needed.</p>
</section>
<section id="port-start">
<h3><span class="section-number">4.6.3. </span>port start</h3>
<p>Start all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port start (port_id|all)
</pre></div>
</div>
</section>
<section id="port-stop">
<h3><span class="section-number">4.6.4. </span>port stop</h3>
<p>Stop all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port stop (port_id|all)
</pre></div>
</div>
</section>
<section id="port-close">
<h3><span class="section-number">4.6.5. </span>port close</h3>
<p>Close all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port close (port_id|all)
</pre></div>
</div>
</section>
<section id="port-reset">
<h3><span class="section-number">4.6.6. </span>port reset</h3>
<p>Reset all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port reset (port_id|all)
</pre></div>
</div>
<p>User should stop port(s) before resetting and (re-)start after reset.</p>
</section>
<section id="port-config-queue-ring-size">
<h3><span class="section-number">4.6.7. </span>port config - queue ring size</h3>
<p>Configure a rx/tx queue ring size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) (rxq|txq) (queue_id) ring_size (value)
</pre></div>
</div>
<p>Only take effect after command that (re-)start the port or command that setup specific queue.</p>
</section>
<section id="port-start-stop-queue">
<h3><span class="section-number">4.6.8. </span>port start/stop queue</h3>
<p>Start/stop a rx/tx queue on a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) (rxq|txq) (queue_id) (start|stop)
</pre></div>
</div>
</section>
<section id="port-config-queue-deferred-start">
<h3><span class="section-number">4.6.9. </span>port config - queue deferred start</h3>
<p>Switch on/off deferred start of a specific port queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) (rxq|txq) (queue_id) deferred_start (on|off)
</pre></div>
</div>
</section>
<section id="port-setup-queue">
<h3><span class="section-number">4.6.10. </span>port setup queue</h3>
<p>Setup a rx/tx queue on a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) (rxq|txq) (queue_id) setup
</pre></div>
</div>
<p>Only take effect when port is started.</p>
</section>
<section id="port-config-speed">
<h3><span class="section-number">4.6.11. </span>port config - speed</h3>
<p>Set the speed and duplex mode for all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id|all) speed (10|100|1000|2500|5000|10000|25000|40000|50000|100000|200000|400000|auto) \
         duplex (half|full|auto)
</pre></div>
</div>
</section>
<section id="port-config-queues-descriptors">
<h3><span class="section-number">4.6.12. </span>port config - queues/descriptors</h3>
<p>Set number of queues/descriptors for rxq, txq, rxd and txd:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all (rxq|txq|rxd|txd) (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--rxq</span></code>, <code class="docutils literal notranslate"><span class="pre">--txq</span></code>, <code class="docutils literal notranslate"><span class="pre">--rxd</span></code> and <code class="docutils literal notranslate"><span class="pre">--txd</span></code> command-line options.</p>
</section>
<section id="port-config-max-pkt-len">
<h3><span class="section-number">4.6.13. </span>port config - max-pkt-len</h3>
<p>Set the maximum packet length:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all max-pkt-len (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--max-pkt-len</span></code> command-line option.</p>
</section>
<section id="port-config-max-lro-pkt-size">
<h3><span class="section-number">4.6.14. </span>port config - max-lro-pkt-size</h3>
<p>Set the maximum LRO aggregated packet size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all max-lro-pkt-size (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--max-lro-pkt-size</span></code> command-line option.</p>
</section>
<section id="port-config-drop-packets">
<h3><span class="section-number">4.6.15. </span>port config - Drop Packets</h3>
<p>Enable or disable packet drop on all RX queues of all ports when no receive buffers available:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all drop-en (on|off)
</pre></div>
</div>
<p>Packet dropping when no receive buffers available is off by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">on</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--enable-drop-en</span></code> command-line option.</p>
</section>
<section id="port-config-rss">
<h3><span class="section-number">4.6.16. </span>port config - RSS</h3>
<dl class="simple">
<dt>Set the RSS (Receive Side Scaling) mode on or off::</dt><dd><dl class="simple">
<dt>testpmd&gt; port config all rss (all|default|level-default|level-outer|level-inner| </dt><dd><p>ip|tcp|udp|sctp|tunnel|vlan|none| ipv4|ipv4-frag|ipv4-tcp|ipv4-udp|ipv4-sctp|ipv4-other| ipv6|ipv6-frag|ipv6-tcp|ipv6-udp|ipv6-sctp| ipv6-other|ipv6-ex|ipv6-tcp-ex|ipv6-udp-ex| l2-payload|port|vxlan|geneve|nvgre|gtpu|eth|s-vlan|c-vlan| esp|ah|l2tpv3|pfcp|pppoe|ecpri|mpls|ipv4-chksum|l4-chksum| l2tpv2|l3-pre96|l3-pre64|l3-pre56|l3-pre48|l3-pre40|l3-pre32| l2-dst-only|l2-src-only|l4-dst-only|l4-src-only|l3-dst-only|l3-src-only|&lt;rsstype_id&gt;)</p>
</dd>
</dl>
</dd>
</dl>
<p>RSS is on by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">all</span></code> option is equivalent to eth|vlan|ip|tcp|udp|sctp|ether|l2tpv3|esp|ah|pfcp|l2tpv2.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">default</span></code> option enables all supported RSS types reported by device info.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">none</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-rss</span></code> command-line option.</p>
</section>
<section id="port-config-rss-reta">
<h3><span class="section-number">4.6.17. </span>port config - RSS Reta</h3>
<p>Set the RSS (Receive Side Scaling) redirection table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all rss reta (hash,queue)[,(hash,queue)]
</pre></div>
</div>
</section>
<section id="port-config-dcb">
<h3><span class="section-number">4.6.18. </span>port config - DCB</h3>
<p>Set the DCB mode for an individual port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) dcb vt (on|off) (traffic_class) pfc (on|off)
</pre></div>
</div>
<p>The traffic class should be 4 or 8.</p>
</section>
<section id="port-config-burst">
<h3><span class="section-number">4.6.19. </span>port config - Burst</h3>
<p>Set the number of packets per burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all burst (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--burst</span></code> command-line option.</p>
</section>
<section id="port-config-threshold">
<h3><span class="section-number">4.6.20. </span>port config - Threshold</h3>
<p>Set thresholds for TX/RX queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all (threshold) (value)
</pre></div>
</div>
<p>Where the threshold type can be:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">txpt:</span></code> Set the prefetch threshold register of the TX rings, 0 &lt;= value &lt;= 255.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txht:</span></code> Set the host threshold register of the TX rings, 0 &lt;= value &lt;= 255.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txwt:</span></code> Set the write-back threshold register of the TX rings, 0 &lt;= value &lt;= 255.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxpt:</span></code> Set the prefetch threshold register of the RX rings, 0 &lt;= value &lt;= 255.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxht:</span></code> Set the host threshold register of the RX rings, 0 &lt;= value &lt;= 255.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxwt:</span></code> Set the write-back threshold register of the RX rings, 0 &lt;= value &lt;= 255.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txfreet:</span></code> Set the transmit free threshold of the TX rings, 0 &lt;= value &lt;= txd.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rxfreet:</span></code> Set the transmit free threshold of the RX rings, 0 &lt;= value &lt;= rxd.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txrst:</span></code> Set the transmit RS bit threshold of TX rings, 0 &lt;= value &lt;= txd.</p></li>
</ul>
<p>These threshold options are also available from the command-line.</p>
</section>
<section id="port-config-pctype-mapping">
<h3><span class="section-number">4.6.21. </span>port config pctype mapping</h3>
<p>Reset pctype mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) pctype mapping reset
</pre></div>
</div>
<p>Update hardware defined pctype to software defined flow type mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) pctype mapping update (pctype_id_0[,pctype_id_1]*) (flow_type_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pctype_id_x</span></code>: hardware pctype id as index of bit in bitmask value of the pctype mapping table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flow_type_id</span></code>: software flow type id as the index of the pctype mapping table.</p></li>
</ul>
</section>
<section id="port-config-input-set">
<h3><span class="section-number">4.6.22. </span>port config input set</h3>
<p>Config RSS/FDIR/FDIR flexible payload input set for some pctype:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) pctype (pctype_id) \
         (hash_inset|fdir_inset|fdir_flx_inset) \
         (get|set|clear) field (field_idx)
</pre></div>
</div>
<p>Clear RSS/FDIR/FDIR flexible payload input set for some pctype:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) pctype (pctype_id) \
         (hash_inset|fdir_inset|fdir_flx_inset) clear all
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pctype_id</span></code>: hardware packet classification types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_idx</span></code>: hardware field index.</p></li>
</ul>
</section>
<section id="port-config-udp-tunnel-port">
<h3><span class="section-number">4.6.23. </span>port config udp_tunnel_port</h3>
<p>Add/remove UDP tunnel port for VXLAN/GENEVE tunneling protocols:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) udp_tunnel_port add|rm vxlan|geneve|vxlan-gpe|ecpri (udp_port)
</pre></div>
</div>
</section>
<section id="port-config-tx-metadata">
<h3><span class="section-number">4.6.24. </span>port config tx_metadata</h3>
<p>Set Tx metadata value per port.
testpmd will add this value to any Tx packet sent from this port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) tx_metadata (value)
</pre></div>
</div>
</section>
<section id="port-config-dynf">
<h3><span class="section-number">4.6.25. </span>port config dynf</h3>
<p>Set/clear dynamic flag per port.
testpmd will register this flag in the mbuf (same registration
for both Tx and Rx). Then set/clear this flag for each Tx
packet sent from this port. The set bit only works for Tx packet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) dynf (name) (set|clear)
</pre></div>
</div>
</section>
<section id="port-config-mtu">
<h3><span class="section-number">4.6.26. </span>port config mtu</h3>
<p>To configure MTU(Maximum Transmission Unit) on devices using testpmd:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config mtu (port_id) (value)
</pre></div>
</div>
</section>
<section id="port-config-rss-hash-key">
<h3><span class="section-number">4.6.27. </span>port config rss hash key</h3>
<p>To configure the RSS hash key used to compute the RSS
hash of input [IP] packets received on port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config &lt;port_id&gt; rss-hash-key (ipv4|ipv4-frag|\
                  ipv4-tcp|ipv4-udp|ipv4-sctp|ipv4-other|\
                  ipv6|ipv6-frag|ipv6-tcp|ipv6-udp|ipv6-sctp|\
                  ipv6-other|l2-payload|ipv6-ex|ipv6-tcp-ex|\
                  ipv6-udp-ex &lt;string of hex digits \
                  (variable length, NIC dependent)&gt;)
</pre></div>
</div>
</section>
<section id="port-cleanup-txq-mbufs">
<h3><span class="section-number">4.6.28. </span>port cleanup txq mbufs</h3>
<p>To cleanup txq mbufs currently cached by driver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port cleanup (port_id) txq (queue_id) (free_cnt)
</pre></div>
</div>
<p>If the value of <code class="docutils literal notranslate"><span class="pre">free_cnt</span></code> is 0, driver should free all cached mbufs.</p>
</section>
</section>
<section id="device-functions">
<h2><span class="section-number">4.7. </span>Device Functions</h2>
<p>The following sections show functions for device operations.</p>
<section id="device-detach">
<h3><span class="section-number">4.7.1. </span>device detach</h3>
<p>Detach a device specified by pci address or virtual device args:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; device detach (identifier)
</pre></div>
</div>
<p>Before detaching a device associated with ports, the ports should be stopped and closed.</p>
<p>For example, to detach a pci device whose address is 0002:03:00.0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; device detach 0002:03:00.0</span>
<span class="go">Removing a device...</span>
<span class="go">Port 1 is now closed</span>
<span class="go">EAL: Releasing pci mapped resource for 0002:03:00.0</span>
<span class="go">EAL: Calling pci_unmap_resource for 0002:03:00.0 at 0x218a050000</span>
<span class="go">EAL: Calling pci_unmap_resource for 0002:03:00.0 at 0x218c050000</span>
<span class="go">Device 0002:03:00.0 is detached</span>
<span class="go">Now total ports is 1</span>
</pre></div>
</div>
<p>For example, to detach a port created by pcap PMD.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; device detach net_pcap0</span>
<span class="go">Removing a device...</span>
<span class="go">Port 0 is now closed</span>
<span class="go">Device net_pcap0 is detached</span>
<span class="go">Now total ports is 0</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>In this case, identifier is <code class="docutils literal notranslate"><span class="pre">net_pcap0</span></code>.
This identifier format is the same as <code class="docutils literal notranslate"><span class="pre">--vdev</span></code> format of DPDK applications.</p>
</section>
</section>
<section id="link-bonding-functions">
<h2><span class="section-number">4.8. </span>Link Bonding Functions</h2>
<p>The Link Bonding functions make it possible to dynamically create and
manage link bonding devices from within testpmd interactive prompt.</p>
<p>See <a class="reference internal" href="../prog_guide/link_bonding_poll_mode_drv_lib.html"><span class="doc">Link Bonding Poll Mode Driver Library</span></a> for more information.</p>
</section>
<section id="traffic-metering-and-policing">
<h2><span class="section-number">4.9. </span>Traffic Metering and Policing</h2>
<p>The following section shows functions for configuring traffic metering and
policing on the ethernet device through the use of generic ethdev API.</p>
<section id="show-port-traffic-management-capability">
<h3><span class="section-number">4.9.1. </span>show port traffic management capability</h3>
<p>Show traffic metering and policing capability of the port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port meter cap (port_id)
</pre></div>
</div>
</section>
<section id="add-port-meter-profile-srtcm-rfc2967">
<h3><span class="section-number">4.9.2. </span>add port meter profile (srTCM rfc2967)</h3>
<p>Add meter profile (srTCM rfc2697) to the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port meter profile srtcm_rfc2697 (port_id) (profile_id) \
(cir) (cbs) (ebs) (packet_mode)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">profile_id</span></code>: ID for the meter profile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cir</span></code>: Committed Information Rate (CIR) (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cbs</span></code>: Committed Burst Size (CBS) (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ebs</span></code>: Excess Burst Size (EBS) (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">packet_mode</span></code>: Packets mode for meter profile.</p></li>
</ul>
</section>
<section id="add-port-meter-profile-trtcm-rfc2968">
<h3><span class="section-number">4.9.3. </span>add port meter profile (trTCM rfc2968)</h3>
<p>Add meter profile (srTCM rfc2698) to the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port meter profile trtcm_rfc2698 (port_id) (profile_id) \
(cir) (pir) (cbs) (pbs) (packet_mode)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">profile_id</span></code>: ID for the meter profile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cir</span></code>: Committed information rate (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pir</span></code>: Peak information rate (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cbs</span></code>: Committed burst size (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pbs</span></code>: Peak burst size (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">packet_mode</span></code>: Packets mode for meter profile.</p></li>
</ul>
</section>
<section id="add-port-meter-profile-trtcm-rfc4115">
<h3><span class="section-number">4.9.4. </span>add port meter profile (trTCM rfc4115)</h3>
<p>Add meter profile (trTCM rfc4115) to the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port meter profile trtcm_rfc4115 (port_id) (profile_id) \
(cir) (eir) (cbs) (ebs) (packet_mode)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">profile_id</span></code>: ID for the meter profile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cir</span></code>: Committed information rate (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eir</span></code>: Excess information rate (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cbs</span></code>: Committed burst size (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ebs</span></code>: Excess burst size (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">packet_mode</span></code>: Packets mode for meter profile.</p></li>
</ul>
</section>
<section id="delete-port-meter-profile">
<h3><span class="section-number">4.9.5. </span>delete port meter profile</h3>
<p>Delete meter profile from the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port meter profile (port_id) (profile_id)
</pre></div>
</div>
</section>
<section id="create-port-policy">
<h3><span class="section-number">4.9.6. </span>create port policy</h3>
<p>Create new policy object for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port meter policy (port_id) (policy_id) g_actions \
{action} y_actions {action} r_actions {action}
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">policy_id</span></code>: policy ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">action</span></code>: action lists for green/yellow/red colors.</p></li>
</ul>
</section>
<section id="delete-port-policy">
<h3><span class="section-number">4.9.7. </span>delete port policy</h3>
<p>Delete policy object for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port meter policy (port_id) (policy_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">policy_id</span></code>: policy ID.</p></li>
</ul>
</section>
<section id="create-port-meter">
<h3><span class="section-number">4.9.8. </span>create port meter</h3>
<p>Create new meter object for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; create port meter (port_id) (mtr_id) (profile_id) \
(policy_id) (meter_enable) (stats_mask) (shared) (default_input_color) \
(use_pre_meter_color) [(dscp_tbl_entry0) (dscp_tbl_entry1)...\
(dscp_tbl_entry63)] [(vlan_tbl_entry0) (vlan_tbl_entry1) ... \
(vlan_tbl_entry15)]
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mtr_id</span></code>: meter object ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">profile_id</span></code>: ID for the meter profile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">policy_id</span></code>: ID for the policy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meter_enable</span></code>: When this parameter has a non-zero value, the meter object
gets enabled at the time of creation, otherwise remains disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats_mask</span></code>: Mask of statistics counter types to be enabled for the
meter object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shared</span></code>:  When this parameter has a non-zero value, the meter object is
shared by multiple flows. Otherwise, meter object is used by single flow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_input_color</span></code>:  Default input color for incoming packets.
If incoming packet misses DSCP or VLAN input color table then it will be used
as input color.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_pre_meter_color</span></code>: When this parameter has a non-zero value, the
input color for the current meter object is determined by the latest meter
object in the same flow. Otherwise, the current meter object uses the
<em>dscp_table</em> to determine the input color.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dscp_tbl_entryx</span></code>: DSCP table entry x providing meter providing input
color, 0 &lt;= x &lt;= 63.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vlan_tbl_entryx</span></code>: VLAN table entry x providing meter input color,
0 &lt;= x &lt;= 15.</p></li>
</ul>
</section>
<section id="enable-port-meter">
<h3><span class="section-number">4.9.9. </span>enable port meter</h3>
<p>Enable meter for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; enable port meter (port_id) (mtr_id)
</pre></div>
</div>
</section>
<section id="disable-port-meter">
<h3><span class="section-number">4.9.10. </span>disable port meter</h3>
<p>Disable meter for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; disable port meter (port_id) (mtr_id)
</pre></div>
</div>
</section>
<section id="delete-port-meter">
<h3><span class="section-number">4.9.11. </span>delete port meter</h3>
<p>Delete meter for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port meter (port_id) (mtr_id)
</pre></div>
</div>
</section>
<section id="set-port-meter-profile">
<h3><span class="section-number">4.9.12. </span>Set port meter profile</h3>
<p>Set meter profile for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port meter profile (port_id) (mtr_id) (profile_id)
</pre></div>
</div>
</section>
<section id="set-port-meter-dscp-table">
<h3><span class="section-number">4.9.13. </span>set port meter dscp table</h3>
<p>Set meter dscp table for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port meter dscp table (port_id) (mtr_id) (proto) \
[(dscp_tbl_entry0) (dscp_tbl_entry1)...(dscp_tbl_entry63)]
</pre></div>
</div>
</section>
<section id="set-port-meter-vlan-table">
<h3><span class="section-number">4.9.14. </span>set port meter vlan table</h3>
<p>Set meter VLAN table for the Ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port meter vlan table (port_id) (mtr_id) (proto) \
[(vlan_tbl_entry0) (vlan_tbl_entry1)...(vlan_tbl_entry15)]
</pre></div>
</div>
</section>
<section id="set-port-meter-protocol">
<h3><span class="section-number">4.9.15. </span>set port meter protocol</h3>
<p>Set meter protocol and corresponding priority:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port meter proto (port_id) (mtr_id) (proto) (prio)
</pre></div>
</div>
</section>
<section id="get-port-meter-protocol">
<h3><span class="section-number">4.9.16. </span>get port meter protocol</h3>
<p>Get meter protocol:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; get port meter proto (port_id) (mtr_id)
</pre></div>
</div>
</section>
<section id="get-port-meter-protocol-priority">
<h3><span class="section-number">4.9.17. </span>get port meter protocol priority</h3>
<p>Get priority associated to meter protocol:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; get port meter proto_prio (port_id) (mtr_id) (proto)
</pre></div>
</div>
</section>
<section id="set-port-meter-stats-mask">
<h3><span class="section-number">4.9.18. </span>set port meter stats mask</h3>
<p>Set meter stats mask for the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port meter stats mask (port_id) (mtr_id) (stats_mask)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stats_mask</span></code>: Bit mask indicating statistics counter types to be enabled.</p></li>
</ul>
</section>
<section id="show-port-meter-stats">
<h3><span class="section-number">4.9.19. </span>show port meter stats</h3>
<p>Show meter stats of the ethernet device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port meter stats (port_id) (mtr_id) (clear)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">clear</span></code>: Flag that indicates whether the statistics counters should
be cleared (i.e. set to zero) immediately after they have been read or not.</p></li>
</ul>
</section>
</section>
<section id="traffic-management">
<h2><span class="section-number">4.10. </span>Traffic Management</h2>
<p>The following section shows functions for configuring traffic management on
the ethernet device through the use of generic TM API.</p>
<section id="id2">
<h3><span class="section-number">4.10.1. </span>show port traffic management capability</h3>
<p>Show traffic management capability of the port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port tm cap (port_id)
</pre></div>
</div>
</section>
<section id="show-port-traffic-management-capability-hierarchy-level">
<h3><span class="section-number">4.10.2. </span>show port traffic management capability (hierarchy level)</h3>
<p>Show traffic management hierarchy level capability of the port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port tm level cap (port_id) (level_id)
</pre></div>
</div>
</section>
<section id="show-port-traffic-management-capability-hierarchy-node-level">
<h3><span class="section-number">4.10.3. </span>show port traffic management capability (hierarchy node level)</h3>
<p>Show the traffic management hierarchy node capability of the port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port tm node cap (port_id) (node_id)
</pre></div>
</div>
</section>
<section id="show-port-traffic-management-hierarchy-node-type">
<h3><span class="section-number">4.10.4. </span>show port traffic management hierarchy node type</h3>
<p>Show the port traffic management hierarchy node type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port tm node type (port_id) (node_id)
</pre></div>
</div>
</section>
<section id="show-port-traffic-management-hierarchy-node-stats">
<h3><span class="section-number">4.10.5. </span>show port traffic management hierarchy node stats</h3>
<p>Show the port traffic management hierarchy node statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port tm node stats (port_id) (node_id) (clear)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">clear</span></code>: When this parameter has a non-zero value, the statistics counters
are cleared (i.e. set to zero) immediately after they have been read,
otherwise the statistics counters are left untouched.</p></li>
</ul>
</section>
<section id="add-port-traffic-management-private-shaper-profile">
<h3><span class="section-number">4.10.6. </span>Add port traffic management private shaper profile</h3>
<p>Add the port traffic management private shaper profile:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port tm node shaper profile (port_id) (shaper_profile_id) \
(cmit_tb_rate) (cmit_tb_size) (peak_tb_rate) (peak_tb_size) \
(packet_length_adjust) (packet_mode)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile</span> <span class="pre">id</span></code>: Shaper profile ID for the new profile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmit_tb_rate</span></code>: Committed token bucket rate (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmit_tb_size</span></code>: Committed token bucket size (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peak_tb_rate</span></code>: Peak token bucket rate (bytes per second or packets per second).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peak_tb_size</span></code>: Peak token bucket size (bytes or packets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">packet_length_adjust</span></code>: The value (bytes) to be added to the length of
each packet for the purpose of shaping. This parameter value can be used to
correct the packet length with the framing overhead bytes that are consumed
on the wire.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">packet_mode</span></code>: Shaper configured in packet mode. This parameter value if
zero, configures shaper in byte mode and if non-zero configures it in packet
mode.</p></li>
</ul>
</section>
<section id="delete-port-traffic-management-private-shaper-profile">
<h3><span class="section-number">4.10.7. </span>Delete port traffic management private shaper profile</h3>
<p>Delete the port traffic management private shaper:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port tm node shaper profile (port_id) (shaper_profile_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile</span> <span class="pre">id</span></code>: Shaper profile ID that needs to be deleted.</p></li>
</ul>
</section>
<section id="add-port-traffic-management-shared-shaper">
<h3><span class="section-number">4.10.8. </span>Add port traffic management shared shaper</h3>
<p>Create the port traffic management shared shaper:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port tm node shared shaper (port_id) (shared_shaper_id) \
(shaper_profile_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shared_shaper_id</span></code>: Shared shaper ID to be created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile</span> <span class="pre">id</span></code>: Shaper profile ID for shared shaper.</p></li>
</ul>
</section>
<section id="set-port-traffic-management-shared-shaper">
<h3><span class="section-number">4.10.9. </span>Set port traffic management shared shaper</h3>
<p>Update the port traffic management shared shaper:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port tm node shared shaper (port_id) (shared_shaper_id) \
(shaper_profile_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shared_shaper_id</span></code>: Shared shaper ID to be update.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile</span> <span class="pre">id</span></code>: Shaper profile ID for shared shaper.</p></li>
</ul>
</section>
<section id="delete-port-traffic-management-shared-shaper">
<h3><span class="section-number">4.10.10. </span>Delete port traffic management shared shaper</h3>
<p>Delete the port traffic management shared shaper:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port tm node shared shaper (port_id) (shared_shaper_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shared_shaper_id</span></code>: Shared shaper ID to be deleted.</p></li>
</ul>
</section>
<section id="set-port-traffic-management-hierarchy-node-private-shaper">
<h3><span class="section-number">4.10.11. </span>Set port traffic management hierarchy node private shaper</h3>
<p>set the port traffic management hierarchy node private shaper:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port tm node shaper profile (port_id) (node_id) \
(shaper_profile_id)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile</span> <span class="pre">id</span></code>: Private shaper profile ID to be enabled on the
hierarchy node.</p></li>
</ul>
</section>
<section id="add-port-traffic-management-wred-profile">
<h3><span class="section-number">4.10.12. </span>Add port traffic management WRED profile</h3>
<p>Create a new WRED profile:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port tm node wred profile (port_id) (wred_profile_id) \
(color_g) (min_th_g) (max_th_g) (maxp_inv_g) (wq_log2_g) \
(color_y) (min_th_y) (max_th_y) (maxp_inv_y) (wq_log2_y) \
(color_r) (min_th_r) (max_th_r) (maxp_inv_r) (wq_log2_r)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wred_profile</span> <span class="pre">id</span></code>: Identifier for the newly create WRED profile</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">color_g</span></code>: Packet color (green)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_th_g</span></code>: Minimum queue threshold for packet with green color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_th_g</span></code>: Minimum queue threshold for packet with green color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxp_inv_g</span></code>: Inverse of packet marking probability maximum value (maxp)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wq_log2_g</span></code>: Negated log2 of queue weight (wq)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">color_y</span></code>: Packet color (yellow)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_th_y</span></code>: Minimum queue threshold for packet with yellow color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_th_y</span></code>: Minimum queue threshold for packet with yellow color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxp_inv_y</span></code>: Inverse of packet marking probability maximum value (maxp)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wq_log2_y</span></code>: Negated log2 of queue weight (wq)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">color_r</span></code>: Packet color (red)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_th_r</span></code>: Minimum queue threshold for packet with yellow color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_th_r</span></code>: Minimum queue threshold for packet with yellow color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxp_inv_r</span></code>: Inverse of packet marking probability maximum value (maxp)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wq_log2_r</span></code>: Negated log2 of queue weight (wq)</p></li>
</ul>
</section>
<section id="delete-port-traffic-management-wred-profile">
<h3><span class="section-number">4.10.13. </span>Delete port traffic management WRED profile</h3>
<p>Delete the WRED profile:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port tm node wred profile (port_id) (wred_profile_id)
</pre></div>
</div>
</section>
<section id="add-port-traffic-management-hierarchy-nonleaf-node">
<h3><span class="section-number">4.10.14. </span>Add port traffic management hierarchy nonleaf node</h3>
<p>Add nonleaf node to port traffic management hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port tm nonleaf node (port_id) (node_id) (parent_node_id) \
(priority) (weight) (level_id) (shaper_profile_id) \
(n_sp_priorities) (stats_mask) (n_shared_shapers) \
[(shared_shaper_0) (shared_shaper_1) ...] \
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parent_node_id</span></code>: Node ID of the parent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code>: Node priority (highest node priority is zero). This is used by
the SP algorithm running on the parent node for scheduling this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight</span></code>: Node weight (lowest weight is one). The node weight is relative
to the weight sum of all siblings that have the same priority. It is used by
the WFQ algorithm running on the parent node for scheduling this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level_id</span></code>: Hierarchy level of the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile_id</span></code>: Shaper profile ID of the private shaper to be used by
the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_sp_priorities</span></code>: Number of strict priorities.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats_mask</span></code>: Mask of statistics counter types to be enabled for this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_shared_shapers</span></code>: Number of shared shapers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shared_shaper_id</span></code>: Shared shaper id.</p></li>
</ul>
</section>
<section id="add-port-traffic-management-hierarchy-nonleaf-node-with-packet-mode">
<h3><span class="section-number">4.10.15. </span>Add port traffic management hierarchy nonleaf node with packet mode</h3>
<p>Add nonleaf node with packet mode to port traffic management hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port tm nonleaf node pktmode (port_id) (node_id) (parent_node_id) \
(priority) (weight) (level_id) (shaper_profile_id) \
(n_sp_priorities) (stats_mask) (n_shared_shapers) \
[(shared_shaper_0) (shared_shaper_1) ...] \
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parent_node_id</span></code>: Node ID of the parent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code>: Node priority (highest node priority is zero). This is used by
the SP algorithm running on the parent node for scheduling this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight</span></code>: Node weight (lowest weight is one). The node weight is relative
to the weight sum of all siblings that have the same priority. It is used by
the WFQ algorithm running on the parent node for scheduling this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level_id</span></code>: Hierarchy level of the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile_id</span></code>: Shaper profile ID of the private shaper to be used by
the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_sp_priorities</span></code>: Number of strict priorities. Packet mode is enabled on
all of them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats_mask</span></code>: Mask of statistics counter types to be enabled for this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_shared_shapers</span></code>: Number of shared shapers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shared_shaper_id</span></code>: Shared shaper id.</p></li>
</ul>
</section>
<section id="add-port-traffic-management-hierarchy-leaf-node">
<h3><span class="section-number">4.10.16. </span>Add port traffic management hierarchy leaf node</h3>
<p>Add leaf node to port traffic management hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port tm leaf node (port_id) (node_id) (parent_node_id) \
(priority) (weight) (level_id) (shaper_profile_id) \
(cman_mode) (wred_profile_id) (stats_mask) (n_shared_shapers) \
[(shared_shaper_id) (shared_shaper_id) ...] \
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parent_node_id</span></code>: Node ID of the parent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code>: Node priority (highest node priority is zero). This is used by
the SP algorithm running on the parent node for scheduling this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight</span></code>: Node weight (lowest weight is one). The node weight is relative
to the weight sum of all siblings that have the same priority. It is used by
the WFQ algorithm running on the parent node for scheduling this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level_id</span></code>: Hierarchy level of the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shaper_profile_id</span></code>: Shaper profile ID of the private shaper to be used by
the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cman_mode</span></code>: Congestion management mode to be enabled for this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wred_profile_id</span></code>: WRED profile id to be enabled for this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats_mask</span></code>: Mask of statistics counter types to be enabled for this node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_shared_shapers</span></code>: Number of shared shapers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shared_shaper_id</span></code>: Shared shaper id.</p></li>
</ul>
</section>
<section id="delete-port-traffic-management-hierarchy-node">
<h3><span class="section-number">4.10.17. </span>Delete port traffic management hierarchy node</h3>
<p>Delete node from port traffic management hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; del port tm node (port_id) (node_id)
</pre></div>
</div>
</section>
<section id="update-port-traffic-management-hierarchy-parent-node">
<h3><span class="section-number">4.10.18. </span>Update port traffic management hierarchy parent node</h3>
<p>Update port traffic management hierarchy parent node:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port tm node parent (port_id) (node_id) (parent_node_id) \
(priority) (weight)
</pre></div>
</div>
<p>This function can only be called after the hierarchy commit invocation. Its
success depends on the port support for this operation, as advertised through
the port capability set. This function is valid for all nodes of the traffic
management hierarchy except root node.</p>
</section>
<section id="suspend-port-traffic-management-hierarchy-node">
<h3><span class="section-number">4.10.19. </span>Suspend port traffic management hierarchy node</h3>
<blockquote>
<div><p>testpmd&gt; suspend port tm node (port_id) (node_id)</p>
</div></blockquote>
</section>
<section id="resume-port-traffic-management-hierarchy-node">
<h3><span class="section-number">4.10.20. </span>Resume port traffic management hierarchy node</h3>
<blockquote>
<div><p>testpmd&gt; resume port tm node (port_id) (node_id)</p>
</div></blockquote>
</section>
<section id="commit-port-traffic-management-hierarchy">
<h3><span class="section-number">4.10.21. </span>Commit port traffic management hierarchy</h3>
<p>Commit the traffic management hierarchy on the port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port tm hierarchy commit (port_id) (clean_on_fail)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">clean_on_fail</span></code>: When set to non-zero, hierarchy is cleared on function
call failure. On the other hand, hierarchy is preserved when this parameter
is equal to zero.</p></li>
</ul>
</section>
<section id="set-port-traffic-management-mark-vlan-dei">
<h3><span class="section-number">4.10.22. </span>Set port traffic management mark VLAN dei</h3>
<p>Enables/Disables the traffic management marking on the port for VLAN packets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port tm mark vlan_dei &lt;port_id&gt; &lt;green&gt; &lt;yellow&gt; &lt;red&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which on which VLAN packets marked as <code class="docutils literal notranslate"><span class="pre">green</span></code> or
<code class="docutils literal notranslate"><span class="pre">yellow</span></code> or <code class="docutils literal notranslate"><span class="pre">red</span></code> will have dei bit enabled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">green</span></code> enable 1, disable 0 marking for dei bit of VLAN packets marked as green</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yellow</span></code> enable 1, disable 0 marking for dei bit of VLAN packets marked as yellow</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">red</span></code> enable 1, disable 0 marking for dei bit of VLAN packets marked as red</p></li>
</ul>
</section>
<section id="set-port-traffic-management-mark-ip-dscp">
<h3><span class="section-number">4.10.23. </span>Set port traffic management mark IP dscp</h3>
<p>Enables/Disables the traffic management marking on the port for IP dscp packets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port tm mark ip_dscp &lt;port_id&gt; &lt;green&gt; &lt;yellow&gt; &lt;red&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which on which IP packets marked as <code class="docutils literal notranslate"><span class="pre">green</span></code> or
<code class="docutils literal notranslate"><span class="pre">yellow</span></code> or <code class="docutils literal notranslate"><span class="pre">red</span></code> will have IP dscp bits updated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">green</span></code> enable 1, disable 0 marking IP dscp to low drop precedence for green packets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yellow</span></code> enable 1, disable 0 marking IP dscp to medium drop precedence for yellow packets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">red</span></code> enable 1, disable 0 marking IP dscp to high drop precedence for red packets</p></li>
</ul>
</section>
<section id="set-port-traffic-management-mark-ip-ecn">
<h3><span class="section-number">4.10.24. </span>Set port traffic management mark IP ecn</h3>
<p>Enables/Disables the traffic management marking on the port for IP ecn packets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port tm mark ip_ecn &lt;port_id&gt; &lt;green&gt; &lt;yellow&gt; &lt;red&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which on which IP packets marked as <code class="docutils literal notranslate"><span class="pre">green</span></code> or
<code class="docutils literal notranslate"><span class="pre">yellow</span></code> or <code class="docutils literal notranslate"><span class="pre">red</span></code> will have IP ecn bits updated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">green</span></code> enable 1, disable 0 marking IP ecn for green marked packets with ecn of 2’b01  or 2’b10
to ecn of 2’b11 when IP is caring TCP or SCTP</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yellow</span></code> enable 1, disable 0 marking IP ecn for yellow marked packets with ecn of 2’b01  or 2’b10
to ecn of 2’b11 when IP is caring TCP or SCTP</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">red</span></code> enable 1, disable 0 marking IP ecn for yellow marked packets with ecn of 2’b01  or 2’b10
to ecn of 2’b11 when IP is caring TCP or SCTP</p></li>
</ul>
</section>
</section>
<section id="congestion-management">
<h2><span class="section-number">4.11. </span>Congestion Management</h2>
<section id="get-capabilities">
<h3><span class="section-number">4.11.1. </span>Get capabilities</h3>
<p>Retrieve congestion management capabilities supported by driver for given port.
Below example command retrieves capabilities for port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port cman capa 0
</pre></div>
</div>
</section>
<section id="get-configuration">
<h3><span class="section-number">4.11.2. </span>Get configuration</h3>
<p>Retrieve congestion management configuration for given port.
Below example command retrieves configuration for port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port cman config 0
</pre></div>
</div>
</section>
<section id="set-configuration">
<h3><span class="section-number">4.11.3. </span>Set configuration</h3>
<p>Configures congestion management settings on given queue
or mempool associated with queue.
Below example command configures RED as congestion management algorithm
for port 0 and queue 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port cman config 0 0 obj queue mode red 10 100 1
</pre></div>
</div>
</section>
</section>
<section id="filter-functions">
<h2><span class="section-number">4.12. </span>Filter Functions</h2>
<p>This section details the available filter functions that are available.</p>
<p>Note these functions interface the deprecated legacy filtering framework,
superseded by <em>rte_flow</em>. See <a class="reference internal" href="#flow-rules-management">Flow rules management</a>.</p>
</section>
<section id="flow-rules-management">
<span id="testpmd-rte-flow"></span><h2><span class="section-number">4.13. </span>Flow rules management</h2>
<p>Control of the generic flow API (<em>rte_flow</em>) is fully exposed through the
<code class="docutils literal notranslate"><span class="pre">flow</span></code> command (configuration, validation, creation, destruction, queries
and operation modes).</p>
<p>Considering <em>rte_flow</em> overlaps with all <a class="reference internal" href="#filter-functions">Filter Functions</a>, using both
features simultaneously may cause undefined side-effects and is therefore
not recommended.</p>
<section id="flow-syntax">
<h3><span class="section-number">4.13.1. </span><code class="docutils literal notranslate"><span class="pre">flow</span></code> syntax</h3>
<p>Because the <code class="docutils literal notranslate"><span class="pre">flow</span></code> command uses dynamic tokens to handle the large number
of possible flow rules combinations, its behavior differs slightly from
other commands, in particular:</p>
<ul class="simple">
<li><p>Pressing <em>?</em> or the <em>&lt;tab&gt;</em> key displays contextual help for the current
token, not that of the entire command.</p></li>
<li><p>Optional and repeated parameters are supported (provided they are listed
in the contextual help).</p></li>
</ul>
<p>The first parameter stands for the operation mode. Possible operations and
their general syntax are described below. They are covered in detail in the
following sections.</p>
<ul>
<li><p>Get info about flow engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow info {port_id}
</pre></div>
</div>
</li>
<li><p>Configure flow engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow configure {port_id}
    [queues_number {number}] [queues_size {size}]
    [counters_number {number}]
    [aging_counters_number {number}]
    [meters_number {number}] [flags {number}]
</pre></div>
</div>
</li>
<li><p>Create a pattern template:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow pattern_template {port_id} create [pattern_template_id {id}]
    [relaxed {boolean}] [ingress] [egress] [transfer]
    template {item} [/ {item} [...]] / end
</pre></div>
</div>
</li>
<li><p>Destroy a pattern template:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow pattern_template {port_id} destroy pattern_template {id} [...]
</pre></div>
</div>
</li>
<li><p>Create an actions template:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow actions_template {port_id} create [actions_template_id {id}]
    [ingress] [egress] [transfer]
    template {action} [/ {action} [...]] / end
    mask {action} [/ {action} [...]] / end
</pre></div>
</div>
</li>
<li><p>Destroy an actions template:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow actions_template {port_id} destroy actions_template {id} [...]
</pre></div>
</div>
</li>
<li><p>Create a table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow table {port_id} create
    [table_id {id}]
    [group {group_id}] [priority {level}] [ingress] [egress] [transfer]
    rules_number {number}
    pattern_template {pattern_template_id}
    actions_template {actions_template_id}
</pre></div>
</div>
</li>
<li><p>Destroy a table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow table {port_id} destroy table {id} [...]
</pre></div>
</div>
</li>
<li><p>Check whether a flow rule can be created:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow validate {port_id}
    [group {group_id}] [priority {level}] [ingress] [egress] [transfer]
    pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
</li>
<li><p>Enqueue creation of a flow rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} create {queue_id}
    [postpone {boolean}] template_table {table_id}
    pattern_template {pattern_template_index}
    actions_template {actions_template_index}
    pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
</li>
<li><p>Enqueue destruction of specific flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} destroy {queue_id}
    [postpone {boolean}] rule {rule_id} [...]
</pre></div>
</div>
</li>
<li><p>Push enqueued operations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow push {port_id} queue {queue_id}
</pre></div>
</div>
</li>
<li><p>Pull all operations results from a queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow pull {port_id} queue {queue_id}
</pre></div>
</div>
</li>
<li><p>Create a flow rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow create {port_id}
    [group {group_id}] [priority {level}] [ingress] [egress]
    [transfer] [tunnel_set {tunnel_id}] [tunnel_match {tunnel_id}]
    [user_id {user_id}] pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
</li>
<li><p>Destroy specific flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow destroy {port_id} rule {rule_id} [...] [user_id]
</pre></div>
</div>
</li>
<li><p>Destroy all flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow flush {port_id}
</pre></div>
</div>
</li>
<li><p>Query an existing flow rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow query {port_id} {rule_id} {action} [user_id]
</pre></div>
</div>
</li>
<li><p>List existing flow rules sorted by priority, filtered by group
identifiers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow list {port_id} [group {group_id}] [...]
</pre></div>
</div>
</li>
<li><p>Restrict ingress traffic to the defined flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow isolate {port_id} {boolean}
</pre></div>
</div>
</li>
<li><p>Dump internal representation information of all flows in hardware:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow dump {port_id} all {output_file} [user_id]
</pre></div>
</div>
<p>for one flow:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow dump {port_id} rule {rule_id} {output_file} [user_id]
</pre></div>
</div>
</li>
<li><p>List and destroy aged flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow aged {port_id} [destroy]
</pre></div>
</div>
</li>
<li><p>Enqueue list and destroy aged flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} aged {queue_id} [destroy]
</pre></div>
</div>
</li>
<li><p>Tunnel offload - create a tunnel stub:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow tunnel create {port_id} type {tunnel_type}
</pre></div>
</div>
</li>
<li><p>Tunnel offload - destroy a tunnel stub:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow tunnel destroy {port_id} id {tunnel_id}
</pre></div>
</div>
</li>
<li><p>Tunnel offload - list port tunnel stubs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow tunnel list {port_id}
</pre></div>
</div>
</li>
</ul>
</section>
<section id="retrieving-info-about-flow-management-engine">
<h3><span class="section-number">4.13.2. </span>Retrieving info about flow management engine</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">info</span></code> retrieves info on pre-configurable resources in the underlying
device to give a hint of possible values for flow engine configuration.</p>
<p><code class="docutils literal notranslate"><span class="pre">rte_flow_info_get()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow info {port_id}
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow engine resources on port #[...]:
Number of queues: #[...]
Size of queues: #[...]
Number of counters: #[...]
Number of aging objects: #[...]
Number of meters: #[...]
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="configuring-flow-management-engine">
<h3><span class="section-number">4.13.3. </span>Configuring flow management engine</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">configure</span></code> pre-allocates all the needed resources in the underlying
device to be used later at the flow creation. Flow queues are allocated as well
for asynchronous flow creation/destruction operations. It is bound to
<code class="docutils literal notranslate"><span class="pre">rte_flow_configure()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow configure {port_id}
    [queues_number {number}] [queues_size {size}]
    [counters_number {number}]
    [aging_counters_number {number}]
    [host_port {number}]
    [meters_number {number}]
    [flags {number}]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Configure flows on port #[...]: number of queues #[...] with #[...] elements
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="creating-pattern-templates">
<h3><span class="section-number">4.13.4. </span>Creating pattern templates</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">pattern_template</span> <span class="pre">create</span></code> creates the specified pattern template.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_pattern_template_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow pattern_template {port_id} create [pattern_template_id {id}]
    [relaxed {boolean}] [ingress] [egress] [transfer]
        template {item} [/ {item} [...]] / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pattern template #[...] created
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same pattern items as <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>,
their format is described in <a class="reference internal" href="#creating-flow-rules">Creating flow rules</a>.</p>
</section>
<section id="destroying-pattern-templates">
<h3><span class="section-number">4.13.5. </span>Destroying pattern templates</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">pattern_template</span> <span class="pre">destroy</span></code> destroys one or more pattern templates
from their template ID (as returned by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">pattern_template</span> <span class="pre">create</span></code>),
this command calls <code class="docutils literal notranslate"><span class="pre">rte_flow_pattern_template_destroy()</span></code> as many
times as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow pattern_template {port_id} destroy pattern_template {id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pattern template #[...] destroyed
</pre></div>
</div>
<p>It does not report anything for pattern template IDs that do not exist.
The usual error message is shown when a pattern template cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="creating-actions-templates">
<h3><span class="section-number">4.13.6. </span>Creating actions templates</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">actions_template</span> <span class="pre">create</span></code> creates the specified actions template.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_actions_template_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow actions_template {port_id} create [actions_template_id {id}]
    [ingress] [egress] [transfer]
        template {action} [/ {action} [...]] / end
    mask {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Actions template #[...] created
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same actions as <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>,
their format is described in <a class="reference internal" href="#creating-flow-rules">Creating flow rules</a>.</p>
</section>
<section id="destroying-actions-templates">
<h3><span class="section-number">4.13.7. </span>Destroying actions templates</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">actions_template</span> <span class="pre">destroy</span></code> destroys one or more actions templates
from their template ID (as returned by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">actions_template</span> <span class="pre">create</span></code>),
this command calls <code class="docutils literal notranslate"><span class="pre">rte_flow_actions_template_destroy()</span></code> as many
times as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow actions_template {port_id} destroy actions_template {id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Actions template #[...] destroyed
</pre></div>
</div>
<p>It does not report anything for actions template IDs that do not exist.
The usual error message is shown when an actions template cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="creating-template-table">
<h3><span class="section-number">4.13.8. </span>Creating template table</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">template_table</span> <span class="pre">create</span></code> creates the specified template table.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_template_table_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow template_table {port_id} create
    [table_id {id}] [group {group_id}]
    [priority {level}] [ingress] [egress]
    [transfer [vport_orig] [wire_orig]]
    rules_number {number}
    pattern_template {pattern_template_id}
    actions_template {actions_template_id}
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Template table #[...] created
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="destroying-flow-table">
<h3><span class="section-number">4.13.9. </span>Destroying flow table</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">template_table</span> <span class="pre">destroy</span></code> destroys one or more template tables
from their table ID (as returned by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">template_table</span> <span class="pre">create</span></code>),
this command calls <code class="docutils literal notranslate"><span class="pre">rte_flow_template_table_destroy()</span></code> as many
times as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow template_table {port_id} destroy table {id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Template table #[...] destroyed
</pre></div>
</div>
<p>It does not report anything for table IDs that do not exist.
The usual error message is shown when a table cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="pushing-enqueued-operations">
<h3><span class="section-number">4.13.10. </span>Pushing enqueued operations</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">push</span></code> pushes all the outstanding enqueued operations
to the underlying device immediately.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_push()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow push {port_id} queue {queue_id}
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Queue #[...] operations pushed
</pre></div>
</div>
<p>The usual error message is shown when operations cannot be pushed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="pulling-flow-operations-results">
<h3><span class="section-number">4.13.11. </span>Pulling flow operations results</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">pull</span></code> asks the underlying device about flow queue operations
results and return all the processed (successfully or not) operations.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_pull()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow pull {port_id} queue {queue_id}
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Queue #[...] pulled #[...] operations (#[...] failed, #[...] succeeded)
</pre></div>
</div>
<p>The usual error message is shown when operations results cannot be pulled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
</section>
<section id="calculating-hash">
<h3><span class="section-number">4.13.12. </span>Calculating hash</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">hash</span></code> calculates the hash for a given pattern.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_calc_table_hash()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow hash {port_id} template_table {table_id}
    pattern_template {pattern_template_index}
    actions_template {actions_template_index}
    pattern {item} [/ {item} [...]] / end
</pre></div>
</div>
<p>If successful, it will show the calculated hash result as seen below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Hash results 0x[...]
</pre></div>
</div>
<p>Otherwise, it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same pattern items as <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>,
their format is described in <a class="reference internal" href="#creating-flow-rules">Creating flow rules</a>.</p>
</section>
<section id="creating-a-tunnel-stub-for-offload">
<h3><span class="section-number">4.13.13. </span>Creating a tunnel stub for offload</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">tunnel</span> <span class="pre">create</span></code> setup a tunnel stub for tunnel offload flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow tunnel create {port_id} type {tunnel_type}
</pre></div>
</div>
<p>If successful, it will return a tunnel stub ID usable with other commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>port [...]: flow tunnel #[...] type [...]
</pre></div>
</div>
<p>Tunnel stub ID is relative to a port.</p>
</section>
<section id="destroying-tunnel-offload-stub">
<h3><span class="section-number">4.13.14. </span>Destroying tunnel offload stub</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">tunnel</span> <span class="pre">destroy</span></code> destroy port tunnel stub:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow tunnel destroy {port_id} id {tunnel_id}
</pre></div>
</div>
</section>
<section id="listing-tunnel-offload-stubs">
<h3><span class="section-number">4.13.15. </span>Listing tunnel offload stubs</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">tunnel</span> <span class="pre">list</span></code> list port tunnel offload stubs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow tunnel list {port_id}
</pre></div>
</div>
</section>
<section id="validating-flow-rules">
<h3><span class="section-number">4.13.16. </span>Validating flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">validate</span></code> reports whether a flow rule would be accepted by the
underlying device in its current state but stops short of creating it. It is
bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_validate()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow validate {port_id}
   [group {group_id}] [priority {level}] [ingress] [egress] [transfer]
   pattern {item} [/ {item} [...]] / end
   actions {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule validated
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same parameters as <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>, their format is
described in <a class="reference internal" href="#creating-flow-rules">Creating flow rules</a>.</p>
<p>Check whether redirecting any Ethernet packet received on port 0 to RX queue
index 6 is supported:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / end
   actions queue index 6 / end
Flow rule validated
testpmd&gt;
</pre></div>
</div>
<p>Port 0 does not support TCPv6 rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / ipv6 / tcp / end
   actions drop / end
Caught error type 9 (specific pattern item): Invalid argument
testpmd&gt;
</pre></div>
</div>
</section>
<section id="creating-flow-rules">
<h3><span class="section-number">4.13.17. </span>Creating flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code> validates and creates the specified flow rule. It is bound
to <code class="docutils literal notranslate"><span class="pre">rte_flow_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow create {port_id}
   [group {group_id}] [priority {level}] [ingress] [egress] [transfer]
   [tunnel_set {tunnel_id}] [tunnel_match {tunnel_id}]
   [user_id {user_id}] pattern {item} [/ {item} [...]] / end
   actions {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will return a flow rule ID usable with other commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] created
</pre></div>
</div>
<p>Or if <code class="docutils literal notranslate"><span class="pre">user_id</span></code> is provided:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] created, user-id [...]
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Parameters describe in the following order:</p>
<ul class="simple">
<li><p>Attributes (<em>group</em>, <em>priority</em>, <em>ingress</em>, <em>egress</em>, <em>transfer</em> tokens).</p></li>
<li><p>Tunnel offload specification (tunnel_set, tunnel_match)</p></li>
<li><p>User identifier for the flow.</p></li>
<li><p>A matching pattern, starting with the <em>pattern</em> token and terminated by an
<em>end</em> pattern item.</p></li>
<li><p>Actions, starting with the <em>actions</em> token and terminated by an <em>end</em>
action.</p></li>
</ul>
<p>These translate directly to <em>rte_flow</em> objects provided as-is to the
underlying functions.</p>
<p>The shortest valid definition only comprises mandatory tokens:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 pattern end actions end
</pre></div>
</div>
<p>Note that PMDs may refuse rules that essentially do nothing such as this
one.</p>
<p><strong>All unspecified object values are automatically initialized to 0.</strong></p>
</section>
<section id="enqueueing-creation-of-flow-rules">
<h3><span class="section-number">4.13.18. </span>Enqueueing creation of flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">create</span></code> adds creation operation of a flow rule to a queue.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_async_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} create {queue_id}
    [postpone {boolean}] template_table {table_id}
    pattern_template {pattern_template_index}
    actions_template {actions_template_index}
    pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will return a flow rule ID usable with other commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] creaion enqueued
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same pattern items and actions as <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>,
their format is described in <a class="reference internal" href="#creating-flow-rules">Creating flow rules</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">pull</span></code> must be called to retrieve the operation status.</p>
<section id="attributes">
<h4><span class="section-number">4.13.18.1. </span>Attributes</h4>
<p>These tokens affect flow rule attributes (<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_attr</span></code>) and are
specified before the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> token.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">{group</span> <span class="pre">id}</span></code>: priority group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span> <span class="pre">{level}</span></code>: priority level within group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ingress</span></code>: rule applies to ingress traffic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">egress</span></code>: rule applies to egress traffic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transfer</span></code>: apply rule directly to endpoints found in pattern.</p></li>
</ul>
<p>Please note that use of <code class="docutils literal notranslate"><span class="pre">transfer</span></code> attribute requires that the flow and
its indirect components be managed via so-called <code class="docutils literal notranslate"><span class="pre">transfer</span></code> proxy port.
See <a class="reference internal" href="#show-flow-transfer-proxy-port-id-for-the-given-port">show flow transfer proxy port ID for the given port</a> for details.</p>
<p>Each instance of an attribute specified several times overrides the previous
value as shown below (group 4 is used):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 group 42 group 24 group 4 [...]
</pre></div>
</div>
<p>Note that once enabled, <code class="docutils literal notranslate"><span class="pre">ingress</span></code> and <code class="docutils literal notranslate"><span class="pre">egress</span></code> cannot be disabled.</p>
<p>While not specifying a direction is an error, some rules may allow both
simultaneously.</p>
<p>Most rules affect RX therefore contain the <code class="docutils literal notranslate"><span class="pre">ingress</span></code> token:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern [...]
</pre></div>
</div>
</section>
<section id="tunnel-offload">
<h4><span class="section-number">4.13.18.2. </span>Tunnel offload</h4>
<p>Indicate tunnel offload rule type</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tunnel_set</span> <span class="pre">{tunnel_id}</span></code>: mark rule as tunnel offload decap_set type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tunnel_match</span> <span class="pre">{tunnel_id}</span></code>:  mark rule as tunnel offload match type.</p></li>
</ul>
</section>
<section id="matching-pattern">
<h4><span class="section-number">4.13.18.3. </span>Matching pattern</h4>
<p>A matching pattern starts after the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> token. It is made of pattern
items and is terminated by a mandatory <code class="docutils literal notranslate"><span class="pre">end</span></code> item.</p>
<p>Items are named after their type (<em>RTE_FLOW_ITEM_TYPE_</em> from <code class="docutils literal notranslate"><span class="pre">enum</span>
<span class="pre">rte_flow_item_type</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/</span></code> token is used as a separator between pattern items as shown
below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end [...]
</pre></div>
</div>
<p>Note that protocol items like these must be stacked from lowest to highest
layer to make sense. For instance, the following rule is either invalid or
unlikely to match any packet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / udp / ipv4 / end [...]
</pre></div>
</div>
<p>More information on these restrictions can be found in the <em>rte_flow</em>
documentation.</p>
<p>Several items support additional specification structures, for example
<code class="docutils literal notranslate"><span class="pre">ipv4</span></code> allows specifying source and destination addresses as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 10.1.1.1
   dst is 10.2.0.0 / end [...]
</pre></div>
</div>
<p>This rule matches all IPv4 traffic with the specified properties.</p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">src</span></code> and <code class="docutils literal notranslate"><span class="pre">dst</span></code> are field names of the underlying
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_item_ipv4</span></code> object. All item properties can be specified
in a similar fashion.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">is</span></code> token means that the subsequent value must be matched exactly,
and assigns <code class="docutils literal notranslate"><span class="pre">spec</span></code> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> fields in <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_item</span></code>
accordingly. Possible assignment tokens are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is</span></code>: match value perfectly (with full bit-mask).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>: match value according to configured bit-mask.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span></code>: specify upper bound to establish a range.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code>: specify bit-mask with relevant bits set to one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code>: generate bit-mask with &lt;prefix-length&gt; most-significant bits set to one.</p></li>
</ul>
<p>These yield identical results:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src spec 10.1.1.1 src mask 255.255.255.255
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src spec 10.1.1.1 src prefix 32
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 10.1.1.1 # range with a single value
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 0 # 0 disables range
</pre></div>
</div>
<p>Inclusive ranges can be defined with <code class="docutils literal notranslate"><span class="pre">last</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 10.2.3.4 # 10.1.1.1 to 10.2.3.4
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">mask</span></code> affects both <code class="docutils literal notranslate"><span class="pre">spec</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 10.2.3.4 src mask 255.255.0.0
   # matches 10.1.0.0 to 10.2.255.255
</pre></div>
</div>
<p>Properties can be modified multiple times:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src is 10.1.2.3 src is 10.2.3.4 # matches 10.2.3.4
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src prefix 24 src prefix 16 # matches 10.1.0.0/16
</pre></div>
</div>
</section>
<section id="pattern-items">
<h4><span class="section-number">4.13.18.4. </span>Pattern items</h4>
<p>This section lists supported pattern items and their attributes, if any.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">end</span></code>: end list of pattern items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span></code>: no-op pattern item.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">invert</span></code>: perform actions when pattern does not match.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">any</span></code>: match any protocol for the current layer.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num</span> <span class="pre">{unsigned}</span></code>: number of layers covered.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: match traffic from/to a given DPDK port ID.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: DPDK port ID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mark</span></code>: match value set in previously matched flow rule using the mark action.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: arbitrary integer value.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">raw</span></code>: match an arbitrary byte string.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">relative</span> <span class="pre">{boolean}</span></code>: look for pattern after the previous item.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">{boolean}</span></code>: search pattern from offset (see also limit).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset</span> <span class="pre">{integer}</span></code>: absolute or relative offset for pattern.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span> <span class="pre">{unsigned}</span></code>: search area limit for start of pattern.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span> <span class="pre">{string}</span></code>: byte string to look for.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern_hex</span> <span class="pre">{string}</span></code>: byte string (provided in hexadecimal) to look for.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">eth</span></code>: match Ethernet header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{MAC-48}</span></code>: destination MAC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{MAC-48}</span></code>: source MAC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: EtherType or TPID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vlan</span></code>: match 802.1Q/ad VLAN tag.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tci</span> <span class="pre">{unsigned}</span></code>: tag control information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pcp</span> <span class="pre">{unsigned}</span></code>: priority code point.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dei</span> <span class="pre">{unsigned}</span></code>: drop eligible indicator.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vid</span> <span class="pre">{unsigned}</span></code>: VLAN identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inner_type</span> <span class="pre">{unsigned}</span></code>: inner EtherType or TPID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv4</span></code>: match IPv4 header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">version_ihl</span> <span class="pre">{unsigned}</span></code>: IPv4 version and IP header length.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tos</span> <span class="pre">{unsigned}</span></code>: type of service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ttl</span> <span class="pre">{unsigned}</span></code>: time to live.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proto</span> <span class="pre">{unsigned}</span></code>: next protocol ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{ipv4</span> <span class="pre">address}</span></code>: source address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{ipv4</span> <span class="pre">address}</span></code>: destination address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv6</span></code>: match IPv6 header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tc</span> <span class="pre">{unsigned}</span></code>: traffic class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">{unsigned}</span></code>: flow label.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proto</span> <span class="pre">{unsigned}</span></code>: protocol (next header).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hop</span> <span class="pre">{unsigned}</span></code>: hop limit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{ipv6</span> <span class="pre">address}</span></code>: source address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{ipv6</span> <span class="pre">address}</span></code>: destination address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp</span></code>: match ICMP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: ICMP packet type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">{unsigned}</span></code>: ICMP packet code.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">udp</span></code>: match UDP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{unsigned}</span></code>: UDP source port.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{unsigned}</span></code>: UDP destination port.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tcp</span></code>: match TCP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{unsigned}</span></code>: TCP source port.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{unsigned}</span></code>: TCP destination port.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sctp</span></code>: match SCTP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{unsigned}</span></code>: SCTP source port.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{unsigned}</span></code>: SCTP destination port.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">{unsigned}</span></code>: validation tag.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cksum</span> <span class="pre">{unsigned}</span></code>: checksum.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vxlan</span></code>: match VXLAN header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vni</span> <span class="pre">{unsigned}</span></code>: VXLAN identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_rsvd</span> <span class="pre">{unsigned}</span></code>: VXLAN last reserved 8-bits.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">e_tag</span></code>: match IEEE 802.1BR E-Tag header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grp_ecid_b</span> <span class="pre">{unsigned}</span></code>: GRP and E-CID base.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvgre</span></code>: match NVGRE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tni</span> <span class="pre">{unsigned}</span></code>: virtual subnet ID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mpls</span></code>: match MPLS header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">label</span> <span class="pre">{unsigned}</span></code>: MPLS label.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gre</span></code>: match GRE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span> <span class="pre">{unsigned}</span></code>: protocol type.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gre_key</span></code>: match GRE optional key field.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">{unsigned}</span></code>: key value.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gre_option</span></code>: match GRE optional fields(checksum/key/sequence).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">checksum</span> <span class="pre">{unsigned}</span></code>: checksum value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">{unsigned}</span></code>: key value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span> <span class="pre">{unsigned}</span></code>: sequence number value.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fuzzy</span></code>: fuzzy pattern match, expect faster than default.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">thresh</span> <span class="pre">{unsigned}</span></code>: accuracy threshold.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gtp</span></code>, <code class="docutils literal notranslate"><span class="pre">gtpc</span></code>, <code class="docutils literal notranslate"><span class="pre">gtpu</span></code>: match GTPv1 header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">teid</span> <span class="pre">{unsigned}</span></code>: tunnel endpoint identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">geneve</span></code>: match GENEVE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vni</span> <span class="pre">{unsigned}</span></code>: virtual network identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span> <span class="pre">{unsigned}</span></code>: protocol type.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">geneve-opt</span></code>: match GENEVE header option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">{unsigned}</span></code>: GENEVE option class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: GENEVE option type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">{unsigned}</span></code>: GENEVE option length in 32-bit words.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">{hex</span> <span class="pre">string}</span></code>: GENEVE option data, the length is defined by
<code class="docutils literal notranslate"><span class="pre">length</span></code> field.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vxlan-gpe</span></code>: match VXLAN-GPE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vni</span> <span class="pre">{unsigned}</span></code>: VXLAN-GPE identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">arp_eth_ipv4</span></code>: match ARP header for Ethernet/IPv4.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sha</span> <span class="pre">{MAC-48}</span></code>: sender hardware address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spa</span> <span class="pre">{ipv4</span> <span class="pre">address}</span></code>: sender IPv4 address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tha</span> <span class="pre">{MAC-48}</span></code>: target hardware address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tpa</span> <span class="pre">{ipv4</span> <span class="pre">address}</span></code>: target IPv4 address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv6_ext</span></code>: match presence of any IPv6 extension header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">next_hdr</span> <span class="pre">{unsigned}</span></code>: next header.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6</span></code>: match any ICMPv6 header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: ICMPv6 type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">{unsigned}</span></code>: ICMPv6 code.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_echo_request</span></code>: match ICMPv6 echo request.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ident</span> <span class="pre">{unsigned}</span></code>: ICMPv6 echo request identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span> <span class="pre">{unsigned}</span></code>: ICMPv6 echo request sequence number.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_echo_reply</span></code>: match ICMPv6 echo reply.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ident</span> <span class="pre">{unsigned}</span></code>: ICMPv6 echo reply identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span> <span class="pre">{unsigned}</span></code>: ICMPv6 echo reply sequence number.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_nd_ns</span></code>: match ICMPv6 neighbor discovery solicitation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target_addr</span> <span class="pre">{ipv6</span> <span class="pre">address}</span></code>: target address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_nd_na</span></code>: match ICMPv6 neighbor discovery advertisement.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target_addr</span> <span class="pre">{ipv6</span> <span class="pre">address}</span></code>: target address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_nd_opt</span></code>: match presence of any ICMPv6 neighbor discovery option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: ND option type.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_nd_opt_sla_eth</span></code>: match ICMPv6 neighbor discovery source Ethernet
link-layer address option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sla</span> <span class="pre">{MAC-48}</span></code>: source Ethernet LLA.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">icmp6_nd_opt_tla_eth</span></code>: match ICMPv6 neighbor discovery target Ethernet
link-layer address option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tla</span> <span class="pre">{MAC-48}</span></code>: target Ethernet LLA.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">meta</span></code>: match application specific metadata.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">{unsigned}</span></code>: metadata value.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gtp_psc</span></code>: match GTP PDU extension header with type 0x85.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pdu_type</span> <span class="pre">{unsigned}</span></code>: PDU type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qfi</span> <span class="pre">{unsigned}</span></code>: QoS flow identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pppoes</span></code>, <code class="docutils literal notranslate"><span class="pre">pppoed</span></code>: match PPPoE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span> <span class="pre">{unsigned}</span></code>: session identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pppoe_proto_id</span></code>: match PPPoE session protocol identifier.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proto_id</span> <span class="pre">{unsigned}</span></code>: PPP protocol identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2tpv3oip</span></code>: match L2TPv3 over IP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span> <span class="pre">{unsigned}</span></code>: L2TPv3 over IP session identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ah</span></code>: match AH header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spi</span> <span class="pre">{unsigned}</span></code>: security parameters index.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pfcp</span></code>: match PFCP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">s_field</span> <span class="pre">{unsigned}</span></code>: S field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seid</span> <span class="pre">{unsigned}</span></code>: session endpoint identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">integrity</span></code>: match packet integrity.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">{unsigned}</span></code>: Packet encapsulation level the item should
apply to. See rte_flow_action_rss for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">{unsigned}</span></code>: A bitmask that specify what packet elements
must be matched for integrity.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">conntrack</span></code>: match conntrack state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port_representor</span></code>: match traffic entering the embedded switch from the given ethdev</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span> <span class="pre">{unsigned}</span></code>: ethdev port ID</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">represented_port</span></code>: match traffic entering the embedded switch from
the entity represented by the given ethdev</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ethdev_port_id</span> <span class="pre">{unsigned}</span></code>: ethdev port ID</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2tpv2</span></code>: match L2TPv2 header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">{unsigned}</span></code>: L2TPv2 option length.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tunnel_id</span> <span class="pre">{unsigned}</span></code>: L2TPv2 tunnel identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span> <span class="pre">{unsigned}</span></code>: L2TPv2 session identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ns</span> <span class="pre">{unsigned}</span></code>: L2TPv2 option ns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nr</span> <span class="pre">{unsigned}</span></code>: L2TPv2 option nr.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset_size</span> <span class="pre">{unsigned}</span></code>: L2TPv2 option offset.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ppp</span></code>: match PPP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span> <span class="pre">{unsigned}</span></code>: PPP address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctrl</span> <span class="pre">{unsigned}</span></code>: PPP control.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proto_id</span> <span class="pre">{unsigned}</span></code>: PPP protocol identifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ib_bth</span></code>: match InfiniBand BTH(base transport header).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opcode</span> <span class="pre">{unsigned}</span></code>: Opcode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pkey</span> <span class="pre">{unsigned}</span></code>: Partition key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_qp</span> <span class="pre">{unsigned}</span></code>: Destination Queue Pair.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psn</span> <span class="pre">{unsigned}</span></code>: Packet Sequence Number.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">meter</span></code>: match meter color.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">color</span> <span class="pre">{value}</span></code>: meter color value (green/yellow/red).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggr_affinity</span></code>: match aggregated port.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">affinity</span> <span class="pre">{value}</span></code>: aggregated port (starts from 1).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tx_queue</span></code>: match Tx queue of sent packet.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tx_queue</span> <span class="pre">{value}</span></code>: send queue value (starts from 0).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">send_to_kernel</span></code>: send packets to kernel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ptype</span></code>: match the packet type (L2/L3/L4 and tunnel information).</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">packet_type</span> <span class="pre">{unsigned}</span></code>: packet type.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="actions-list">
<h4><span class="section-number">4.13.18.5. </span>Actions list</h4>
<p>A list of actions starts after the <code class="docutils literal notranslate"><span class="pre">actions</span></code> token in the same fashion as
<a class="reference internal" href="#matching-pattern">Matching pattern</a>; actions are separated by <code class="docutils literal notranslate"><span class="pre">/</span></code> tokens and the list is
terminated by a mandatory <code class="docutils literal notranslate"><span class="pre">end</span></code> action.</p>
<p>Actions are named after their type (<em>RTE_FLOW_ACTION_TYPE_</em> from <code class="docutils literal notranslate"><span class="pre">enum</span>
<span class="pre">rte_flow_action_type</span></code>).</p>
<p>Dropping all incoming UDPv4 packets can be expressed as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end
   actions drop / end
</pre></div>
</div>
<p>Several actions have configurable properties which must be specified when
there is no valid default value. For example, <code class="docutils literal notranslate"><span class="pre">queue</span></code> requires a target
queue index.</p>
<p>This rule redirects incoming UDPv4 traffic to queue index 6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end
   actions queue index 6 / end
</pre></div>
</div>
<p>While this one could be rejected by PMDs (unspecified queue index):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end
   actions queue / end
</pre></div>
</div>
<p>As defined by <em>rte_flow</em>, the list is not ordered, all actions of a given
rule are performed simultaneously. These are equivalent:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue index 6 / void / mark id 42 / end
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void / mark id 42 / queue index 6 / end
</pre></div>
</div>
<p>All actions in a list should have different types, otherwise only the last
action of a given type is taken into account:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue index 4 / queue index 5 / queue index 6 / end # will use queue 6
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / drop / drop / end # drop is performed only once
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mark id 42 / queue index 3 / mark id 24 / end # mark will be 24
</pre></div>
</div>
<p>Considering they are performed simultaneously, opposite and overlapping
actions can sometimes be combined when the end result is unambiguous:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / queue index 6 / end # drop has no effect
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue index 6 / rss queues 6 7 8 / end # queue has no effect
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / passthru / end # drop has no effect
</pre></div>
</div>
<p>Note that PMDs may still refuse such combinations.</p>
</section>
<section id="actions">
<h4><span class="section-number">4.13.18.6. </span>Actions</h4>
<p>This section lists supported actions and their attributes, if any.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">end</span></code>: end list of actions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span></code>: no-op action.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">passthru</span></code>: let subsequent rule process matched packets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jump</span></code>: redirect traffic to group on device.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">{unsigned}</span></code>: group to redirect to.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mark</span></code>: attach 32 bit value to packets.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: 32 bit value to return with packets.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code>: flag packets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queue</span></code>: assign packets to a given queue index.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">{unsigned}</span></code>: queue index to use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">drop</span></code>: drop packets (note: passthru has priority).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count</span></code>: enable counters for this rule.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rss</span></code>: spread packets among several queues.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">func</span> <span class="pre">{hash</span> <span class="pre">function}</span></code>: RSS hash function to apply, allowed tokens are
<code class="docutils literal notranslate"><span class="pre">toeplitz</span></code>, <code class="docutils literal notranslate"><span class="pre">simple_xor</span></code>, <code class="docutils literal notranslate"><span class="pre">symmetric_toeplitz</span></code> and <code class="docutils literal notranslate"><span class="pre">default</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">{unsigned}</span></code>: encapsulation level for <code class="docutils literal notranslate"><span class="pre">types</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">types</span> <span class="pre">[{RSS</span> <span class="pre">hash</span> <span class="pre">type}</span> <span class="pre">[...]]</span> <span class="pre">end</span></code>: specific RSS hash types.
Note that an empty list does not disable RSS but instead requests
unspecified “best-effort” settings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">{string}</span></code>: RSS hash key, overrides <code class="docutils literal notranslate"><span class="pre">key_len</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_len</span> <span class="pre">{unsigned}</span></code>: RSS hash key length in bytes, can be used in
conjunction with <code class="docutils literal notranslate"><span class="pre">key</span></code> to pad or truncate it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queues</span> <span class="pre">[{unsigned}</span> <span class="pre">[...]]</span> <span class="pre">end</span></code>: queue indices to use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pf</span></code>: direct traffic to physical function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vf</span></code>: direct traffic to a virtual function ID.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">original</span> <span class="pre">{boolean}</span></code>: use original VF ID if possible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: VF ID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: direct matching traffic to a given DPDK port ID.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">original</span> <span class="pre">{boolean}</span></code>: use original DPDK port ID if possible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: DPDK port ID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_set_mpls_ttl</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_MPLS_TTL</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mpls_ttl</span></code>: MPLS TTL.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_dec_mpls_ttl</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_DEC_MPLS_TTL</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_set_nw_ttl</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_NW_TTL</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">nw_ttl</span></code>: IP TTL.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_dec_nw_ttl</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_DEC_NW_TTL</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_copy_ttl_out</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_COPY_TTL_OUT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_copy_ttl_in</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_COPY_TTL_IN</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_pop_vlan</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_POP_VLAN</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_push_vlan</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_PUSH_VLAN</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ethertype</span></code>: Ethertype.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_set_vlan_vid</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_VLAN_VID</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">vlan_vid</span></code>: VLAN id.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_set_vlan_pcp</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_VLAN_PCP</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">vlan_pcp</span></code>: VLAN priority.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_pop_mpls</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_POP_MPLS</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ethertype</span></code>: Ethertype.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">of_push_mpls</span></code>: OpenFlow’s <code class="docutils literal notranslate"><span class="pre">OFPAT_PUSH_MPLS</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ethertype</span></code>: Ethertype.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vxlan_encap</span></code>: Performs a VXLAN encapsulation, outer layer configuration
is done through <a class="reference internal" href="#config-vxlan-encap-outer-layers">Config VXLAN Encap outer layers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vxlan_decap</span></code>: Performs a decapsulation action by stripping all headers of
the VXLAN tunnel network overlay from the matched flow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvgre_encap</span></code>: Performs a NVGRE encapsulation, outer layer configuration
is done through <a class="reference internal" href="#config-nvgre-encap-outer-layers">Config NVGRE Encap outer layers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvgre_decap</span></code>: Performs a decapsulation action by stripping all headers of
the NVGRE tunnel network overlay from the matched flow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_encap</span></code>: Performs a L2 encapsulation, L2 configuration
is done through <a class="reference internal" href="#config-l2-encap">Config L2 Encap</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_decap</span></code>: Performs a L2 decapsulation, L2 configuration
is done through <a class="reference internal" href="#config-l2-decap">Config L2 Decap</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mplsogre_encap</span></code>: Performs a MPLSoGRE encapsulation, outer layer
configuration is done through <a class="reference internal" href="#config-mplsogre-encap-outer-layers">Config MPLSoGRE Encap outer layers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mplsogre_decap</span></code>: Performs a MPLSoGRE decapsulation, outer layer
configuration is done through <a class="reference internal" href="#config-mplsogre-decap-outer-layers">Config MPLSoGRE Decap outer layers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mplsoudp_encap</span></code>: Performs a MPLSoUDP encapsulation, outer layer
configuration is done through <a class="reference internal" href="#config-mplsoudp-encap-outer-layers">Config MPLSoUDP Encap outer layers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mplsoudp_decap</span></code>: Performs a MPLSoUDP decapsulation, outer layer
configuration is done through <a class="reference internal" href="#config-mplsoudp-decap-outer-layers">Config MPLSoUDP Decap outer layers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ipv4_src</span></code>: Set a new IPv4 source address in the outermost IPv4 header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv4_addr</span></code>: New IPv4 source address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ipv4_dst</span></code>: Set a new IPv4 destination address in the outermost IPv4
header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv4_addr</span></code>: New IPv4 destination address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ipv6_src</span></code>: Set a new IPv6 source address in the outermost IPv6 header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv6_addr</span></code>: New IPv6 source address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ipv6_dst</span></code>: Set a new IPv6 destination address in the outermost IPv6
header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipv6_addr</span></code>: New IPv6 destination address.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_tp_src</span></code>: Set a new source port number in the outermost TCP/UDP
header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: New TCP/UDP source port number.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_tp_dst</span></code>: Set a new destination port number in the outermost TCP/UDP
header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: New TCP/UDP destination port number.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mac_swap</span></code>: Swap the source and destination MAC addresses in the outermost
Ethernet header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dec_ttl</span></code>: Performs a decrease TTL value action</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ttl</span></code>: Set TTL value with specified value
- <code class="docutils literal notranslate"><span class="pre">ttl_value</span> <span class="pre">{unsigned}</span></code>: The new TTL value to be set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_mac_src</span></code>: set source MAC address</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mac_addr</span> <span class="pre">{MAC-48}</span></code>: new source MAC address</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_mac_dst</span></code>: set destination MAC address</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mac_addr</span> <span class="pre">{MAC-48}</span></code>: new destination MAC address</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">inc_tcp_seq</span></code>: Increase sequence number in the outermost TCP header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">{unsigned}</span></code>: Value to increase TCP sequence number by.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dec_tcp_seq</span></code>: Decrease sequence number in the outermost TCP header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">{unsigned}</span></code>: Value to decrease TCP sequence number by.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">inc_tcp_ack</span></code>: Increase acknowledgment number in the outermost TCP header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">{unsigned}</span></code>: Value to increase TCP acknowledgment number by.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dec_tcp_ack</span></code>: Decrease acknowledgment number in the outermost TCP header.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">{unsigned}</span></code>: Value to decrease TCP acknowledgment number by.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ipv4_dscp</span></code>: Set IPv4 DSCP value with specified value</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dscp_value</span> <span class="pre">{unsigned}</span></code>: The new DSCP value to be set</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_ipv6_dscp</span></code>: Set IPv6 DSCP value with specified value</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dscp_value</span> <span class="pre">{unsigned}</span></code>: The new DSCP value to be set</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">indirect</span></code>: Use indirect action created via
<code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">create</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">indirect_action_id</span> <span class="pre">{unsigned}</span></code>: Indirect action ID to use</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">color</span></code>: Color the packet to reflect the meter color result</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{value}</span></code>: Set color type with specified value(green/yellow/red)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">port_representor</span></code>: at embedded switch level, send matching traffic to
the given ethdev</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span> <span class="pre">{unsigned}</span></code>: ethdev port ID</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">represented_port</span></code>: at embedded switch level, send matching traffic to
the entity represented by the given ethdev</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ethdev_port_id</span> <span class="pre">{unsigned}</span></code>: ethdev port ID</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">meter_mark</span></code>:  meter the directed packets using profile and policy</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mtr_profile</span> <span class="pre">{unsigned}</span></code>: meter profile ID to use</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtr_policy</span> <span class="pre">{unsigned}</span></code>: meter policy ID to use</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtr_color_mode</span> <span class="pre">{unsigned}</span></code>: meter color-awareness mode (blind/aware)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtr_init_color</span> <span class="pre">{value}</span></code>: initial color value (green/yellow/red)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtr_state</span> <span class="pre">{unsigned}</span></code>: meter state (disabled/enabled)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">modify_field</span></code>:  Modify packet field</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code>: modify operation (set/add/sub)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_type</span></code>: the destination field to be modified, the supported fields as
<code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">rte_flow_field_id</span></code> listed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_level</span></code>: destination field level.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_tag_index</span></code>: destination field tag array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_type_id</span></code>: destination field type ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_class</span></code>: destination field class ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst_offset</span></code>: destination field bit offset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_type</span></code>: the modify source field, the supported fields as
<code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">rte_flow_field_id</span></code> listed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_level</span></code>: source field level.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_tag_index</span></code>: source field tag array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_type_id</span></code>: source field type ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_class</span></code>: source field class ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_offset</span></code>: source field bit offset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_value</span></code>: source immediate value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_ptr</span></code>: pointer to source immediate value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code>: number of bits to copy.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="destroying-flow-rules">
<h3><span class="section-number">4.13.19. </span>Destroying flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">destroy</span></code> destroys one or more rules from their rule ID (as returned
by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>), this command calls <code class="docutils literal notranslate"><span class="pre">rte_flow_destroy()</span></code> as many
times as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow destroy {port_id} rule {rule_id} [...] [user_id]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] destroyed
</pre></div>
</div>
<p>Or if <code class="docutils literal notranslate"><span class="pre">user_id</span></code> flag is provided:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] destroyed, user-id [...]
</pre></div>
</div>
<p>Optional <code class="docutils literal notranslate"><span class="pre">user_id</span></code> is a flag that signifies the rule ID
is the one provided by the user at creation.
It does not report anything for rule IDs that do not exist. The usual error
message is shown when a rule cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">flush</span></code> destroys all rules on a device and does not take extra
arguments. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_flush()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow flush {port_id}
</pre></div>
</div>
<p>Any errors are reported as above.</p>
<p>Creating several rules and destroying them:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 3 / end
Flow rule #1 created
testpmd&gt; flow destroy 0 rule 0 rule 1
Flow rule #1 destroyed
Flow rule #0 destroyed
testpmd&gt;
</pre></div>
</div>
<p>The same result can be achieved using <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">flush</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 3 / end
Flow rule #1 created
testpmd&gt; flow flush 0
testpmd&gt;
</pre></div>
</div>
<p>Non-existent rule IDs are ignored:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 3 / end
Flow rule #1 created
testpmd&gt; flow destroy 0 rule 42 rule 10 rule 2
testpmd&gt;
testpmd&gt; flow destroy 0 rule 0
Flow rule #0 destroyed
testpmd&gt;
</pre></div>
</div>
</section>
<section id="enqueueing-destruction-of-flow-rules">
<h3><span class="section-number">4.13.20. </span>Enqueueing destruction of flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">destroy</span></code> adds destruction operations to destroy one or more rules
from their rule ID (as returned by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">create</span></code>) to a queue,
this command calls <code class="docutils literal notranslate"><span class="pre">rte_flow_async_destroy()</span></code> as many times as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} destroy {queue_id}
     [postpone {boolean}] rule {rule_id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] destruction enqueued
</pre></div>
</div>
<p>It does not report anything for rule IDs that do not exist. The usual error
message is shown when a rule cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">pull</span></code> must be called to retrieve the operation status.</p>
</section>
<section id="querying-flow-rules">
<h3><span class="section-number">4.13.21. </span>Querying flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">query</span></code> queries a specific action of a flow rule having that
ability. Such actions collect information that can be reported using this
command. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_query()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow query {port_id} {rule_id} {action} [user_id]
</pre></div>
</div>
<p>Optional <code class="docutils literal notranslate"><span class="pre">user_id</span></code> is a flag that signifies the rule ID
is the one provided by the user at creation.
If successful, it will display either the retrieved data for known actions
or the following message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cannot display result for action type [...] ([...])
</pre></div>
</div>
<p>Otherwise, it will complain either that the rule does not exist or that some
error occurred:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] not found
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Currently only the <code class="docutils literal notranslate"><span class="pre">count</span></code> action is supported. This action reports the
number of packets that hit the flow rule and the total number of bytes. Its
output has the following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>count:
 hits_set: [...] # whether &quot;hits&quot; contains a valid value
 bytes_set: [...] # whether &quot;bytes&quot; contains a valid value
 hits: [...] # number of packets
 bytes: [...] # number of bytes
</pre></div>
</div>
<p>Querying counters for TCPv6 packets redirected to queue 6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / tcp / end
   actions queue index 6 / count / end
Flow rule #4 created
testpmd&gt; flow query 0 4 count
count:
 hits_set: 1
 bytes_set: 0
 hits: 386446
 bytes: 0
testpmd&gt;
</pre></div>
</div>
</section>
<section id="listing-flow-rules">
<h3><span class="section-number">4.13.22. </span>Listing flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">list</span></code> lists existing flow rules sorted by priority and optionally
filtered by group identifiers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow list {port_id} [group {group_id}] [...]
</pre></div>
</div>
<p>This command only fails with the following message if the device does not
exist:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Invalid port [...]
</pre></div>
</div>
<p>Output consists of a header line followed by a short description of each
flow rule, one per line. There is no output at all when no flow rules are
configured on the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ID      Group   Prio    Attr    Rule
[...]   [...]   [...]   [...]   [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Attr</span></code> column flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code> for <code class="docutils literal notranslate"><span class="pre">ingress</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code> for <code class="docutils literal notranslate"><span class="pre">egress</span></code>.</p></li>
</ul>
<p>Creating several flow rules and listing them:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 6 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #1 created
testpmd&gt; flow create 0 priority 5 ingress pattern eth / ipv4 / udp / end
   actions rss queues 6 7 8 end / end
Flow rule #2 created
testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH IPV4 =&gt; QUEUE
1       0       0       i-      ETH IPV6 =&gt; QUEUE
2       0       5       i-      ETH IPV4 UDP =&gt; RSS
testpmd&gt;
</pre></div>
</div>
<p>Rules are sorted by priority (i.e. group ID first, then priority level):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow list 1
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH =&gt; COUNT
6       0       500     i-      ETH IPV6 TCP =&gt; DROP COUNT
5       0       1000    i-      ETH IPV6 ICMP =&gt; QUEUE
1       24      0       i-      ETH IPV4 UDP =&gt; QUEUE
4       24      10      i-      ETH IPV4 TCP =&gt; DROP
3       24      20      i-      ETH IPV4 =&gt; DROP
2       24      42      i-      ETH IPV4 UDP =&gt; QUEUE
7       63      0       i-      ETH IPV6 UDP VXLAN =&gt; MARK QUEUE
testpmd&gt;
</pre></div>
</div>
<p>Output can be limited to specific groups:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow list 1 group 0 group 63
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH =&gt; COUNT
6       0       500     i-      ETH IPV6 TCP =&gt; DROP COUNT
5       0       1000    i-      ETH IPV6 ICMP =&gt; QUEUE
7       63      0       i-      ETH IPV6 UDP VXLAN =&gt; MARK QUEUE
testpmd&gt;
</pre></div>
</div>
</section>
<section id="toggling-isolated-mode">
<h3><span class="section-number">4.13.23. </span>Toggling isolated mode</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">isolate</span></code> can be used to tell the underlying PMD that ingress traffic
must only be injected from the defined flow rules; that no default traffic
is expected outside those rules and the driver is free to assign more
resources to handle them. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_isolate()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow isolate {port_id} {boolean}
</pre></div>
</div>
<p>If successful, enabling or disabling isolated mode shows either:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Ingress traffic on port [...]
   is now restricted to the defined flow rules
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Ingress traffic on port [...]
   is not restricted anymore to the defined flow rules
</pre></div>
</div>
<p>Otherwise, in case of error:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Mainly due to its side effects, PMDs supporting this mode may not have the
ability to toggle it more than once without reinitializing affected ports
first (e.g. by exiting testpmd).</p>
<p>Enabling isolated mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow isolate 0 true
Ingress traffic on port 0 is now restricted to the defined flow rules
testpmd&gt;
</pre></div>
</div>
<p>Disabling isolated mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow isolate 0 false
Ingress traffic on port 0 is not restricted anymore to the defined flow rules
testpmd&gt;
</pre></div>
</div>
</section>
<section id="dumping-hw-internal-information">
<h3><span class="section-number">4.13.24. </span>Dumping HW internal information</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">dump</span></code> dumps the hardware’s internal representation information of
all flows. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_dev_dump()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow dump {port_id} {output_file} [user_id]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow dump finished
</pre></div>
</div>
<p>Otherwise, it will complain error occurred:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Optional <code class="docutils literal notranslate"><span class="pre">user_id</span></code> is a flag that signifies the rule ID
is the one provided by the user at creation.</p>
</section>
<section id="listing-and-destroying-aged-flow-rules">
<h3><span class="section-number">4.13.25. </span>Listing and destroying aged flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">aged</span></code> simply lists aged flow rules be get from api <code class="docutils literal notranslate"><span class="pre">rte_flow_get_aged_flows</span></code>,
and <code class="docutils literal notranslate"><span class="pre">destroy</span></code> parameter can be used to destroy those flow rules in PMD:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow aged {port_id} [destroy]
</pre></div>
</div>
<p>Listing current aged flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow aged 0
Port 0 total aged flows: 0
testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 2.2.2.14 / end
   actions age timeout 5 / queue index 0 /  end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 2.2.2.15 / end
   actions age timeout 4 / queue index 0 /  end
Flow rule #1 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 2.2.2.16 / end
   actions age timeout 2 / queue index 0 /  end
Flow rule #2 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 2.2.2.17 / end
   actions age timeout 3 / queue index 0 /  end
Flow rule #3 created
</pre></div>
</div>
<p>Aged Rules are simply list as command <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">list</span> <span class="pre">{port_id}</span></code>, but strip the detail rule
information, all the aged flows are sorted by the longest timeout time. For example, if
those rules be configured in the same time, ID 2 will be the first aged out rule, the next
will be ID 3, ID 1, ID 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow aged 0
Port 0 total aged flows: 4
ID      Group   Prio    Attr
2       0       0       i--
3       0       0       i--
1       0       0       i--
0       0       0       i--
</pre></div>
</div>
<p>If attach <code class="docutils literal notranslate"><span class="pre">destroy</span></code> parameter, the command will destroy all the list aged flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow aged 0 destroy
Port 0 total aged flows: 4
ID      Group   Prio    Attr
2       0       0       i--
3       0       0       i--
1       0       0       i--
0       0       0       i--

Flow rule #2 destroyed
Flow rule #3 destroyed
Flow rule #1 destroyed
Flow rule #0 destroyed
4 flows be destroyed
testpmd&gt; flow aged 0
Port 0 total aged flows: 0
</pre></div>
</div>
</section>
<section id="enqueueing-listing-and-destroying-aged-flow-rules">
<h3><span class="section-number">4.13.26. </span>Enqueueing listing and destroying aged flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">aged</span></code> simply lists aged flow rules be get from
<code class="docutils literal notranslate"><span class="pre">rte_flow_get_q_aged_flows</span></code> API, and <code class="docutils literal notranslate"><span class="pre">destroy</span></code> parameter can be used to
destroy those flow rules in PMD:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} aged {queue_id} [destroy]
</pre></div>
</div>
<p>Listing current aged flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow queue 0 aged 0
Port 0 queue 0 total aged flows: 0
testpmd&gt; flow queue 0 create 0 ingress tanle 0 item_template 0 action_template 0
   pattern eth / ipv4 src is 2.2.2.14 / end
   actions age timeout 5 / queue index 0 /  end
Flow rule #0 creation enqueued
testpmd&gt; flow queue 0 create 0 ingress tanle 0 item_template 0 action_template 0
   pattern eth / ipv4 src is 2.2.2.15 / end
   actions age timeout 4 / queue index 0 /  end
Flow rule #1 creation enqueued
testpmd&gt; flow queue 0 create 0 ingress tanle 0 item_template 0 action_template 0
   pattern eth / ipv4 src is 2.2.2.16 / end
   actions age timeout 4 / queue index 0 /  end
Flow rule #2 creation enqueued
testpmd&gt; flow queue 0 create 0 ingress tanle 0 item_template 0 action_template 0
   pattern eth / ipv4 src is 2.2.2.17 / end
   actions age timeout 4 / queue index 0 /  end
Flow rule #3 creation enqueued
testpmd&gt; flow pull 0 queue 0
Queue #0 pulled 4 operations (0 failed, 4 succeeded)
</pre></div>
</div>
<p>Aged Rules are simply list as command <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">{port_id}</span> <span class="pre">list</span> <span class="pre">{queue_id}</span></code>,
but strip the detail rule information, all the aged flows are sorted by the
longest timeout time. For example, if those rules is configured in the same time,
ID 2 will be the first aged out rule, the next will be ID 3, ID 1, ID 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow queue 0 aged 0
Port 0 queue 0 total aged flows: 4
ID      Group   Prio    Attr
2       0       0       ---
3       0       0       ---
1       0       0       ---
0       0       0       ---

0 flows destroyed
</pre></div>
</div>
<p>If attach <code class="docutils literal notranslate"><span class="pre">destroy</span></code> parameter, the command will destroy all the list aged flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow queue 0 aged 0 destroy
Port 0 queue 0 total aged flows: 4
ID      Group   Prio    Attr
2       0       0       ---
3       0       0       ---
1       0       0       ---
0       0       0       ---
Flow rule #2 destruction enqueued
Flow rule #3 destruction enqueued
Flow rule #1 destruction enqueued
Flow rule #0 destruction enqueued

4 flows destroyed
testpmd&gt; flow queue 0 aged 0
Port 0 total aged flows: 0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The queue must be empty before attaching <code class="docutils literal notranslate"><span class="pre">destroy</span></code> parameter.</p>
</div>
</section>
<section id="creating-indirect-actions">
<h3><span class="section-number">4.13.27. </span>Creating indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">create</span></code> creates indirect action with optional
indirect action ID. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_action_handle_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow indirect_action {port_id} create [action_id {indirect_action_id}]
   [ingress] [egress] [transfer] action {action} / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] created
</pre></div>
</div>
<p>Otherwise, it will complain either that indirect action already exists or that
some error occurred:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] is already assigned, delete it first
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Create indirect rss action with id 100 to queues 1 and 2 on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow indirect_action 0 create action_id 100 \
   ingress action rss queues 1 2 end / end
</pre></div>
</div>
<p>Create indirect rss action with id assigned by testpmd to queues 1 and 2 on
port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow indirect_action 0 create action_id \
        ingress action rss queues 0 1 end / end
</pre></div>
</div>
</section>
<section id="enqueueing-creation-of-indirect-actions">
<h3><span class="section-number">4.13.28. </span>Enqueueing creation of indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">indirect_action</span> <span class="pre">create</span></code> adds creation operation of an indirect
action to a queue. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_async_action_handle_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} create {queue_id} [postpone {boolean}]
    table {table_id} item_template {item_template_id}
    action_template {action_template_id}
    pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] creation queued
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same parameters as  <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">create</span></code>,
described in <a class="reference internal" href="#creating-indirect-actions">Creating indirect actions</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">pull</span></code> must be called to retrieve the operation status.</p>
</section>
<section id="updating-indirect-actions">
<h3><span class="section-number">4.13.29. </span>Updating indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">update</span></code> updates configuration of the indirect
action from its indirect action ID (as returned by
<code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">create</span></code>). It is bound to
<code class="docutils literal notranslate"><span class="pre">rte_flow_action_handle_update()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow indirect_action {port_id} update {indirect_action_id}
   action {action} / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] updated
</pre></div>
</div>
<p>Otherwise, it will complain either that indirect action not found or that some
error occurred:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Failed to find indirect action #[...] on port [...]
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Update indirect rss action having id 100 on port 0 with rss to queues 0 and 3
(in create example above rss queues were 1 and 2):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow indirect_action 0 update 100 action rss queues 0 3 end / end
</pre></div>
</div>
</section>
<section id="enqueueing-update-of-indirect-actions">
<h3><span class="section-number">4.13.30. </span>Enqueueing update of indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">indirect_action</span> <span class="pre">update</span></code> adds update operation for an indirect
action to a queue. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_async_action_handle_update()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} indirect_action {queue_id} update
   {indirect_action_id} [postpone {boolean}] action {action} / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] update queued
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">pull</span></code> must be called to retrieve the operation status.</p>
</section>
<section id="destroying-indirect-actions">
<h3><span class="section-number">4.13.31. </span>Destroying indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">destroy</span></code> destroys one or more indirect actions
from their indirect action IDs (as returned by
<code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">create</span></code>). It is bound to
<code class="docutils literal notranslate"><span class="pre">rte_flow_action_handle_destroy()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow indirect_action {port_id} destroy action_id {indirect_action_id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] destroyed
</pre></div>
</div>
<p>It does not report anything for indirect action IDs that do not exist.
The usual error message is shown when a indirect action cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Destroy indirect actions having id 100 &amp; 101:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow indirect_action 0 destroy action_id 100 action_id 101
</pre></div>
</div>
</section>
<section id="enqueueing-destruction-of-indirect-actions">
<h3><span class="section-number">4.13.32. </span>Enqueueing destruction of indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">indirect_action</span> <span class="pre">destroy</span></code> adds destruction operation to destroy
one or more indirect actions from their indirect action IDs (as returned by
<code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">{port_id}</span> <span class="pre">indirect_action</span> <span class="pre">{queue_id}</span> <span class="pre">create</span></code>) to a queue.
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_async_action_handle_destroy()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} indirect_action {queue_id} destroy
   [postpone {boolean}] action_id {indirect_action_id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] destruction queued
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">pull</span></code> must be called to retrieve the operation status.</p>
</section>
<section id="query-indirect-actions">
<h3><span class="section-number">4.13.33. </span>Query indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">query</span></code> queries the indirect action from its
indirect action ID (as returned by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">indirect_action</span> <span class="pre">{port_id}</span> <span class="pre">create</span></code>).
It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_action_handle_query()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow indirect_action {port_id} query {indirect_action_id}
</pre></div>
</div>
<p>Currently only rss indirect action supported. If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect RSS action:
   refs:[...]
</pre></div>
</div>
<p>Otherwise, it will complain either that indirect action not found or that some
error occurred:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Failed to find indirect action #[...] on port [...]
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Query indirect action having id 100:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow indirect_action 0 query 100
</pre></div>
</div>
</section>
<section id="enqueueing-query-of-indirect-actions">
<h3><span class="section-number">4.13.34. </span>Enqueueing query of indirect actions</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">indirect_action</span> <span class="pre">query</span></code> adds query operation for an indirect
action to a queue. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_async_action_handle_query()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow queue {port_id} indirect_action {queue_id} query
   {indirect_action_id} [postpone {boolean}]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Indirect action #[...] query queued
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">queue</span> <span class="pre">pull</span></code> must be called to retrieve the operation status.</p>
</section>
<section id="sample-qinq-flow-rules">
<h3><span class="section-number">4.13.35. </span>Sample QinQ flow rules</h3>
<p>Before creating QinQ rule(s) the following commands should be issued to enable QinQ:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port stop 0
testpmd&gt; vlan set extend on 0
</pre></div>
</div>
<p>The above command sets the inner and outer TPID’s to 0x8100.</p>
<p>To change the TPID’s the following commands should be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set outer tpid 0x88A8 0
testpmd&gt; vlan set inner tpid 0x8100 0
testpmd&gt; port start 0
</pre></div>
</div>
<p>Validate and create a QinQ rule on port 0 to steer traffic to a VF queue in a VM.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / vlan tci is 123 /
    vlan tci is 456 / end actions vf id 1 / queue index 0 / end
Flow rule #0 validated

testpmd&gt; flow create 0 ingress pattern eth / vlan tci is 4 /
    vlan tci is 456 / end actions vf id 123 / queue index 0 / end
Flow rule #0 created

testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH VLAN VLAN=&gt;VF QUEUE
</pre></div>
</div>
<p>Validate and create a QinQ rule on port 0 to steer traffic to a queue on the host.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / vlan tci is 321 /
     vlan tci is 654 / end actions pf / queue index 0 / end
Flow rule #1 validated

testpmd&gt; flow create 0 ingress pattern eth / vlan tci is 321 /
     vlan tci is 654 / end actions pf / queue index 1 / end
Flow rule #1 created

testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH VLAN VLAN=&gt;VF QUEUE
1       0       0       i-      ETH VLAN VLAN=&gt;PF QUEUE
</pre></div>
</div>
</section>
<section id="sample-vxlan-flow-rules">
<h3><span class="section-number">4.13.36. </span>Sample VXLAN flow rules</h3>
<p>Before creating VXLAN rule(s), the UDP port should be added for VXLAN packet
filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vxlan_port add 4789 0
</pre></div>
</div>
<p>Create VXLAN rules on port 0 to steer traffic to PF queues.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / vxlan /
       eth dst is 00:11:22:33:44:55 / end actions pf / queue index 1 / end
Flow rule #0 created

testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / vxlan vni is 3 /
       eth dst is 00:11:22:33:44:55 / end actions pf / queue index 2 / end
Flow rule #1 created

testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / vxlan /
       eth dst is 00:11:22:33:44:55 / vlan tci is 10 / end actions pf /
       queue index 3 / end
Flow rule #2 created

testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / vxlan vni is 5 /
       eth dst is 00:11:22:33:44:55 / vlan tci is 20 / end actions pf /
       queue index 4 / end
Flow rule #3 created

testpmd&gt; flow create 0 ingress pattern eth dst is 00:00:00:00:01:00 / ipv4 /
       udp / vxlan vni is 6 /  eth dst is 00:11:22:33:44:55 / end actions pf /
       queue index 5 / end
Flow rule #4 created

testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH IPV4 UDP VXLAN ETH =&gt; QUEUE
1       0       0       i-      ETH IPV4 UDP VXLAN ETH =&gt; QUEUE
2       0       0       i-      ETH IPV4 UDP VXLAN ETH VLAN =&gt; QUEUE
3       0       0       i-      ETH IPV4 UDP VXLAN ETH VLAN =&gt; QUEUE
4       0       0       i-      ETH IPV4 UDP VXLAN ETH =&gt; QUEUE
</pre></div>
</div>
</section>
<section id="sample-vxlan-encapsulation-rule">
<h3><span class="section-number">4.13.37. </span>Sample VXLAN encapsulation rule</h3>
<p>VXLAN encapsulation outer layer has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>IPv4 VXLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vxlan ip-version ipv4 vni 4 udp-src 4 udp-dst 4 ip-src 127.0.0.1
       ip-dst 128.0.0.1 eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions vxlan_encap /
       queue index 0 / end

testpmd&gt; set vxlan-with-vlan ip-version ipv4 vni 4 udp-src 4 udp-dst 4 ip-src
        127.0.0.1 ip-dst 128.0.0.1 vlan-tci 34 eth-src 11:11:11:11:11:11
        eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions vxlan_encap /
        queue index 0 / end

testpmd&gt; set vxlan-tos-ttl ip-version ipv4 vni 4 udp-src 4 udp-dst 4 ip-tos 0
        ip-ttl 255 ip-src 127.0.0.1 ip-dst 128.0.0.1 eth-src 11:11:11:11:11:11
        eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions vxlan_encap /
        queue index 0 / end
</pre></div>
</div>
<p>IPv6 VXLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vxlan ip-version ipv6 vni 4 udp-src 4 udp-dst 4 ip-src ::1
       ip-dst ::2222 eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions vxlan_encap /
        queue index 0 / end

testpmd&gt; set vxlan-with-vlan ip-version ipv6 vni 4 udp-src 4 udp-dst 4
        ip-src ::1 ip-dst ::2222 vlan-tci 34 eth-src 11:11:11:11:11:11
        eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions vxlan_encap /
        queue index 0 / end

testpmd&gt; set vxlan-tos-ttl ip-version ipv6 vni 4 udp-src 4 udp-dst 4
        ip-tos 0 ip-ttl 255 ::1 ip-dst ::2222 eth-src 11:11:11:11:11:11
        eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions vxlan_encap /
        queue index 0 / end
</pre></div>
</div>
</section>
<section id="sample-nvgre-encapsulation-rule">
<h3><span class="section-number">4.13.38. </span>Sample NVGRE encapsulation rule</h3>
<p>NVGRE encapsulation outer layer has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>IPv4 NVGRE outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set nvgre ip-version ipv4 tni 4 ip-src 127.0.0.1 ip-dst 128.0.0.1
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions nvgre_encap /
       queue index 0 / end

testpmd&gt; set nvgre-with-vlan ip-version ipv4 tni 4 ip-src 127.0.0.1
        ip-dst 128.0.0.1 vlan-tci 34 eth-src 11:11:11:11:11:11
        eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions nvgre_encap /
        queue index 0 / end
</pre></div>
</div>
<p>IPv6 NVGRE outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set nvgre ip-version ipv6 tni 4 ip-src ::1 ip-dst ::2222
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions nvgre_encap /
       queue index 0 / end

testpmd&gt; set nvgre-with-vlan ip-version ipv6 tni 4 ip-src ::1 ip-dst ::2222
       vlan-tci 34 eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern end actions nvgre_encap /
       queue index 0 / end
</pre></div>
</div>
</section>
<section id="sample-l2-encapsulation-rule">
<h3><span class="section-number">4.13.39. </span>Sample L2 encapsulation rule</h3>
<p>L2 encapsulation has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>L2 header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set l2_encap ip-version ipv4
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / mpls / end actions
       mplsoudp_decap / l2_encap / end
</pre></div>
</div>
<p>L2 with VXLAN header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set l2_encap-with-vlan ip-version ipv4 vlan-tci 34
        eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / mpls / end actions
       mplsoudp_decap / l2_encap / end
</pre></div>
</div>
</section>
<section id="sample-l2-decapsulation-rule">
<h3><span class="section-number">4.13.40. </span>Sample L2 decapsulation rule</h3>
<p>L2 decapsulation has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>L2 header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set l2_decap
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap / mplsoudp_encap /
       queue index 0 / end
</pre></div>
</div>
<p>L2 with VXLAN header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set l2_encap-with-vlan
testpmd&gt; flow create 0 egress pattern eth / end actions l2_encap / mplsoudp_encap /
        queue index 0 / end
</pre></div>
</div>
</section>
<section id="sample-mplsogre-encapsulation-rule">
<h3><span class="section-number">4.13.41. </span>Sample MPLSoGRE encapsulation rule</h3>
<p>MPLSoGRE encapsulation outer layer has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>IPv4 MPLSoGRE outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_encap ip-version ipv4 label 4
       ip-src 127.0.0.1 ip-dst 128.0.0.1 eth-src 11:11:11:11:11:11
       eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsogre_encap / end
</pre></div>
</div>
<p>IPv4 MPLSoGRE with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_encap-with-vlan ip-version ipv4 label 4
       ip-src 127.0.0.1 ip-dst 128.0.0.1 vlan-tci 34
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsogre_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoGRE outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_encap ip-version ipv6 mask 4
       ip-src ::1 ip-dst ::2222 eth-src 11:11:11:11:11:11
       eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsogre_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoGRE with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_encap-with-vlan ip-version ipv6 mask 4
       ip-src ::1 ip-dst ::2222 vlan-tci 34
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsogre_encap / end
</pre></div>
</div>
</section>
<section id="sample-mplsogre-decapsulation-rule">
<h3><span class="section-number">4.13.42. </span>Sample MPLSoGRE decapsulation rule</h3>
<p>MPLSoGRE decapsulation outer layer has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>IPv4 MPLSoGRE outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_decap ip-version ipv4
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / gre / mpls / end actions
       mplsogre_decap / l2_encap / end
</pre></div>
</div>
<p>IPv4 MPLSoGRE with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_decap-with-vlan ip-version ipv4
testpmd&gt; flow create 0 ingress pattern eth / vlan / ipv4 / gre / mpls / end
       actions mplsogre_decap / l2_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoGRE outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_decap ip-version ipv6
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / gre / mpls / end
       actions mplsogre_decap / l2_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoGRE with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsogre_decap-with-vlan ip-version ipv6
testpmd&gt; flow create 0 ingress pattern eth / vlan / ipv6 / gre / mpls / end
       actions mplsogre_decap / l2_encap / end
</pre></div>
</div>
</section>
<section id="sample-mplsoudp-encapsulation-rule">
<h3><span class="section-number">4.13.43. </span>Sample MPLSoUDP encapsulation rule</h3>
<p>MPLSoUDP encapsulation outer layer has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>IPv4 MPLSoUDP outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_encap ip-version ipv4 label 4 udp-src 5 udp-dst 10
       ip-src 127.0.0.1 ip-dst 128.0.0.1 eth-src 11:11:11:11:11:11
       eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsoudp_encap / end
</pre></div>
</div>
<p>IPv4 MPLSoUDP with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_encap-with-vlan ip-version ipv4 label 4 udp-src 5
       udp-dst 10 ip-src 127.0.0.1 ip-dst 128.0.0.1 vlan-tci 34
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsoudp_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoUDP outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_encap ip-version ipv6 mask 4 udp-src 5 udp-dst 10
       ip-src ::1 ip-dst ::2222 eth-src 11:11:11:11:11:11
       eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsoudp_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoUDP with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_encap-with-vlan ip-version ipv6 mask 4 udp-src 5
       udp-dst 10 ip-src ::1 ip-dst ::2222 vlan-tci 34
       eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22
testpmd&gt; flow create 0 egress pattern eth / end actions l2_decap /
       mplsoudp_encap / end
</pre></div>
</div>
</section>
<section id="sample-mplsoudp-decapsulation-rule">
<h3><span class="section-number">4.13.44. </span>Sample MPLSoUDP decapsulation rule</h3>
<p>MPLSoUDP decapsulation outer layer has default value pre-configured in testpmd
source code, those can be changed by using the following commands</p>
<p>IPv4 MPLSoUDP outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_decap ip-version ipv4
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / mpls / end actions
       mplsoudp_decap / l2_encap / end
</pre></div>
</div>
<p>IPv4 MPLSoUDP with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_decap-with-vlan ip-version ipv4
testpmd&gt; flow create 0 ingress pattern eth / vlan / ipv4 / udp / mpls / end
       actions mplsoudp_decap / l2_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoUDP outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_decap ip-version ipv6
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / udp / mpls / end
       actions mplsoudp_decap / l2_encap / end
</pre></div>
</div>
<p>IPv6 MPLSoUDP with VLAN outer header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set mplsoudp_decap-with-vlan ip-version ipv6
testpmd&gt; flow create 0 ingress pattern eth / vlan / ipv6 / udp / mpls / end
       actions mplsoudp_decap / l2_encap / end
</pre></div>
</div>
</section>
<section id="sample-raw-encapsulation-rule">
<h3><span class="section-number">4.13.45. </span>Sample Raw encapsulation rule</h3>
<p>Raw encapsulation configuration can be set by the following commands</p>
<p>Encapsulating VxLAN:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set raw_encap 4 eth src is 10:11:22:33:44:55 / vlan tci is 1
       inner_type is 0x0800 / ipv4 / udp dst is 4789 / vxlan vni
       is 2 / end_set
testpmd&gt; flow create 0 egress pattern eth / ipv4 / end actions
       raw_encap index 4 / end
</pre></div>
</div>
</section>
<section id="sample-raw-decapsulation-rule">
<h3><span class="section-number">4.13.46. </span>Sample Raw decapsulation rule</h3>
<p>Raw decapsulation configuration can be set by the following commands</p>
<p>Decapsulating VxLAN:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set raw_decap eth / ipv4 / udp / vxlan / end_set
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / vxlan / eth / ipv4 /
       end actions raw_decap / queue index 0 / end
</pre></div>
</div>
</section>
<section id="sample-esp-rules">
<h3><span class="section-number">4.13.47. </span>Sample ESP rules</h3>
<p>ESP rules can be created by the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / esp spi is 1 / end actions
       queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / esp spi is 1 / end
       actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / esp spi is 1 / end actions
       queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / udp / esp spi is 1 / end
       actions queue index 3 / end
</pre></div>
</div>
</section>
<section id="sample-ah-rules">
<h3><span class="section-number">4.13.48. </span>Sample AH rules</h3>
<p>AH rules can be created by the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / ah spi is 1 / end actions
       queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / ah spi is 1 / end
       actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / ah spi is 1 / end actions
       queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / udp / ah spi is 1 / end
       actions queue index 3 / end
</pre></div>
</div>
</section>
<section id="sample-pfcp-rules">
<h3><span class="section-number">4.13.49. </span>Sample PFCP rules</h3>
<p>PFCP rules can be created by the following commands(s_field need to be 1
if seid is set):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / pfcp s_field is 0 / end
       actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / pfcp s_field is 1
       seid is 1 / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / pfcp s_field is 0 / end
       actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / pfcp s_field is 1
       seid is 1 / end actions queue index 3 / end
</pre></div>
</div>
</section>
<section id="sample-sampling-mirroring-rules">
<h3><span class="section-number">4.13.50. </span>Sample Sampling/Mirroring rules</h3>
<p>Sample/Mirroring rules can be set by the following commands</p>
<p>NIC-RX Sampling rule, the matched ingress packets and sent to the queue 1,
and 50% packets are duplicated and marked with 0x1234 and sent to queue 0.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set sample_actions 0 mark id  0x1234 / queue index 0 / end
testpmd&gt; flow create 0 ingress group 1 pattern eth / end actions
       sample ratio 2 index 0 / queue index 1 / end
</pre></div>
</div>
<p>Match packets coming from a VM which is referred to by means of
its representor ethdev (port 1), mirror 50% of them to the
said representor (for bookkeeping) as well as encapsulate
all the packets and steer them to the physical port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set sample_actions 0 port_representor ethdev_port_id 1 / end

testpmd&gt; set vxlan ip-version ipv4 vni 4 udp-src 32 udp-dst 4789 ip-src 127.0.0.1
   ip-dst 127.0.0.2 eth-src 11:11:11:11:11:11 eth-dst 22:22:22:22:22:22

testpmd&gt; flow create 0 transfer pattern represented_port ethdev_port_id is 1 / end
   actions sample ratio 2 index 0 / vxlan_encap /
   represented_port ethdev_port_id 0 / end
</pre></div>
</div>
<p>The rule is inserted via port 0 (assumed to have “transfer” privilege).</p>
</section>
<section id="sample-integrity-rules">
<h3><span class="section-number">4.13.51. </span>Sample integrity rules</h3>
<p>Integrity rules can be created by the following commands:</p>
<p>Integrity rule that forwards valid TCP packets to group 1.
TCP packet integrity is matched with the <code class="docutils literal notranslate"><span class="pre">l4_ok</span></code> bit 3.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress
           pattern eth / ipv4 / tcp / integrity value mask 8 value spec 8 / end
           actions jump group 1 / end
</pre></div>
</div>
<p>Integrity rule that forwards invalid packets to application.
General packet integrity is matched with the <code class="docutils literal notranslate"><span class="pre">packet_ok</span></code> bit 0.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern integrity value mask 1 value spec 0 / end actions queue index 0 / end
</pre></div>
</div>
</section>
<section id="sample-conntrack-rules">
<h3><span class="section-number">4.13.52. </span>Sample conntrack rules</h3>
<p>Conntrack rules can be set by the following commands</p>
<p>Need to construct the connection context with provided information.
In the first table, create a flow rule by using conntrack action and jump to
the next table. In the next table, create a rule to check the state.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set conntrack com peer 1 is_orig 1 enable 1 live 1 sack 1 cack 0
       last_dir 0 liberal 0 state 1 max_ack_win 7 r_lim 5 last_win 510
       last_seq 2632987379 last_ack 2532480967 last_end 2632987379
       last_index 0x8
testpmd&gt; set conntrack orig scale 7 fin 0 acked 1 unack_data 0
       sent_end 2632987379 reply_end 2633016339 max_win 28960
       max_ack 2632987379
testpmd&gt; set conntrack rply scale 7 fin 0 acked 1 unack_data 0
       sent_end 2532480967 reply_end 2532546247 max_win 65280
       max_ack 2532480967
testpmd&gt; flow indirect_action 0 create ingress action conntrack / end
testpmd&gt; flow create 0 group 3 ingress pattern eth / ipv4 / tcp / end actions indirect 0 / jump group 5 / end
testpmd&gt; flow create 0 group 5 ingress pattern eth / ipv4 / tcp / conntrack is 1 / end actions queue index 5 / end
</pre></div>
</div>
<p>Construct the conntrack again with only “is_orig” set to 0 (other fields are
ignored), then use “update” interface to update the direction. Create flow
rules like above for the peer port.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow indirect_action 0 update 0 action conntrack_update dir / end
</pre></div>
</div>
</section>
<section id="sample-meter-with-policy-rules">
<h3><span class="section-number">4.13.53. </span>Sample meter with policy rules</h3>
<p>Meter with policy rules can be created by the following commands:</p>
<p>Need to create policy first and actions are set for green/yellow/red colors.
Create meter with policy id. Create flow with meter id.</p>
<p>Example for policy with meter color action. The purpose is to color the packet
to reflect the meter color result.
The meter policy action list: <code class="docutils literal notranslate"><span class="pre">green</span> <span class="pre">-&gt;</span> <span class="pre">green,</span> <span class="pre">yellow</span> <span class="pre">-&gt;</span> <span class="pre">yellow,</span> <span class="pre">red</span> <span class="pre">-&gt;</span> <span class="pre">red</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add port meter profile srtcm_rfc2697 0 13 21504 2688 0 0
testpmd&gt; add port meter policy 0 1 g_actions color type green / end y_actions color type yellow / end
         r_actions color type red / end
testpmd&gt; create port meter 0 1 13 1 yes 0xffff 0 0
testpmd&gt; flow create 0 priority 0 ingress group 1 pattern eth / end actions meter mtr_id 1 / end
</pre></div>
</div>
</section>
<section id="sample-l2tpv2-rss-rules">
<h3><span class="section-number">4.13.54. </span>Sample L2TPv2 RSS rules</h3>
<p>L2TPv2 RSS rules can be created by the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 type control
         / end actions rss types l2tpv2 end queues end / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / end
         actions rss types eth l2-src-only end queues end / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / ppp / end
         actions rss types l2tpv2 end queues end / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / ppp / ipv4
         / end actions rss types ipv4 end queues end / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / ppp / ipv6
         / udp / end actions rss types ipv6-udp end queues end / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / udp / l2tpv2 / ppp / ipv4
         / tcp / end actions rss types ipv4-tcp end queues end / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / udp / l2tpv2 / ppp / ipv6
         / end actions rss types ipv6 end queues end / end
</pre></div>
</div>
</section>
<section id="sample-l2tpv2-fdir-rules">
<h3><span class="section-number">4.13.55. </span>Sample L2TPv2 FDIR rules</h3>
<p>L2TPv2 FDIR rules can be created by the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 type control
         session_id is 0x1111 / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth src is 00:00:00:00:00:01 / ipv4
         / udp / l2tpv2 type data / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 type data
         session_id is 0x1111 / ppp / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / ppp / ipv4
         src is 10.0.0.1 / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / udp / l2tpv2 / ppp / ipv6
         dst is ABAB:910B:6666:3457:8295:3333:1800:2929 / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / ppp / ipv4
         / udp src is 22 / end actions queue index 3 / end
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / l2tpv2 / ppp / ipv4
         / tcp dst is 23 / end actions queue index 3 / end
</pre></div>
</div>
</section>
<section id="sample-raw-rule">
<h3><span class="section-number">4.13.56. </span>Sample RAW rule</h3>
<p>A RAW rule can be created as following using <code class="docutils literal notranslate"><span class="pre">pattern_hex</span></code> key and mask.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 group 0 priority 1 ingress pattern raw relative is 0 search is 0 offset
         is 0 limit is 0 pattern_hex spec 00000000000000000000000000000000000000000000000000000a0a0a0a
         pattern_hex mask 0000000000000000000000000000000000000000000000000000ffffffff / end actions
         queue index 4 / end
</pre></div>
</div>
</section>
</section>
<section id="bpf-functions">
<h2><span class="section-number">4.14. </span>BPF Functions</h2>
<p>The following sections show functions to load/unload eBPF based filters.</p>
<section id="bpf-load">
<h3><span class="section-number">4.14.1. </span>bpf-load</h3>
<p>Load an eBPF program as a callback for particular RX/TX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; bpf-load rx|tx (portid) (queueid) (load-flags) (bpf-prog-filename)
</pre></div>
</div>
<p>The available load-flags are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">J</span></code>: use JIT generated native code, otherwise BPF interpreter will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">M</span></code>: assume input parameter is a pointer to rte_mbuf, otherwise assume it is a pointer to first segment’s data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code>: none.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You’ll need clang v3.7 or above to build bpf program you’d like to load</p>
</div>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd examples/bpf</span>
<span class="go">clang -O2 -target bpf -c t1.c</span>
</pre></div>
</div>
<p>Then to load (and JIT compile) t1.o at RX queue 0, port 1:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; bpf-load rx 1 0 J ./dpdk.org/examples/bpf/t1.o</span>
</pre></div>
</div>
<p>To load (not JITed) t1.o at TX queue 0, port 0:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; bpf-load tx 0 0 - ./dpdk.org/examples/bpf/t1.o</span>
</pre></div>
</div>
</section>
<section id="bpf-unload">
<h3><span class="section-number">4.14.2. </span>bpf-unload</h3>
<p>Unload previously loaded eBPF program for particular RX/TX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; bpf-unload rx|tx (portid) (queueid)
</pre></div>
</div>
<p>For example to unload BPF filter from TX queue 0, port 0:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; bpf-unload tx 0 0</span>
</pre></div>
</div>
</section>
</section>
<section id="flex-item-functions">
<h2><span class="section-number">4.15. </span>Flex Item Functions</h2>
<p>The following sections show functions that configure and create flex item object,
create flex pattern and use it in a flow rule.
The commands will use 20 bytes IPv4 header for examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  ver  |  IHL  |     TOS       |        length                 | +0
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       identification          | flg |    frag. offset         | +4
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       TTL     |  protocol     |        checksum               | +8
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               source IP address                               | +12
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              destination IP address                           | +16
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
</div>
<section id="create-flex-item">
<h3><span class="section-number">4.15.1. </span>Create flex item</h3>
<p>Flex item object is created by PMD according to a new header configuration. The
header configuration is compiled by the testpmd and stored in
<code class="docutils literal notranslate"><span class="pre">rte_flow_item_flex_conf</span></code> type variable.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># flow flex_item create &lt;port&gt; &lt;flex id&gt; &lt;configuration file&gt;
testpmd&gt; flow flex_item init 0 3 ipv4_flex_config.json
port-0: created flex item #3
</pre></div>
</div>
<p>Flex item configuration is kept in external JSON file.
It describes the following header elements:</p>
<p><strong>New header length.</strong></p>
<p>Specify whether the new header has fixed or variable length and the basic/minimal
header length value.</p>
<p>If header length is not fixed, header location with a value that completes header
length calculation and scale/offset function must be added.</p>
<p>Scale function depends on port hardware.</p>
<p><strong>Next protocol.</strong></p>
<p>Describes location in the new header that specify following network header type.</p>
<p><strong>Flow match samples.</strong></p>
<p>Describes locations in the new header that will be used in flow rules.</p>
<p>Number of flow samples and sample maximal length depend of port hardware.</p>
<p><strong>Input trigger.</strong></p>
<p>Describes preceding network header configuration.</p>
<p><strong>Output trigger.</strong></p>
<p>Describes conditions that trigger transfer to following network header</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;next_header&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FIELD_MODE_FIXED&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;next_protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;field_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_base&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">72</span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;sample_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FIELD_MODE_FIXED&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_base&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FIELD_MODE_FIXED&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_base&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FIELD_MODE_FIXED&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_base&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FIELD_MODE_FIXED&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;field_base&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">96</span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">],</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;input_link&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eth type is 0x0800&quot;</span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan inner_type is 0x0800&quot;</span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">],</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;output_link&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;udp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;next&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;next&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;icmp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;next&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="flex-pattern-and-flow-rules">
<h3><span class="section-number">4.15.2. </span>Flex pattern and flow rules</h3>
<p>Flex pattern describe parts of network header that will trigger flex flow item hit in a flow rule.
Flex pattern directly related to flex item samples configuration.
Flex pattern can be shared between ports.</p>
<p><strong>Flex pattern and flow rule to match IPv4 version and 20 bytes length</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># set flex_pattern &lt;pattern_id&gt; is &lt;hex bytes sequence&gt;
testpmd&gt; flow flex_item pattern 5 is 45FF
created pattern #5

testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / flex item is 3 pattern is 5 / end actions mark id 1 / queue index 0 / end
Flow rule #0 created
</pre></div>
</div>
<p><strong>Flex pattern and flow rule to match packets with source address 1.2.3.4</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow flex_item pattern 2 spec 45000000000000000000000001020304 mask FF0000000000000000000000FFFFFFFF
created pattern #2

testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / flex item is 3 pattern is 2 / end actions mark id 1 / queue index 0 / end
Flow rule #0 created
</pre></div>
</div>
</section>
</section>
<section id="driver-specific-commands">
<h2><span class="section-number">4.16. </span>Driver specific commands</h2>
<p>Some drivers provide specific features.
See:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../prog_guide/link_bonding_poll_mode_drv_lib.html#bonding-testpmd-commands"><span class="std std-ref">net/bonding testpmd driver specific commands</span></a></p></li>
<li><p><a class="reference internal" href="../nics/i40e.html#net-i40e-testpmd-commands"><span class="std std-ref">net/i40e testpmd driver specific commands</span></a></p></li>
<li><p><a class="reference internal" href="../nics/ixgbe.html#net-ixgbe-testpmd-commands"><span class="std std-ref">net/ixgbe testpmd driver specific commands</span></a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DPDK_logo_vertical_rev_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Data Plane Development Kit</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mldevs/index.html">Machine Learning Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmadevs/index.html">DMA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpus/index.html">General-Purpose Graphics Processing Unit Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Testpmd Application User Guide</a><ul>
      <li>Previous: <a href="run_app.html" title="previous chapter"><span class="section-number">3. </span>Running the Application</a></li>
      <li>Next: <a href="../nics/index.html" title="next chapter">Network Interface Controller Drivers</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/testpmd_app_ug/testpmd_funcs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>