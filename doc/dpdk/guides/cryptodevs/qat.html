
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>21. Intel(R) QuickAssist (QAT) Crypto Poll Mode Driver &#8212; Data Plane Development Kit 23.11.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="22. UADK Crypto Poll Mode Driver" href="uadk.html" />
    <link rel="prev" title="20. SNOW 3G Crypto Poll Mode Driver" href="snow3g.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="intel-r-quickassist-qat-crypto-poll-mode-driver">
<h1><span class="section-number">21. </span>Intel(R) QuickAssist (QAT) Crypto Poll Mode Driver</h1>
<p>QAT documentation consists of three parts:</p>
<ul class="simple">
<li><p>Details of the symmetric and asymmetric crypto services below.</p></li>
<li><p>Details of the <a class="reference internal" href="../compressdevs/qat_comp.html"><span class="doc">compression service</span></a>
in the compressdev drivers section.</p></li>
<li><p>Details of building the common QAT infrastructure and the PMDs to support the
above services. See <a class="reference internal" href="#building-qat"><span class="std std-ref">Building PMDs on QAT</span></a> below.</p></li>
</ul>
<section id="symmetric-crypto-service-on-qat">
<h2><span class="section-number">21.1. </span>Symmetric Crypto Service on QAT</h2>
<p>The QAT symmetric crypto PMD (hereafter referred to as <cite>QAT SYM [PMD]</cite>) provides
poll mode crypto driver support for the following hardware accelerator devices:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">DH895xCC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">C62x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">C3xxx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">200xx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">D15xx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">C4xxx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">4xxx</span></code></p></li>
</ul>
<section id="features">
<h3><span class="section-number">21.1.1. </span>Features</h3>
<p>The QAT SYM PMD has support for:</p>
<p>Cipher algorithms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_3DES_CBC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_3DES_CTR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES128_CBC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES192_CBC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES256_CBC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES128_CTR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES192_CTR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES256_CTR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES_XTS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_SNOW3G_UEA2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_NULL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_KASUMI_F8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_DES_CBC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_AES_DOCSISBPI</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_DES_DOCSISBPI</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_ZUC_EEA3</span></code></p></li>
</ul>
<p>Hash algorithms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA1_HMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA224</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA224_HMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA256</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA256_HMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA384</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA384_HMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA512</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA512_HMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA3_224</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA3_256</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA3_384</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SHA3_512</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_AES_XCBC_MAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SNOW3G_UIA2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_MD5_HMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_NULL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_KASUMI_F9</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_AES_GMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_ZUC_EIA3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_AES_CMAC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SM3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AUTH_SM3_HMAC</span></code></p></li>
</ul>
<p>Supported AEAD algorithms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AEAD_AES_GCM</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AEAD_AES_CCM</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_AEAD_CHACHA20_POLY1305</span></code></p></li>
</ul>
<p>Protocol offloads:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_SECURITY_PROTOCOL_DOCSIS</span></code></p></li>
</ul>
</section>
<section id="supported-chains">
<h3><span class="section-number">21.1.2. </span>Supported Chains</h3>
<p>All the usual chains are supported and also some mixed chains:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 21.1 </span><span class="caption-text">Supported hash-cipher chains for wireless digest-encrypted cases</span></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Cipher algorithm</p></th>
<th class="head"><p>NULL AUTH</p></th>
<th class="head"><p>SNOW3G UIA2</p></th>
<th class="head"><p>ZUC EIA3</p></th>
<th class="head"><p>AES CMAC</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NULL CIPHER</p></td>
<td><p>Y</p></td>
<td><p>2&amp;3</p></td>
<td><p>2&amp;3</p></td>
<td><p>Y</p></td>
</tr>
<tr class="row-odd"><td><p>SNOW3G UEA2</p></td>
<td><p>2&amp;3</p></td>
<td><p>1&amp;2&amp;3</p></td>
<td><p>2&amp;3</p></td>
<td><p>2&amp;3</p></td>
</tr>
<tr class="row-even"><td><p>ZUC EEA3</p></td>
<td><p>2&amp;3</p></td>
<td><p>2&amp;3</p></td>
<td><p>2&amp;3</p></td>
<td><p>2&amp;3</p></td>
</tr>
<tr class="row-odd"><td><p>AES CTR</p></td>
<td><p>1&amp;2&amp;3</p></td>
<td><p>2&amp;3</p></td>
<td><p>2&amp;3</p></td>
<td><p>Y</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>The combinations marked as “Y” are supported on all QAT hardware versions.</p></li>
<li><p>The combinations marked as “2&amp;3” are supported on GEN2 and GEN3 QAT hardware only.</p></li>
<li><p>The combinations marked as “1&amp;2&amp;3” are supported on GEN1, GEN2 and GEN3 QAT hardware only.</p></li>
</ul>
</section>
<section id="limitations">
<h3><span class="section-number">21.1.3. </span>Limitations</h3>
<ul class="simple">
<li><p>Only supports the session-oriented API implementation (session-less APIs are not supported).</p></li>
<li><p>SNOW 3G (UEA2), KASUMI (F8) and ZUC (EEA3) supported only if cipher length and offset fields are byte-multiple.</p></li>
<li><p>SNOW 3G (UIA2) and ZUC (EIA3) supported only if hash length and offset fields are byte-multiple.</p></li>
<li><p>No BSD support as BSD QAT kernel driver not available.</p></li>
<li><p>ZUC EEA3/EIA3 is not supported by dh895xcc devices</p></li>
<li><p>Maximum additional authenticated data (AAD) for GCM is 240 bytes long and must be passed to the device in a buffer rounded up to the nearest block-size multiple (x16) and padded with zeros.</p></li>
<li><p>Queue-pairs are thread-safe on Intel CPUs but Queues are not (that is, within a single
queue-pair all enqueues to the TX queue must be done from one thread and all dequeues
from the RX queue must be done from one thread, but enqueues and dequeues may be done
in different threads.)</p></li>
<li><p>A GCM limitation exists, but only in the case where there are multiple
generations of QAT devices on a single platform.
To optimise performance, the GCM crypto session should be initialised for the
device generation to which the ops will be enqueued. Specifically if a GCM
session is initialised on a GEN2 device, but then attached to an op enqueued
to a GEN3 device, it will work but cannot take advantage of hardware
optimisations in the GEN3 device. And if a GCM session is initialised on a
GEN3 device, then attached to an op sent to a GEN1/GEN2 device, it will not be
enqueued to the device and will be marked as failed. The simplest way to
mitigate this is to use the PCI allowlist to avoid mixing devices of different
generations in the same process if planning to use for GCM.</p></li>
<li><p>The mixed algo feature on GEN2 is not supported by all kernel drivers. Check
the notes under the Available Kernel Drivers table below for specific details.</p></li>
<li><p>Out-of-place is not supported for combined Crypto-CRC DOCSIS security
protocol.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_CIPHER_DES_DOCSISBPI</span></code> is not supported for combined Crypto-CRC
DOCSIS security protocol.</p></li>
<li><p>Multi-segment buffers are not supported for combined Crypto-CRC DOCSIS
security protocol.</p></li>
</ul>
</section>
<section id="extra-notes-on-kasumi-f9">
<h3><span class="section-number">21.1.4. </span>Extra notes on KASUMI F9</h3>
<p>When using KASUMI F9 authentication algorithm, the input buffer must be
constructed according to the
<a class="reference external" href="http://cryptome.org/3gpp/35201-900.pdf">3GPP KASUMI specification</a>
(section 4.4, page 13). The input buffer has to have COUNT (4 bytes),
FRESH (4 bytes), MESSAGE and DIRECTION (1 bit) concatenated. After the DIRECTION
bit, a single ‘1’ bit is appended, followed by between 0 and 7 ‘0’ bits, so that
the total length of the buffer is multiple of 8 bits. Note that the actual
message can be any length, specified in bits.</p>
<p>Once this buffer is passed this way, when creating the crypto operation,
length of data to authenticate “op.sym.auth.data.length” must be the length
of all the items described above, including the padding at the end.
Also, offset of data to authenticate “op.sym.auth.data.offset”
must be such that points at the start of the COUNT bytes.</p>
</section>
</section>
<section id="asymmetric-crypto-service-on-qat">
<h2><span class="section-number">21.2. </span>Asymmetric Crypto Service on QAT</h2>
<p>The QAT asymmetric crypto PMD (hereafter referred to as <cite>QAT ASYM [PMD]</cite>) provides
poll mode crypto driver support for the following hardware accelerator devices:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">DH895xCC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">C62x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">C3xxx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">D15xx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">C4xxx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">4xxx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">QuickAssist</span> <span class="pre">Technology</span> <span class="pre">401xxx</span></code></p></li>
</ul>
<p>The QAT ASYM PMD has support for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_MODEX</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_MODINV</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_RSA</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_ECDSA</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_ECPM</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_ECDH</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_CRYPTO_ASYM_XFORM_SM2</span></code></p></li>
</ul>
<section id="id1">
<h3><span class="section-number">21.2.1. </span>Limitations</h3>
<ul class="simple">
<li><p>Big integers longer than 4096 bits are not supported.</p></li>
<li><p>Queue-pairs are thread-safe on Intel CPUs but Queues are not (that is, within a single
queue-pair all enqueues to the TX queue must be done from one thread and all dequeues
from the RX queue must be done from one thread, but enqueues and dequeues may be done
in different threads.)</p></li>
<li><p>RSA-2560, RSA-3584 are not supported</p></li>
</ul>
</section>
</section>
<section id="building-pmds-on-qat">
<span id="building-qat"></span><h2><span class="section-number">21.3. </span>Building PMDs on QAT</h2>
<p>A QAT device can host multiple acceleration services:</p>
<ul class="simple">
<li><p>symmetric cryptography</p></li>
<li><p>data compression</p></li>
<li><p>asymmetric cryptography</p></li>
</ul>
<p>These services are provided to DPDK applications via PMDs which register to
implement the corresponding cryptodev and compressdev APIs. The PMDs use
common QAT driver code which manages the QAT PCI device. They also depend on a
QAT kernel driver being installed on the platform, see <a class="reference internal" href="#qat-kernel"><span class="std std-ref">Dependency on the QAT kernel driver</span></a> below.</p>
<section id="configuring-and-building-the-dpdk-qat-pmds">
<h3><span class="section-number">21.3.1. </span>Configuring and Building the DPDK QAT PMDs</h3>
<p>Further information on configuring, building and installing DPDK is described
<a class="reference internal" href="../linux_gsg/build_dpdk.html"><span class="doc">here</span></a>.</p>
</section>
<section id="build-configuration">
<span id="building-qat-config"></span><h3><span class="section-number">21.3.2. </span>Build Configuration</h3>
<p>These are the build configuration options affecting QAT, and their default values:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">RTE_PMD_QAT_MAX_PCI_DEVICES=48</span>
<span class="go">RTE_PMD_QAT_COMP_IM_BUFFER_SIZE=65536</span>
</pre></div>
</div>
<p>Both QAT SYM PMD and QAT ASYM PMD have an external dependency on libcrypto, so are not
built by default.</p>
<p>Ubuntu</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">apt install libssl-dev</span>
</pre></div>
</div>
<p>RHEL</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dnf install openssl-devel</span>
</pre></div>
</div>
<p>The QAT compressdev PMD has no external dependencies, so is built by default.</p>
<p>The number of VFs per PF varies - see table below. If multiple QAT packages are
installed on a platform then RTE_PMD_QAT_MAX_PCI_DEVICES should be
adjusted to the number of VFs which the QAT common code will need to handle.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are separate config items (not QAT-specific) for max cryptodevs
RTE_CRYPTO_MAX_DEVS and max compressdevs RTE_COMPRESS_MAX_DEVS,
if necessary these should be adjusted to handle the total of QAT and other
devices which the process will use. In particular for crypto, where each
QAT VF may expose two crypto devices, sym and asym, it may happen that the
number of devices will be bigger than MAX_DEVS and the process will show an error
during PMD initialisation. To avoid this problem RTE_CRYPTO_MAX_DEVS may be
increased or -a, allow domain:bus:devid:func option may be used.</p>
</div>
<p>QAT compression PMD needs intermediate buffers to support Deflate compression
with Dynamic Huffman encoding. RTE_PMD_QAT_COMP_IM_BUFFER_SIZE
specifies the size of a single buffer, the PMD will allocate a multiple of these,
plus some extra space for associated meta-data. For GEN2 devices, 20 buffers are
allocated while for GEN1 devices, 12 buffers are allocated, plus 1472 bytes overhead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the compressed output of a Deflate operation using Dynamic Huffman
Encoding is too big to fit in an intermediate buffer, then the
operation will be split into smaller operations and their results will
be merged afterwards.
This is not possible if any checksum calculation was requested - in such
case the code falls back to fixed compression.
To avoid this less performant case, applications should configure
the intermediate buffer size to be larger than the expected input data size
(compressed output size is usually unknown, so the only option is to make
larger than the input size).</p>
</div>
</section>
<section id="running-qat-pmd-with-insecure-crypto-algorithms">
<h3><span class="section-number">21.3.3. </span>Running QAT PMD with insecure crypto algorithms</h3>
<p>A few insecure crypto algorithms are deprecated from QAT drivers.
This needs to be reflected in DPDK QAT PMD.
DPDK QAT PMD has by default disabled all the insecure crypto algorithms from Gen 1, 2, 3 and 4.
A PMD devarg is used to enable the capability.</p>
<ul class="simple">
<li><p>qat_legacy_capa</p></li>
</ul>
<p>To use this feature the user must set the devarg on process start as a device additional devarg:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a b1:01.2,qat_legacy_capa=1
</pre></div>
</div>
</section>
<section id="running-qat-pmd-with-minimum-threshold-for-burst-size">
<h3><span class="section-number">21.3.4. </span>Running QAT PMD with minimum threshold for burst size</h3>
<p>If only a small number or packets can be enqueued. Each enqueue causes an expensive MMIO write.
These MMIO write occurrences can be optimised by setting any of the following parameters:</p>
<ul class="simple">
<li><p>qat_sym_enq_threshold</p></li>
<li><p>qat_asym_enq_threshold</p></li>
<li><p>qat_comp_enq_threshold</p></li>
</ul>
<p>When any of these parameters is set rte_cryptodev_enqueue_burst function will
return 0 (thereby avoiding an MMIO) if the device is congested and number of packets
possible to enqueue is smaller.
To use this feature the user must set the parameter on process start as a device additional parameter:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 03:01.1,qat_sym_enq_threshold=32,qat_comp_enq_threshold=16
</pre></div>
</div>
<p>All parameters can be used with the same device regardless of order. Parameters are separated
by comma. When the same parameter is used more than once first occurrence of the parameter
is used.
Maximum threshold that can be set is 32.</p>
</section>
<section id="running-qat-pmd-with-cipher-crc-offload-feature">
<h3><span class="section-number">21.3.5. </span>Running QAT PMD with Cipher-CRC offload feature</h3>
<p>Support has been added to the QAT symmetric crypto PMD for combined Cipher-CRC offload,
primarily for the Crypto-CRC DOCSIS security protocol, on GEN2/GEN3/GEN4 QAT devices.</p>
<p>The following devarg enables a Cipher-CRC offload capability check to determine
if the feature is supported on the QAT device.</p>
<ul class="simple">
<li><p>qat_sym_cipher_crc_enable</p></li>
</ul>
<p>When enabled, a capability check for the combined Cipher-CRC offload feature is triggered
to the QAT firmware during queue pair initialization. If supported by the firmware,
any subsequent runtime Crypto-CRC DOCSIS security protocol requests handled by the QAT PMD
are offloaded to the QAT device by setting up the content descriptor and request accordingly.
If not supported, the CRC is calculated by the QAT PMD using the NET CRC API.</p>
<p>To use this feature the user must set the devarg on process start as a device additional devarg:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 03:01.1,qat_sym_cipher_crc_enable=1
</pre></div>
</div>
</section>
<section id="running-qat-pmd-with-intel-ipsec-mb-library-for-symmetric-precomputes-function">
<h3><span class="section-number">21.3.6. </span>Running QAT PMD with Intel IPsec MB library for symmetric precomputes function</h3>
<p>The QAT PMD uses Intel IPsec MB library for partial hash calculation
in symmetric precomputes function by default,
the minimum required version of IPsec MB library is v1.4.
If this version of IPsec is not met, it will fallback to use OpenSSL.
ARM will always default to using OpenSSL
as ARM IPsec MB does not support the necessary algorithms.</p>
</section>
<section id="device-and-driver-naming">
<h3><span class="section-number">21.3.7. </span>Device and driver naming</h3>
<ul class="simple">
<li><p>The qat cryptodev symmetric crypto driver name is “crypto_qat”.</p></li>
<li><p>The qat cryptodev asymmetric crypto driver name is “crypto_qat_asym”.</p></li>
</ul>
<p>The “rte_cryptodev_devices_get()” returns the devices exposed by either of these drivers.</p>
<ul class="simple">
<li><p>Each qat sym crypto device has a unique name, in format
“&lt;pci bdf&gt;_&lt;service&gt;”, e.g. “0000:41:01.0_qat_sym”.</p></li>
<li><p>Each qat asym crypto device has a unique name, in format
“&lt;pci bdf&gt;_&lt;service&gt;”, e.g. “0000:41:01.0_qat_asym”.
This name can be passed to “rte_cryptodev_get_dev_id()” to get the device_id.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The cryptodev driver name is passed to the dpdk-test-crypto-perf tool in the “-devtype” parameter.</p>
<p>The qat crypto device name is in the format of the worker parameter passed to the crypto scheduler.</p>
</div>
<ul class="simple">
<li><p>The qat compressdev driver name is “compress_qat”.
The rte_compressdev_devices_get() returns the devices exposed by this driver.</p></li>
<li><p>Each qat compression device has a unique name, in format
&lt;pci bdf&gt;_&lt;service&gt;, e.g. “0000:41:01.0_qat_comp”.
This name can be passed to rte_compressdev_get_dev_id() to get the device_id.</p></li>
</ul>
</section>
<section id="running-qat-on-aarch64-based-ampere-altra-platform">
<h3><span class="section-number">21.3.8. </span>Running QAT on Aarch64 based Ampere Altra platform</h3>
<p>Requires Linux kernel v6.0+.
See also <a class="reference external" href="https://lkml.org/lkml/2022/6/17/328">this kernel patch</a>.</p>
</section>
<section id="dependency-on-the-qat-kernel-driver">
<span id="qat-kernel"></span><h3><span class="section-number">21.3.9. </span>Dependency on the QAT kernel driver</h3>
<p>To use QAT an SRIOV-enabled QAT kernel driver is required. The VF
devices created and initialised by this driver will be used by the QAT PMDs.</p>
<p>Instructions for installation are below, but first an explanation of the
relationships between the PF/VF devices and the PMDs visible to
DPDK applications.</p>
<p>Each QuickAssist PF device exposes a number of VF devices. Each VF device can
enable one symmetric cryptodev PMD and/or one asymmetric cryptodev PMD and/or
one compressdev PMD.
These QAT PMDs share the same underlying device and pci-mgmt code, but are
enumerated independently on their respective APIs and appear as independent
devices to applications.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each VF can only be used by one DPDK process. It is not possible to share
the same VF across multiple processes, even if these processes are using
different acceleration services.</p>
<p>Conversely one DPDK process can use one or more QAT VFs and can expose both
cryptodev and compressdev instances on each of those VFs.</p>
</div>
</section>
<section id="available-kernel-drivers">
<h3><span class="section-number">21.3.10. </span>Available kernel drivers</h3>
<p>Kernel drivers for each device for each service are listed in the following table. (Scroll right
to see the full table)</p>
<span id="table-qat-pmds-drivers"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 21.2 </span><span class="caption-text">QAT device generations, devices and drivers</span></caption>
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 12%" />
<col style="width: 8%" />
<col style="width: 6%" />
<col style="width: 8%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>S</p></th>
<th class="head"><p>A</p></th>
<th class="head"><p>C</p></th>
<th class="head"><p>Gen</p></th>
<th class="head"><p>Device</p></th>
<th class="head"><p>Driver/ver</p></th>
<th class="head"><p>Kernel Module</p></th>
<th class="head"><p>Pci Driver</p></th>
<th class="head"><p>PF Did</p></th>
<th class="head"><p>#PFs</p></th>
<th class="head"><p>VF Did</p></th>
<th class="head"><p>VFs/PF</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>1</p></td>
<td><p>DH895xCC</p></td>
<td><p>linux/4.4+</p></td>
<td><p>qat_dh895xcc</p></td>
<td><p>dh895xcc</p></td>
<td><p>435</p></td>
<td><p>1</p></td>
<td><p>443</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>IDZ/4.12.0+</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>IDZ/4.13.0+</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>2</p></td>
<td><p>C62x</p></td>
<td><p>linux/4.5+</p></td>
<td><p>qat_c62x</p></td>
<td><p>c6xx</p></td>
<td><p>37c8</p></td>
<td><p>3</p></td>
<td><p>37c9</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>IDZ/4.12.0+</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>2</p></td>
<td><p>C3xxx</p></td>
<td><p>linux/4.5+</p></td>
<td><p>qat_c3xxx</p></td>
<td><p>c3xxx</p></td>
<td><p>19e2</p></td>
<td><p>1</p></td>
<td><p>19e3</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>IDZ/4.12.0+</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
<td><p>“</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>2</p></td>
<td><p>200xx</p></td>
<td><p>p</p></td>
<td><p>qat_200xx</p></td>
<td><p>200xx</p></td>
<td><p>18ee</p></td>
<td><p>1</p></td>
<td><p>18ef</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>2</p></td>
<td><p>D15xx</p></td>
<td><p>p</p></td>
<td><p>qat_d15xx</p></td>
<td><p>d15xx</p></td>
<td><p>6f54</p></td>
<td><p>1</p></td>
<td><p>6f55</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>3</p></td>
<td><p>C4xxx</p></td>
<td><p>p</p></td>
<td><p>qat_c4xxx</p></td>
<td><p>c4xxx</p></td>
<td><p>18a0</p></td>
<td><p>1</p></td>
<td><p>18a1</p></td>
<td><p>128</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>4</p></td>
<td><p>4xxx</p></td>
<td><p>linux/5.11+</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4940</p></td>
<td><p>4</p></td>
<td><p>4941</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>4</p></td>
<td><p>4xxx</p></td>
<td><p>linux/5.17+</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4940</p></td>
<td><p>4</p></td>
<td><p>4941</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>4</p></td>
<td><p>4xxx</p></td>
<td><p>IDZ/ N/A</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4940</p></td>
<td><p>4</p></td>
<td><p>4941</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>4</p></td>
<td><p>401xxx</p></td>
<td><p>linux/5.19+</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4942</p></td>
<td><p>2</p></td>
<td><p>4943</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>4</p></td>
<td><p>401xxx</p></td>
<td><p>IDZ/ N/A</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4942</p></td>
<td><p>2</p></td>
<td><p>4943</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>4</p></td>
<td><p>402xx</p></td>
<td><p>linux/6.4+</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4944</p></td>
<td><p>2</p></td>
<td><p>4945</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>4</p></td>
<td><p>402xx</p></td>
<td><p>IDZ/ N/A</p></td>
<td><p>qat_4xxx</p></td>
<td><p>4xxx</p></td>
<td><p>4944</p></td>
<td><p>2</p></td>
<td><p>4945</p></td>
<td><p>16</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Note: Symmetric mixed crypto algorithms feature on Gen 2 works only with IDZ driver version 4.9.0+</p></li>
</ul>
<p>The first 3 columns indicate the service:</p>
<ul class="simple">
<li><p>S = Symmetric crypto service (via cryptodev API)</p></li>
<li><p>A = Asymmetric crypto service  (via cryptodev API)</p></li>
<li><p>C = Compression service (via compressdev API)</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Driver</span></code> column indicates either the Linux kernel version in which
support for this device was introduced or a driver available on Intel Developer Zone (IDZ).
There are both linux in-tree and IDZ kernel drivers available for some
devices. p = release pending.</p>
<p>If you are running on a kernel which includes a driver for your device, see
<a class="reference internal" href="#installation-using-kernel-org-driver">Installation using kernel.org driver</a> below. Otherwise see
<a class="reference internal" href="#installation-using-idz-qat-driver">Installation using IDZ QAT driver</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The asymmetric service is not supported by DPDK QAT PMD for the Gen 3 platform.
The actual crypto services enabled on the system depend
on QAT driver capabilities and hardware slice configuration.</p>
</div>
</section>
<section id="installation-using-kernel-org-driver">
<h3><span class="section-number">21.3.11. </span>Installation using kernel.org driver</h3>
<p>The examples below are based on the C62x device, if you have a different device
use the corresponding values in the above table.</p>
<p>In BIOS ensure that SRIOV is enabled and either:</p>
<ul class="simple">
<li><p>Disable VT-d or</p></li>
<li><p>Enable VT-d and set <code class="docutils literal notranslate"><span class="pre">&quot;intel_iommu=on</span> <span class="pre">iommu=pt&quot;</span></code> in the grub file.</p></li>
</ul>
<p>Check that the QAT driver is loaded on your system, by executing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lsmod | grep qa
</pre></div>
</div>
<p>You should see the kernel module for your device listed, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qat_c62x               5626  0
intel_qat              82336  1 qat_c62x
</pre></div>
</div>
<p>Next, you need to expose the Virtual Functions (VFs) using the sysfs file system.</p>
<p>First find the BDFs (Bus-Device-Function) of the physical functions (PFs) of
your device, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lspci -d:37c8
</pre></div>
</div>
<p>You should see output similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1a:00.0 Co-processor: Intel Corporation Device 37c8
3d:00.0 Co-processor: Intel Corporation Device 37c8
3f:00.0 Co-processor: Intel Corporation Device 37c8
</pre></div>
</div>
<p>Enable the VFs for each PF by echoing the number of VFs per PF to the pci driver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 16 &gt; /sys/bus/pci/drivers/c6xx/0000:1a:00.0/sriov_numvfs
echo 16 &gt; /sys/bus/pci/drivers/c6xx/0000:3d:00.0/sriov_numvfs
echo 16 &gt; /sys/bus/pci/drivers/c6xx/0000:3f:00.0/sriov_numvfs
</pre></div>
</div>
<p>Check that the VFs are available for use. For example <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d:37c9</span></code> should
list 48 VF devices available for a <code class="docutils literal notranslate"><span class="pre">C62x</span></code> device.</p>
<p>To complete the installation follow the instructions in
<a class="reference internal" href="#binding-the-available-vfs-to-the-vfio-pci-driver">Binding the available VFs to the vfio-pci driver</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the QAT kernel modules are not loaded and you see an error like <code class="docutils literal notranslate"><span class="pre">Failed</span>
<span class="pre">to</span> <span class="pre">load</span> <span class="pre">MMP</span> <span class="pre">firmware</span> <span class="pre">qat_895xcc_mmp.bin</span></code> in kernel logs, this may be as a
result of not using a distribution, but just updating the kernel directly.</p>
<p>Download firmware from the <a class="reference external" href="http://git.kernel.org/cgit/linux/kernel/git/firmware/linux-firmware.git/tree/">kernel firmware repo</a>.</p>
<p>Copy qat binaries to <code class="docutils literal notranslate"><span class="pre">/lib/firmware</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp qat_895xcc.bin /lib/firmware
cp qat_895xcc_mmp.bin /lib/firmware
</pre></div>
</div>
<p>Change to your linux source root directory and start the qat kernel modules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>insmod ./drivers/crypto/qat/qat_common/intel_qat.ko
insmod ./drivers/crypto/qat/qat_dh895xcc/qat_dh895xcc.ko
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you see the following warning in <code class="docutils literal notranslate"><span class="pre">/var/log/messages</span></code> it can be ignored:
<code class="docutils literal notranslate"><span class="pre">IOMMU</span> <span class="pre">should</span> <span class="pre">be</span> <span class="pre">enabled</span> <span class="pre">for</span> <span class="pre">SR-IOV</span> <span class="pre">to</span> <span class="pre">work</span> <span class="pre">correctly</span></code>.</p>
</div>
</section>
<section id="installation-using-idz-qat-driver">
<h3><span class="section-number">21.3.12. </span>Installation using IDZ QAT driver</h3>
<p>Download the latest QuickAssist Technology Driver from <a class="reference external" href="https://developer.intel.com/quickassist">Intel Developer Zone</a>.
Consult the <em>Quick Start Guide</em> at the same URL for further information.</p>
<p>The steps below assume you are:</p>
<ul class="simple">
<li><p>Building on a platform with one <code class="docutils literal notranslate"><span class="pre">C62x</span></code> device.</p></li>
<li><p>Using package <code class="docutils literal notranslate"><span class="pre">qat1.7.l.4.2.0-000xx.tar.gz</span></code>.</p></li>
<li><p>On Fedora26 kernel <code class="docutils literal notranslate"><span class="pre">4.11.11-300.fc26.x86_64</span></code>.</p></li>
</ul>
<p>In the BIOS ensure that SRIOV is enabled and VT-d is disabled.</p>
<p>Uninstall any existing QAT driver, for example by running:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">./installer.sh</span> <span class="pre">uninstall</span></code> in the directory where originally installed.</p></li>
</ul>
<p>Build and install the SRIOV-enabled QAT driver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mkdir /QAT
cd /QAT

# Copy the package to this location and unpack
tar zxof qat1.7.l.4.2.0-000xx.tar.gz

./configure --enable-icp-sriov=host
make install
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/sys/kernel/debug/qat&lt;your</span> <span class="pre">device</span> <span class="pre">type</span> <span class="pre">and</span> <span class="pre">bdf&gt;/version/fw</span></code> to confirm the driver is correctly installed and is using firmware version 4.2.0.
You can use <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d:37c9</span></code> to confirm the presence of the 16 VF devices available per <code class="docutils literal notranslate"><span class="pre">C62x</span></code> PF.</p>
<p>Confirm the driver is correctly installed and is using firmware version 4.2.0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/qat&lt;your device type and bdf&gt;/version/fw
</pre></div>
</div>
<p>Confirm the presence of 48 VF devices - 16 per PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lspci -d:37c9
</pre></div>
</div>
<p>To complete the installation - follow instructions in
<a class="reference internal" href="#binding-the-available-vfs-to-the-vfio-pci-driver">Binding the available VFs to the vfio-pci driver</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If using a later kernel and the build fails with an error relating to
<code class="docutils literal notranslate"><span class="pre">strict_stroul</span></code> not being available apply the following patch:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w">/QAT/QAT1.6/quickassist/utilities/downloader/Target_CoreLibs/uclo/include/linux/uclo_platform.h</span>
<span class="gi">+ #if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(3,18,5)</span><span class="w"></span>
<span class="gi">+ #define STR_TO_64(str, base, num, endPtr) {endPtr=NULL; if (kstrtoul((str), (base), (num))) printk(&quot;Error strtoull convert %s\n&quot;, str); }</span><span class="w"></span>
<span class="gi">+ #else</span><span class="w"></span>
<span class="w">#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,38)</span>
<span class="w">#define STR_TO_64(str, base, num, endPtr) {endPtr=NULL; if (strict_strtoull((str), (base), (num))) printk(&quot;Error strtoull convert %s\n&quot;, str); }</span>
<span class="w">#else</span>
<span class="w">#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,25)</span>
<span class="w">#define STR_TO_64(str, base, num, endPtr) {endPtr=NULL; strict_strtoll((str), (base), (num));}</span>
<span class="w">#else</span>
<span class="w">#define STR_TO_64(str, base, num, endPtr)                                 \</span>
<span class="w"> </span>    do {                                                               \<span class="w"></span>
<span class="w"> </span>          if (str[0] == &#39;-&#39;)                                           \<span class="w"></span>
<span class="w"> </span>          {                                                            \<span class="w"></span>
<span class="w"> </span>               *(num) = -(simple_strtoull((str+1), &amp;(endPtr), (base))); \<span class="w"></span>
<span class="w"> </span>          }else {                                                      \<span class="w"></span>
<span class="w"> </span>               *(num) = simple_strtoull((str), &amp;(endPtr), (base));      \<span class="w"></span>
<span class="w"> </span>          }                                                            \<span class="w"></span>
<span class="w"> </span>    } while(0)<span class="w"></span>
<span class="gi">+ #endif</span><span class="w"></span>
<span class="w">#endif</span>
<span class="w">#endif</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the build fails due to missing header files you may need to do following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo yum install zlib-devel
sudo yum install openssl-devel
sudo yum install libudev-devel
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the build or install fails due to mismatching kernel sources you may need to do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo yum install kernel-headers-`uname -r`
sudo yum install kernel-src-`uname -r`
sudo yum install kernel-devel-`uname -r`
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the build fails on newer GCC versions (such as GCC 12) with an error relating to
<code class="docutils literal notranslate"><span class="pre">-lc</span></code> not being found, apply the following patch:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w">/QAT/quickassist/lookaside/access_layer/src/Makefile</span>
<span class="w">cd $(ICP_FINAL_OUTPUT_DIR);\</span>
<span class="w">cmd=&quot;$(LINKER) $(LIB_SHARED_FLAGS) -o \</span>
<span class="w"> </span> $(LIB_SHARED) $(ADDITIONAL_OBJECTS) $(ADDITIONAL_LIBS) *.o -lpthread -ludev \<span class="w"></span>
<span class="gd">- -Bstatic -L$(ADF_DIR)/src/build/$(ICP_OS)/$(ICP_OS_LEVEL) \</span><span class="w"></span>
<span class="gd">- -ladf_user -L$(OSAL_DIR)/src/build/$(ICP_OS)/$(ICP_OS_LEVEL)/ \</span><span class="w"></span>
<span class="gd">- -losal -Bdynamic -lc&quot;; \</span><span class="w"></span>
<span class="gi">+ -Bstatic -L$(ADF_DIR)/src/build/$(ICP_OS)/$(ICP_OS_LEVEL) \</span><span class="w"></span>
<span class="gi">+ -ladf_user -L$(OSAL_DIR)/src/build/$(ICP_OS)/$(ICP_OS_LEVEL)/ \</span><span class="w"></span>
<span class="gi">+ -losal -Bdynamic -L/lib/x86_64-linux-gnu/ -lc&quot;; \</span><span class="w"></span>
<span class="w">echo &quot;$$cmd&quot;; \</span>
<span class="w">$$cmd</span>
</pre></div>
</div>
<p>Followed by this patch:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w">/QAT/quickassist/build_system/build_files/OS/linux_common_user_space_rules.mk</span>
<span class="gu">@echo &#39;Creating shared library ${LIB_SHARED}&#39;; \</span><span class="w"></span>
<span class="w">cd $($(PROG_ACY)_FINAL_OUTPUT_DIR);\</span>
<span class="gd">-  echo $(LINKER) $(LIB_SHARED_FLAGS) -o $@  $(OBJECTS) $(ADDITIONAL_OBJECTS) -lc;\</span><span class="w"></span>
<span class="gd">-  $(LINKER) $(LIB_SHARED_FLAGS) -o $@  $(OBJECTS) $(ADDITIONAL_OBJECTS) -lc ;</span><span class="w"></span>
<span class="gi">+  echo $(LINKER) $(LIB_SHARED_FLAGS) -o $@  $(OBJECTS) $(ADDITIONAL_OBJECTS) \</span><span class="w"></span>
<span class="gi">+  -L/lib/x86_64-linux-gnu/ -lc;\</span><span class="w"></span>
<span class="gi">+  $(LINKER) $(LIB_SHARED_FLAGS) -o $@  $(OBJECTS) $(ADDITIONAL_OBJECTS) \</span><span class="w"></span>
<span class="gi">+  -L/lib/x86_64-linux-gnu/ -lc ;</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="binding-the-available-vfs-to-the-vfio-pci-driver">
<h3><span class="section-number">21.3.13. </span>Binding the available VFs to the vfio-pci driver</h3>
<p>Note:</p>
<ul class="simple">
<li><p>Please note that due to security issues, the usage of older DPDK igb_uio
driver is not recommended. This document shows how to use the more secure
vfio-pci driver.</p></li>
<li><p>If QAT fails to bind to vfio-pci on Linux kernel 5.9+, please see the
QATE-39220 and QATE-7495 issues in
<a class="reference external" href="https://cdrdv2.intel.com/v1/dl/getContent/710057?explicitVersion=true">IDZ doc</a>
which details the constraint about trusted guests and add <cite>disable_denylist=1</cite>
to the vfio-pci params to use QAT. See also <a class="reference external" href="https://lkml.org/lkml/2020/7/23/1155">this patch description</a>.</p></li>
</ul>
<p>Unbind the VFs from the stock driver so they can be bound to the vfio-pci driver.</p>
<section id="for-an-intel-r-quickassist-technology-dh895xcc-device">
<h4><span class="section-number">21.3.13.1. </span>For an Intel(R) QuickAssist Technology DH895xCC device</h4>
<p>The unbind command below assumes <code class="docutils literal notranslate"><span class="pre">BDFs</span></code> of <code class="docutils literal notranslate"><span class="pre">03:01.00-03:04.07</span></code>, if your
VFs are different adjust the unbind command below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd to the top-level DPDK directory
for device in $(seq 1 4); do \
    for fn in $(seq 0 7); do \
        usertools/dpdk-devbind.py -u 0000:03:0${device}.${fn}; \
    done; \
done
</pre></div>
</div>
</section>
<section id="for-an-intel-r-quickassist-technology-c62x-device">
<h4><span class="section-number">21.3.13.2. </span>For an Intel(R) QuickAssist Technology C62x device</h4>
<p>The unbind command below assumes <code class="docutils literal notranslate"><span class="pre">BDFs</span></code> of <code class="docutils literal notranslate"><span class="pre">1a:01.00-1a:02.07</span></code>,
<code class="docutils literal notranslate"><span class="pre">3d:01.00-3d:02.07</span></code> and <code class="docutils literal notranslate"><span class="pre">3f:01.00-3f:02.07</span></code>, if your VFs are different
adjust the unbind command below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd to the top-level DPDK directory
for device in $(seq 1 2); do \
    for fn in $(seq 0 7); do \
        usertools/dpdk-devbind.py -u 0000:1a:0${device}.${fn}; \
        usertools/dpdk-devbind.py -u 0000:3d:0${device}.${fn}; \
        usertools/dpdk-devbind.py -u 0000:3f:0${device}.${fn}; \
    done; \
done
</pre></div>
</div>
</section>
<section id="for-intel-r-quickassist-technology-c3xxx-or-200xx-or-d15xx-device">
<h4><span class="section-number">21.3.13.3. </span>For Intel(R) QuickAssist Technology C3xxx or 200xx or D15xx device</h4>
<p>The unbind command below assumes <code class="docutils literal notranslate"><span class="pre">BDFs</span></code> of <code class="docutils literal notranslate"><span class="pre">01:01.00-01:02.07</span></code>, if your
VFs are different adjust the unbind command below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd to the top-level DPDK directory
for device in $(seq 1 2); do \
    for fn in $(seq 0 7); do \
        usertools/dpdk-devbind.py -u 0000:01:0${device}.${fn}; \
    done; \
done
</pre></div>
</div>
</section>
<section id="bind-to-the-vfio-pci-driver">
<h4><span class="section-number">21.3.13.4. </span>Bind to the vfio-pci driver</h4>
<p>Load the vfio-pci driver, bind the VF PCI Device id to it using the
<code class="docutils literal notranslate"><span class="pre">dpdk-devbind.py</span></code> script then use the <code class="docutils literal notranslate"><span class="pre">--status</span></code> option
to confirm the VF devices are now in use by vfio-pci kernel driver,
e.g. for the C62x device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd to the top-level DPDK directory
modprobe vfio-pci
usertools/dpdk-devbind.py -b vfio-pci 0000:03:01.1
usertools/dpdk-devbind.py --status
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">modprobe</span> <span class="pre">vfio-pci</span> <span class="pre">disable_denylist=1</span></code> from kernel 5.9 onwards.
See note in the section <a class="reference internal" href="#binding-the-available-vfs-to-the-vfio-pci-driver">Binding the available VFs to the vfio-pci driver</a>
above.</p>
</section>
</section>
<section id="testing">
<h3><span class="section-number">21.3.14. </span>Testing</h3>
<p>QAT SYM crypto PMD can be tested by running the test application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ./&lt;build_dir&gt;/app/test
./dpdk-test -l1 -n1 -a &lt;your qat bdf&gt;
RTE&gt;&gt;cryptodev_qat_autotest
</pre></div>
</div>
<p>QAT ASYM crypto PMD can be tested by running the test application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ./&lt;build_dir&gt;/app/test
./dpdk-test -l1 -n1 -a &lt;your qat bdf&gt;
RTE&gt;&gt;cryptodev_qat_asym_autotest
</pre></div>
</div>
<p>QAT compression PMD can be tested by running the test application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ./&lt;build_dir&gt;/app/test
./dpdk-test -l1 -n1 -a &lt;your qat bdf&gt;
RTE&gt;&gt;compressdev_autotest
</pre></div>
</div>
</section>
<section id="debugging">
<h3><span class="section-number">21.3.15. </span>Debugging</h3>
<p>There are 2 sets of trace available via the dynamic logging feature:</p>
<ul class="simple">
<li><p>pmd.qat.dp exposes trace on the data-path.</p></li>
<li><p>pmd.qat.general exposes all other trace.</p></li>
</ul>
<p>pmd.qat exposes both sets of traces.
They can be enabled using the log-level option (where 8=maximum log level) on
the process cmdline, e.g. using any of the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--log-level=&quot;pmd.qat.general,8&quot;
--log-level=&quot;pmd.qat.dp,8&quot;
--log-level=&quot;pmd.qat,8&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The global RTE_LOG_DP_LEVEL overrides data-path trace so must be set to
RTE_LOG_DEBUG to see all the trace. This variable is in config/rte_config.h
for meson build.
Also the dynamic global log level overrides both sets of trace, so e.g. no
QAT trace would display in this case:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--log-level=&quot;7&quot; --log-level=&quot;pmd.qat.general,8&quot;
</pre></div>
</div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DPDK_logo_vertical_rev_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Data Plane Development Kit</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mldevs/index.html">Machine Learning Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmadevs/index.html">DMA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpus/index.html">General-Purpose Graphics Processing Unit Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Crypto Device Drivers</a><ul>
      <li>Previous: <a href="snow3g.html" title="previous chapter"><span class="section-number">20. </span>SNOW 3G Crypto Poll Mode Driver</a></li>
      <li>Next: <a href="uadk.html" title="next chapter"><span class="section-number">22. </span>UADK Crypto Poll Mode Driver</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/cryptodevs/qat.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>