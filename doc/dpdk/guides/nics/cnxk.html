
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>12. CNXK Poll Mode driver &#8212; Data Plane Development Kit 23.11.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="13. CPFL Poll Mode Driver" href="cpfl.html" />
    <link rel="prev" title="11. BNXT Poll Mode Driver" href="bnxt.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="cnxk-poll-mode-driver">
<h1><span class="section-number">12. </span>CNXK Poll Mode driver</h1>
<p>The CNXK ETHDEV PMD (<strong>librte_net_cnxk</strong>) provides poll mode ethdev driver
support for the inbuilt network device found in <strong>Marvell OCTEON CN9K/CN10K</strong>
SoC family as well as for their virtual functions (VF) in SR-IOV context.</p>
<p>More information can be found at <a class="reference external" href="https://www.marvell.com/embedded-processors/infrastructure-processors">Marvell Official Website</a>.</p>
<section id="features">
<h2><span class="section-number">12.1. </span>Features</h2>
<p>Features of the CNXK Ethdev PMD are:</p>
<ul class="simple">
<li><p>Packet type information</p></li>
<li><p>Promiscuous mode</p></li>
<li><p>Jumbo frames</p></li>
<li><p>SR-IOV VF</p></li>
<li><p>Lock-free Tx queue</p></li>
<li><p>Multiple queues for TX and RX</p></li>
<li><p>Receiver Side Scaling (RSS)</p></li>
<li><p>MAC filtering</p></li>
<li><p>Generic flow API</p></li>
<li><p>Inner and Outer Checksum offload</p></li>
<li><p>Port hardware statistics</p></li>
<li><p>Link state information</p></li>
<li><p>Link flow control</p></li>
<li><p>MTU update</p></li>
<li><p>Scatter-Gather IO support</p></li>
<li><p>Vector Poll mode driver</p></li>
<li><p>Debug utilities - Context dump and error interrupt support</p></li>
<li><p>Support Rx interrupt</p></li>
<li><p>Inline IPsec processing support</p></li>
<li><p>Ingress meter support</p></li>
<li><p>Queue based priority flow control support</p></li>
</ul>
</section>
<section id="prerequisites">
<h2><span class="section-number">12.2. </span>Prerequisites</h2>
<p>See <a class="reference internal" href="../platform/cnxk.html"><span class="doc">Marvell cnxk platform guide</span></a> for setup information.</p>
</section>
<section id="driver-compilation-and-testing">
<h2><span class="section-number">12.3. </span>Driver compilation and testing</h2>
<p>Refer to the document <a class="reference internal" href="build_and_test.html#pmd-build-and-test"><span class="std std-ref">compiling and testing a PMD for a NIC</span></a>
for details.</p>
<ol class="arabic">
<li><p>Running testpmd:</p>
<p>Follow instructions available in the document
<a class="reference internal" href="build_and_test.html#pmd-build-and-test"><span class="std std-ref">compiling and testing a PMD for a NIC</span></a>
to run testpmd.</p>
<p>Example output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./&lt;build_dir&gt;/app/dpdk-testpmd -c 0xc -a 0002:02:00.0 -- --portmask=0x1 --nb-cores=1 --port-topology=loop --rxq=1 --txq=1</span>
<span class="go">EAL: Detected 4 lcore(s)</span>
<span class="go">EAL: Detected 1 NUMA nodes</span>
<span class="go">EAL: Multi-process socket /var/run/dpdk/rte/mp_socket</span>
<span class="go">EAL: Selected IOVA mode &#39;VA&#39;</span>
<span class="go">EAL: No available hugepages reported in hugepages-16777216kB</span>
<span class="go">EAL: No available hugepages reported in hugepages-2048kB</span>
<span class="go">EAL: Probing VFIO support...</span>
<span class="go">EAL: VFIO support initialized</span>
<span class="go">EAL:   using IOMMU type 1 (Type 1)</span>
<span class="go">[ 2003.202721] vfio-pci 0002:02:00.0: vfio_cap_init: hiding cap 0x14@0x98</span>
<span class="go">EAL: Probe PCI driver: net_cn10k (177d:a063) device: 0002:02:00.0 (socket 0)</span>
<span class="go">PMD: RoC Model: cn10k</span>
<span class="go">EAL: No legacy callbacks, legacy socket not created</span>
<span class="go">testpmd: create a new mbuf pool &lt;mb_pool_0&gt;: n=155456, size=2176, socket=0</span>
<span class="go">testpmd: preferred mempool ops selected: cn10k_mempool_ops</span>
<span class="go">Configuring Port 0 (socket 0)</span>
<span class="go">PMD: Port 0: Link Up - speed 25000 Mbps - full-duplex</span>

<span class="go">Port 0: link state change event</span>
<span class="go">Port 0: 96:D4:99:72:A5:BF</span>
<span class="go">Checking link statuses...</span>
<span class="go">Done</span>
<span class="go">No commandline core given, start packet forwarding</span>
<span class="go">io packet forwarding - ports=1 - cores=1 - streams=1 - NUMA support enabled, MP allocation mode: native</span>
<span class="go">Logical Core 3 (socket 0) forwards packets on 1 streams:</span>
<span class="go">  RX P=0/Q=0 (socket 0) -&gt; TX P=0/Q=0 (socket 0) peer=02:00:00:00:00:00</span>

<span class="go">  io packet forwarding packets/burst=32</span>
<span class="go">  nb forwarding cores=1 - nb forwarding ports=1</span>
<span class="go">  port 0: RX queue number: 1 Tx queue number: 1</span>
<span class="go">    Rx offloads=0x0 Tx offloads=0x10000</span>
<span class="go">    RX queue: 0</span>
<span class="go">      RX desc=4096 - RX free threshold=0</span>
<span class="go">      RX threshold registers: pthresh=0 hthresh=0  wthresh=0</span>
<span class="go">      RX Offloads=0x0</span>
<span class="go">    TX queue: 0</span>
<span class="go">      TX desc=512 - TX free threshold=0</span>
<span class="go">      TX threshold registers: pthresh=0 hthresh=0  wthresh=0</span>
<span class="go">      TX offloads=0x0 - TX RS bit threshold=0</span>
<span class="go">Press enter to exit</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="runtime-config-options">
<h2><span class="section-number">12.4. </span>Runtime Config Options</h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Rx&amp;Tx</span> <span class="pre">scalar</span> <span class="pre">mode</span> <span class="pre">enable</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>PMD supports both scalar and vector mode, it may be selected at runtime
using <code class="docutils literal notranslate"><span class="pre">scalar_enable</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RSS</span> <span class="pre">reta</span> <span class="pre">size</span></code> (default <code class="docutils literal notranslate"><span class="pre">64</span></code>)</p>
<blockquote>
<div><p>RSS redirection table size may be configured during runtime using <code class="docutils literal notranslate"><span class="pre">reta_size</span></code>
<code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,reta_size=256
</pre></div>
</div>
<p>With the above configuration, reta table of size 256 is populated.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Flow</span> <span class="pre">priority</span> <span class="pre">levels</span></code> (default <code class="docutils literal notranslate"><span class="pre">3</span></code>)</p>
<blockquote>
<div><p>RTE Flow priority levels can be configured during runtime using
<code class="docutils literal notranslate"><span class="pre">flow_max_priority</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,flow_max_priority=10
</pre></div>
</div>
<p>With the above configuration, priority level was set to 10 (0-9). Max
priority level supported is 32.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Reserve</span> <span class="pre">Flow</span> <span class="pre">entries</span></code> (default <code class="docutils literal notranslate"><span class="pre">8</span></code>)</p>
<blockquote>
<div><p>RTE flow entries can be pre allocated and the size of pre allocation can be
selected runtime using <code class="docutils literal notranslate"><span class="pre">flow_prealloc_size</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,flow_prealloc_size=4
</pre></div>
</div>
<p>With the above configuration, pre alloc size was set to 4. Max pre alloc
size supported is 32.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Max</span> <span class="pre">SQB</span> <span class="pre">buffer</span> <span class="pre">count</span></code> (default <code class="docutils literal notranslate"><span class="pre">512</span></code>)</p>
<blockquote>
<div><p>Send queue descriptor buffer count may be limited during runtime using
<code class="docutils literal notranslate"><span class="pre">max_sqb_count</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,max_sqb_count=64
</pre></div>
</div>
<p>With the above configuration, each send queue’s descriptor buffer count is
limited to a maximum of 64 buffers.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SQB</span> <span class="pre">slack</span> <span class="pre">count</span></code> (default <code class="docutils literal notranslate"><span class="pre">12</span></code>)</p>
<blockquote>
<div><p>Send queue descriptor slack count added to SQB count when a Tx queue is
created, can be set using <code class="docutils literal notranslate"><span class="pre">sqb_slack</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,sqb_slack=32
</pre></div>
</div>
<p>With the above configuration, each send queue’s descriptor buffer count will
be increased by 32, while keeping the queue limit to default configuration.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Switch</span> <span class="pre">header</span> <span class="pre">enable</span></code> (default <code class="docutils literal notranslate"><span class="pre">none</span></code>)</p>
<blockquote>
<div><p>A port can be configured to a specific switch header type by using
<code class="docutils literal notranslate"><span class="pre">switch_header</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,switch_header=&quot;higig2&quot;
</pre></div>
</div>
<p>With the above configuration, higig2 will be enabled on that port and the
traffic on this port should be higig2 traffic only. Supported switch header
types are “chlen24b”, “chlen90b”, “dsa”, “exdsa”, “higig2”, “vlan_exdsa” and
“pre_l2”.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Flow</span> <span class="pre">pre_l2</span> <span class="pre">info</span></code> (default <code class="docutils literal notranslate"><span class="pre">0x0/0x0/0x0</span></code>)</p>
<blockquote>
<div><p>pre_l2 headers are custom headers placed before the ethernet header. For
parsing custom pre_l2 headers, an offset, mask within the offset and shift
direction has to be provided within the custom header that holds the size of
the custom header. This is valid only with switch header pre_l2. Maximum
supported offset range is 0 to 255 and mask range is 1 to 255 and
shift direction, 0: left shift, 1: right shift.
Info format will be “offset/mask/shift direction”. All parameters has to be
in hexadecimal format and mask should be contiguous. Info can be configured
using <code class="docutils literal notranslate"><span class="pre">flow_pre_l2_info</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,switch_header=&quot;pre_l2&quot;,flow_pre_l2_info=0x2/0x7e/0x1
</pre></div>
</div>
<p>With the above configuration, custom pre_l2 header will be enabled on that
port and size of the header is placed at byte offset 0x2 in the packet with
mask 0x7e and right shift will be used to get the size. That is, size will be
(pkt[0x2] &amp; 0x7e) &gt;&gt; shift count. Shift count will be calculated based on
mask and shift direction. For example, if mask is 0x7c and shift direction is
1 (i.e., right shift) then the shift count will be 2, that is, absolute
position of the rightmost set bit. If the mask is 0x7c and shift direction
is 0 (i.e., left shift) then the shift count will be 1, that is, (8 - n),
where n is the absolute position of leftmost set bit.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RSS</span> <span class="pre">tag</span> <span class="pre">as</span> <span class="pre">XOR</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>The HW gives two options to configure the RSS adder i.e</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rss_adder&lt;7:0&gt;</span> <span class="pre">=</span> <span class="pre">flow_tag&lt;7:0&gt;</span> <span class="pre">^</span> <span class="pre">flow_tag&lt;15:8&gt;</span> <span class="pre">^</span> <span class="pre">flow_tag&lt;23:16&gt;</span> <span class="pre">^</span> <span class="pre">flow_tag&lt;31:24&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rss_adder&lt;7:0&gt;</span> <span class="pre">=</span> <span class="pre">flow_tag&lt;7:0&gt;</span></code></p></li>
</ul>
<p>Latter one aligns with standard NIC behavior vs former one is a legacy
RSS adder scheme used in OCTEON 9 products.</p>
<p>By default, the driver runs in the latter mode.
Setting this flag to 1 to select the legacy mode.</p>
<p>For example to select the legacy mode(RSS tag adder as XOR):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,tag_as_xor=1
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Min</span> <span class="pre">SPI</span> <span class="pre">for</span> <span class="pre">inbound</span> <span class="pre">inline</span> <span class="pre">IPsec</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>Min SPI supported for inbound inline IPsec processing can be specified by
<code class="docutils literal notranslate"><span class="pre">ipsec_in_min_spi</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,ipsec_in_min_spi=6
</pre></div>
</div>
<p>With the above configuration, application can enable inline IPsec processing
for inbound SA with min SPI of 6.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Max</span> <span class="pre">SPI</span> <span class="pre">for</span> <span class="pre">inbound</span> <span class="pre">inline</span> <span class="pre">IPsec</span></code> (default <code class="docutils literal notranslate"><span class="pre">255</span></code>)</p>
<blockquote>
<div><p>Max SPI supported for inbound inline IPsec processing can be specified by
<code class="docutils literal notranslate"><span class="pre">ipsec_in_max_spi</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,ipsec_in_max_spi=128
</pre></div>
</div>
<p>With the above configuration, application can enable inline IPsec processing
with max SPI of 128.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Max</span> <span class="pre">SA's</span> <span class="pre">for</span> <span class="pre">outbound</span> <span class="pre">inline</span> <span class="pre">IPsec</span></code> (default <code class="docutils literal notranslate"><span class="pre">4096</span></code>)</p>
<blockquote>
<div><p>Max number of SA’s supported for outbound inline IPsec processing can be
specified by <code class="docutils literal notranslate"><span class="pre">ipsec_out_max_sa</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,ipsec_out_max_sa=128
</pre></div>
</div>
<p>With the above configuration, application can enable inline IPsec processing
for 128 outbound SAs.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Enable</span> <span class="pre">custom</span> <span class="pre">SA</span> <span class="pre">action</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>Custom SA action can be enabled by specifying <code class="docutils literal notranslate"><span class="pre">custom_sa_act</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,custom_sa_act=1
</pre></div>
</div>
<p>With the above configuration, application can enable custom SA action. This
configuration allows the potential for a MCAM entry to match many SAs,
rather than only match a single SA.
For cnxk device sa_index will be calculated based on SPI value. So, it will
be 1 to 1 mapping. By enabling this devargs and setting a MCAM rule, will
allow application to configure the sa_index as part of session create. And
later original SPI value can be updated using session update.
For example, application can set sa_index as 0 using session create as SPI value
and later can update the original SPI value (for example 0x10000001) using
session update. And create a flow rule with security action and algorithm as
RTE_PMD_CNXK_SEC_ACTION_ALG0 and sa_hi as 0x1000 and sa_lo as 0x0001.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Outbound</span> <span class="pre">CPT</span> <span class="pre">LF</span> <span class="pre">queue</span> <span class="pre">size</span></code> (default <code class="docutils literal notranslate"><span class="pre">8200</span></code>)</p>
<blockquote>
<div><p>Size of Outbound CPT LF queue in number of descriptors can be specified by
<code class="docutils literal notranslate"><span class="pre">outb_nb_desc</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  -a 0002:02:00.0,outb_nb_desc=16384

With the above configuration, Outbound CPT LF will be created to accommodate
at max 16384 descriptors at any given time.
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Outbound</span> <span class="pre">CPT</span> <span class="pre">LF</span> <span class="pre">count</span></code> (default <code class="docutils literal notranslate"><span class="pre">1</span></code>)</p>
<blockquote>
<div><p>Number of CPT LF’s to attach for Outbound processing can be specified by
<code class="docutils literal notranslate"><span class="pre">outb_nb_crypto_qs</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,outb_nb_crypto_qs=2
</pre></div>
</div>
<p>With the above configuration, two CPT LF’s are setup and distributed among
all the Tx queues for outbound processing.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Disable</span> <span class="pre">using</span> <span class="pre">inline</span> <span class="pre">ipsec</span> <span class="pre">device</span> <span class="pre">for</span> <span class="pre">inbound</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>In CN10K, in event mode, driver can work in two modes,</p>
<ol class="arabic simple">
<li><p>Inbound encrypted traffic received by probed ipsec inline device while
plain traffic post decryption is received by ethdev.</p></li>
<li><p>Both Inbound encrypted traffic and plain traffic post decryption are
received by ethdev.</p></li>
</ol>
<p>By default event mode works using inline device i.e mode <code class="docutils literal notranslate"><span class="pre">1</span></code>.
This behaviour can be changed to pick mode <code class="docutils literal notranslate"><span class="pre">2</span></code> by using
<code class="docutils literal notranslate"><span class="pre">no_inl_dev</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,no_inl_dev=1 -a 0002:03:00.0,no_inl_dev=1
</pre></div>
</div>
<p>With the above configuration, inbound encrypted traffic from both the ports
is received by ipsec inline device.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Inline</span> <span class="pre">IPsec</span> <span class="pre">device</span> <span class="pre">channel</span> <span class="pre">and</span> <span class="pre">mask</span></code> (default <code class="docutils literal notranslate"><span class="pre">none</span></code>)</p>
<blockquote>
<div><p>Set channel and channel mask configuration for the inline IPSec device. This
will be used when creating flow rules with RTE_FLOW_ACTION_TYPE_SECURITY
action.</p>
<p>By default, RTE Flow API sets the channel number of the port on which the
rule is created in the MCAM entry and matches it exactly. This behaviour can
be modified using the <code class="docutils literal notranslate"><span class="pre">inl_cpt_channel</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,inl_cpt_channel=0x100/0xf00
</pre></div>
</div>
<p>With the above configuration, RTE Flow rules API will set the channel
and channel mask as 0x100 and 0xF00 in the MCAM entries of the  flow rules
created with RTE_FLOW_ACTION_TYPE_SECURITY action. Since channel number is
set with this custom mask, inbound encrypted traffic from all ports with
matching channel number pattern will be directed to the inline IPSec device.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Inline</span> <span class="pre">IPsec</span> <span class="pre">device</span> <span class="pre">flow</span> <span class="pre">rules</span></code> (default <code class="docutils literal notranslate"><span class="pre">none</span></code>)</p>
<blockquote>
<div><p>For inline IPsec device, reserve number of rules specified by <code class="docutils literal notranslate"><span class="pre">max_ipsec_rules</span></code>
and use them while installing rules with action as security.
Rule priority should be 0.
If specified number of rules not available,
then only available number of rules will be allocated and used.
If application try to insert more than allocated rules, flow creation will fail.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,max_ipsec_rules=100
</pre></div>
</div>
<p>With the above configuration, 100 rules will be allocated from 0-99 if available
and will be used for rules with action security.
If 100 rules are not available, and only 50 are available,
then only 50 rules will be allocated and used for flow rule creation.
If application try to add more than 50 rules, the flow creation will fail.</p>
</div></blockquote>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">SDP</span> <span class="pre">device</span> <span class="pre">channel</span> <span class="pre">and</span> <span class="pre">mask</span></code> (default <code class="docutils literal notranslate"><span class="pre">none</span></code>)</dt><dd><p>Set channel and channel mask configuration for the SDP device. This
will be used when creating flow rules on the SDP device.</p>
<p>By default, for rules created on the SDP device, the RTE Flow API sets the
channel number and mask to cover the entire SDP channel range in the channel
field of the MCAM entry. This behaviour can be modified using the
<code class="docutils literal notranslate"><span class="pre">sdp_channel_mask</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,sdp_channel_mask=0x700/0xf00
</pre></div>
</div>
<p>With the above configuration, RTE Flow rules API will set the channel
and channel mask as 0x700 and 0xF00 in the MCAM entries of the  flow rules
created on the SDP device. This option needs to be used when more than one
SDP interface is in use and RTE Flow rules created need to distinguish
between traffic from each SDP interface. The channel and mask combination
specified should match all the channels(or rings) configured on the SDP
interface.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Transmit</span> <span class="pre">completion</span> <span class="pre">handler</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>When transmit completion handler is enabled,
the PMD invokes the callback handler provided by the application
for every packet which has external buf attached to mbuf
and frees main mbuf, external buffer is provided to applicatoin.
Once external buffer is handed over to application,
it is application responsibility either to free or reuse external buffer
using <code class="docutils literal notranslate"><span class="pre">tx_compl_ena</span></code> devargs parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:01:00.1,tx_compl_ena=1
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Meta</span> <span class="pre">buffer</span> <span class="pre">size</span> <span class="pre">per</span> <span class="pre">ethdev</span> <span class="pre">port</span> <span class="pre">for</span> <span class="pre">inline</span> <span class="pre">inbound</span> <span class="pre">IPsec</span> <span class="pre">second</span> <span class="pre">pass</span></code></p>
<blockquote>
<div><p>Size of meta buffer allocated for inline inbound IPsec second pass per
ethdev port can be specified by <code class="docutils literal notranslate"><span class="pre">meta_buf_sz</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.
Default value is computed runtime based on pkt mbuf pools created and in use.
This option is for OCTEON CN106-B0/CN103XX SoC family.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,meta_buf_sz=512
</pre></div>
</div>
<p>With the above configuration, PMD would allocate meta buffers of size 512 for
inline inbound IPsec processing second pass.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Above devarg parameters are configurable per device, user needs to pass the
parameters to all the PCIe devices if application requires to configure on
all the ethdev ports.</p>
</div>
</section>
<section id="limitations">
<h2><span class="section-number">12.5. </span>Limitations</h2>
<section id="mempool-cnxk-external-mempool-handler-dependency">
<h3><span class="section-number">12.5.1. </span><code class="docutils literal notranslate"><span class="pre">mempool_cnxk</span></code> external mempool handler dependency</h3>
<p>The OCTEON CN9K/CN10K SoC family NIC has inbuilt HW assisted external mempool manager.
<code class="docutils literal notranslate"><span class="pre">net_cnxk</span></code> PMD only works with <code class="docutils literal notranslate"><span class="pre">mempool_cnxk</span></code> mempool handler
as it is performance wise most effective way for packet allocation and Tx buffer
recycling on OCTEON 9 SoC platform.</p>
</section>
<section id="mempool-cnxk-rte-mempool-cache-sizes-for-cn10k">
<h3><span class="section-number">12.5.2. </span><code class="docutils literal notranslate"><span class="pre">mempool_cnxk</span></code> rte_mempool cache sizes for CN10K</h3>
<p>The OCTEON CN10K SoC Family supports asynchronous batch allocation
of objects from an NPA pool.
In the CNXK mempool driver, asynchronous batch allocation is enabled
when local caches are enabled.
This asynchronous batch allocation will be using an additional local async buffer
whose size will be equal to <code class="docutils literal notranslate"><span class="pre">RTE_ALIGN_CEIL(rte_mempool-&gt;cache_size,</span> <span class="pre">16)</span></code>.
This can result in additional objects being cached locally.
While creating an rte_mempool using <code class="docutils literal notranslate"><span class="pre">mempool_cnxk</span></code> driver for OCTEON CN10K,
this must be taken into consideration
and the local cache sizes should be adjusted accordingly
so that starvation does not happen.</p>
<p>For Eg: If the <code class="docutils literal notranslate"><span class="pre">cache_size</span></code> passed into <code class="docutils literal notranslate"><span class="pre">rte_mempool_create</span></code> is <code class="docutils literal notranslate"><span class="pre">8</span></code>,
then the max objects than can get cached locally on a core
would be the sum of max objects in the local cache + max objects in the async buffer
i.e <code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">+</span> <span class="pre">RTE_ALIGN_CEIL(8,</span> <span class="pre">16)</span> <span class="pre">=</span> <span class="pre">24</span></code>.</p>
</section>
<section id="crc-stripping">
<h3><span class="section-number">12.5.3. </span>CRC stripping</h3>
<p>The OCTEON CN9K/CN10K SoC family NICs strip the CRC for every packet being received by
the host interface irrespective of the offload configuration.</p>
</section>
<section id="rte-flow-gre-support">
<h3><span class="section-number">12.5.4. </span>RTE flow GRE support</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ITEM_TYPE_GRE_KEY</span></code> works only when checksum and routing
bits in the GRE header are equal to 0.</p></li>
</ul>
</section>
<section id="rte-flow-action-represented-port-support">
<h3><span class="section-number">12.5.5. </span>RTE flow action represented_port support</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ACTION_TYPE_REPRESENTED_PORT</span></code> only works between a PF and its VFs.</p></li>
</ul>
</section>
<section id="rte-flow-action-port-id-support">
<h3><span class="section-number">12.5.6. </span>RTE flow action port_id support</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ACTION_TYPE_PORT_ID</span></code> is only supported between PF and its VFs.</p></li>
</ul>
</section>
<section id="custom-protocols-supported-in-rte-flow">
<h3><span class="section-number">12.5.7. </span>Custom protocols supported in RTE Flow</h3>
<p>The <code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ITEM_TYPE_RAW</span></code> can be used to parse the below custom protocols.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vlan_exdsa</span></code> and <code class="docutils literal notranslate"><span class="pre">exdsa</span></code> can be parsed at L2 level.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NGIO</span></code> can be parsed at L3 level.</p></li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">vlan_exdsa</span></code> and <code class="docutils literal notranslate"><span class="pre">exdsa</span></code>, the port has to be configured with the
respective switch header.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:02:00.0,switch_header=&quot;vlan_exdsa&quot;
</pre></div>
</div>
<p>The below fields of <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_item_raw</span></code> shall be used to specify the
pattern.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">relative</span></code> Selects the layer at which parsing is done.</p>
<ul>
<li><p>0 for <code class="docutils literal notranslate"><span class="pre">exdsa</span></code> and <code class="docutils literal notranslate"><span class="pre">vlan_exdsa</span></code>.</p></li>
<li><p>1 for  <code class="docutils literal notranslate"><span class="pre">NGIO</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset</span></code> The offset in the header where the pattern should be matched.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code> Length of the pattern.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code> Pattern as a byte string.</p></li>
</ul>
<p>Example usage in testpmd:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./dpdk-testpmd -c 3 -w 0002:02:00.0,switch_header=exdsa -- -i \
               --rx-offloads=0x00080000 --rxq 8 --txq 8
testpmd&gt; flow create 0 ingress pattern eth / raw relative is 0 pattern \
       spec ab pattern mask ab offset is 4 / end actions queue index 1 / end
</pre></div>
</div>
</section>
<section id="rte-flow-mark-item-support">
<h3><span class="section-number">12.5.8. </span>RTE Flow mark item support</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ITEM_TYPE_MARK</span></code> can be used to create ingress flow rules to match
packets from CPT(second pass packets). When mark item type is used, it should
be the first item in the patterns specification.</p></li>
</ul>
</section>
</section>
<section id="inline-device-support-for-cn10k">
<h2><span class="section-number">12.6. </span>Inline device support for CN10K</h2>
<p>CN10K HW provides a misc device Inline device that supports ethernet devices in
providing following features.</p>
<blockquote>
<div><ul class="simple">
<li><p>Aggregate all the inline IPsec inbound traffic from all the CN10K ethernet
devices to be processed by the single inline IPSec device. This allows
single rte security session to accept traffic from multiple ports.</p></li>
<li><p>Support for event generation on outbound inline IPsec processing errors.</p></li>
<li><p>Support CN106xx poll mode of operation for inline IPSec inbound processing.</p></li>
</ul>
</div></blockquote>
<p>Inline IPsec device is identified by PCI PF vendid:devid <code class="docutils literal notranslate"><span class="pre">177D:A0F0</span></code> or
VF <code class="docutils literal notranslate"><span class="pre">177D:A0F1</span></code>.</p>
<section id="runtime-config-options-for-inline-device">
<h3><span class="section-number">12.6.1. </span>Runtime Config Options for inline device</h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Min</span> <span class="pre">SPI</span> <span class="pre">for</span> <span class="pre">inbound</span> <span class="pre">inline</span> <span class="pre">IPsec</span></code> (default <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<blockquote>
<div><p>Min SPI supported for inbound inline IPsec processing can be specified by
<code class="docutils literal notranslate"><span class="pre">ipsec_in_min_spi</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,ipsec_in_min_spi=6
</pre></div>
</div>
<p>With the above configuration, application can enable inline IPsec processing
for inbound SA with min SPI of 6 for traffic aggregated on inline device.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Max</span> <span class="pre">SPI</span> <span class="pre">for</span> <span class="pre">inbound</span> <span class="pre">inline</span> <span class="pre">IPsec</span></code> (default <code class="docutils literal notranslate"><span class="pre">255</span></code>)</p>
<blockquote>
<div><p>Max SPI supported for inbound inline IPsec processing can be specified by
<code class="docutils literal notranslate"><span class="pre">ipsec_in_max_spi</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,ipsec_in_max_spi=128
</pre></div>
</div>
<p>With the above configuration, application can enable inline IPsec processing
for inbound SA with max SPI of 128 for traffic aggregated on inline device.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Count</span> <span class="pre">of</span> <span class="pre">meta</span> <span class="pre">buffers</span> <span class="pre">for</span> <span class="pre">inline</span> <span class="pre">inbound</span> <span class="pre">IPsec</span> <span class="pre">second</span> <span class="pre">pass</span></code></p>
<blockquote>
<div><p>Number of meta buffers allocated for inline inbound IPsec second pass can
be specified by <code class="docutils literal notranslate"><span class="pre">nb_meta_bufs</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter. Default value is
computed runtime based on pkt mbuf pools created and in use. Number of meta
buffers should be at least equal to aggregated number of packet buffers of all
packet mbuf pools in use by Inline IPsec enabled ethernet devices.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,nb_meta_bufs=1024
</pre></div>
</div>
<p>With the above configuration, PMD would enable inline IPsec processing
for inbound with 1024 meta buffers available for second pass.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Meta</span> <span class="pre">buffer</span> <span class="pre">size</span> <span class="pre">for</span> <span class="pre">inline</span> <span class="pre">inbound</span> <span class="pre">IPsec</span> <span class="pre">second</span> <span class="pre">pass</span></code></p>
<blockquote>
<div><p>Size of meta buffer allocated for inline inbound IPsec second pass can
be specified by <code class="docutils literal notranslate"><span class="pre">meta_buf_sz</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter. Default value is
computed runtime based on pkt mbuf pools created and in use.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,meta_buf_sz=512
</pre></div>
</div>
<p>With the above configuration, PMD would allocate meta buffers of size 512 for
inline inbound IPsec processing second pass.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Inline</span> <span class="pre">Outbound</span> <span class="pre">soft</span> <span class="pre">expiry</span> <span class="pre">poll</span> <span class="pre">frequency</span> <span class="pre">in</span> <span class="pre">usec</span></code> (default <code class="docutils literal notranslate"><span class="pre">100</span></code>)</p>
<blockquote>
<div><p>Soft expiry poll frequency for Inline Outbound sessions can be specified by
<code class="docutils literal notranslate"><span class="pre">soft_exp_poll_freq</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:1d:00.0,soft_exp_poll_freq=1000
</pre></div>
</div>
<p>With the above configuration, driver would poll for soft expiry events every
1000 usec.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">NPC</span> <span class="pre">MCAM</span> <span class="pre">Aging</span> <span class="pre">poll</span> <span class="pre">frequency</span> <span class="pre">in</span> <span class="pre">seconds</span></code> (default <code class="docutils literal notranslate"><span class="pre">10</span></code>)</p>
<blockquote>
<div><p>Poll frequency for aging control thread can be specified by
<code class="docutils literal notranslate"><span class="pre">aging_poll_freq</span></code> <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 0002:01:00.2,aging_poll_freq=50
</pre></div>
</div>
<p>With the above configuration, driver would poll for aging flows every 50
seconds.</p>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="debugging-options">
<h2><span class="section-number">12.7. </span>Debugging Options</h2>
<span id="table-cnxk-ethdev-debug-options"></span><table class="docutils align-default" id="id1">
<caption><span class="caption-number">Table 12.1 </span><span class="caption-text">cnxk ethdev debug options</span></caption>
<colgroup>
<col style="width: 4%" />
<col style="width: 17%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>Component</p></th>
<th class="head"><p>EAL log command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>NIX</p></td>
<td><p>–log-level=’pmd.net.cnxk,8’</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>NPC</p></td>
<td><p>–log-level=’pmd.net.cnxk.flow,8’</p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DPDK_logo_vertical_rev_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Data Plane Development Kit</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mldevs/index.html">Machine Learning Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmadevs/index.html">DMA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpus/index.html">General-Purpose Graphics Processing Unit Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Network Interface Controller Drivers</a><ul>
      <li>Previous: <a href="bnxt.html" title="previous chapter"><span class="section-number">11. </span>BNXT Poll Mode Driver</a></li>
      <li>Next: <a href="cpfl.html" title="next chapter"><span class="section-number">13. </span>CPFL Poll Mode Driver</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/nics/cnxk.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>