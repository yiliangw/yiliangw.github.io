
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>27. I40E Poll Mode Driver &#8212; Data Plane Development Kit 23.11.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="28. ICE Poll Mode Driver" href="ice.html" />
    <link rel="prev" title="26. HNS3 Poll Mode Driver" href="hns3.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="i40e-poll-mode-driver">
<h1><span class="section-number">27. </span>I40E Poll Mode Driver</h1>
<p>The i40e PMD (<strong>librte_net_i40e</strong>) provides poll mode driver support for
10/25/40 Gbps Intel® Ethernet 700 Series Network Adapters based on
the Intel Ethernet Controller X710/XL710/XXV710 and Intel Ethernet
Connection X722 (only support part of features).</p>
<section id="features">
<h2><span class="section-number">27.1. </span>Features</h2>
<p>Features of the i40e PMD are:</p>
<ul class="simple">
<li><p>Multiple queues for TX and RX</p></li>
<li><p>Receiver Side Scaling (RSS)</p></li>
<li><p>MAC/VLAN filtering</p></li>
<li><p>Packet type information</p></li>
<li><p>Flow director</p></li>
<li><p>Cloud filter</p></li>
<li><p>Checksum offload</p></li>
<li><p>VLAN/QinQ stripping and inserting</p></li>
<li><p>TSO offload</p></li>
<li><p>Promiscuous mode</p></li>
<li><p>Multicast mode</p></li>
<li><p>Port hardware statistics</p></li>
<li><p>Jumbo frames</p></li>
<li><p>Link state information</p></li>
<li><p>Link flow control</p></li>
<li><p>Mirror on port, VLAN and VSI</p></li>
<li><p>Interrupt mode for RX</p></li>
<li><p>Scattered and gather for TX and RX</p></li>
<li><p>Vector Poll mode driver</p></li>
<li><p>DCB</p></li>
<li><p>VMDQ</p></li>
<li><p>SR-IOV VF</p></li>
<li><p>Hot plug</p></li>
<li><p>IEEE1588/802.1AS timestamping</p></li>
<li><p>VF Daemon (VFD) - EXPERIMENTAL</p></li>
<li><p>Dynamic Device Personalization (DDP)</p></li>
<li><p>Queue region configuration</p></li>
<li><p>Virtual Function Port Representors</p></li>
<li><p>Malicious Device Drive event catch and notify</p></li>
<li><p>Generic flow API</p></li>
</ul>
</section>
<section id="linux-prerequisites">
<h2><span class="section-number">27.2. </span>Linux Prerequisites</h2>
<ul>
<li><p>Identifying your adapter using <a class="reference external" href="http://www.intel.com/support">Intel Support</a> and get the latest NVM/FW images.</p></li>
<li><p>Follow the DPDK <a class="reference internal" href="../linux_gsg/index.html#linux-gsg"><span class="std std-ref">Getting Started Guide for Linux</span></a> to setup the basic DPDK environment.</p></li>
<li><p>To get better performance on Intel platforms, please follow the “How to get best performance with NICs on Intel platforms”
section of the <a class="reference internal" href="../linux_gsg/index.html#linux-gsg"><span class="std std-ref">Getting Started Guide for Linux</span></a>.</p></li>
<li><p>Upgrade the NVM/FW version following the <a class="reference external" href="https://www-ssl.intel.com/content/www/us/en/embedded/products/networking/nvm-update-tool-quick-linux-usage-guide.html">Intel® Ethernet NVM Update Tool Quick Usage Guide for Linux</a> and <a class="reference external" href="https://www.intel.com/content/www/us/en/embedded/products/networking/nvm-update-tool-quick-efi-usage-guide.html">Intel® Ethernet NVM Update Tool: Quick Usage Guide for EFI</a> if needed.</p></li>
<li><p>For information about supported media, please refer to this document: <a class="reference external" href="http://www.intel.com/content/dam/www/public/us/en/documents/release-notes/xl710-ethernet-controller-feature-matrix.pdf">Intel® Ethernet Controller X710/XXV710/XL710 Feature Support Matrix</a>.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Some adapters based on the Intel(R) Ethernet Controller 700 Series only
support Intel Ethernet Optics modules. On these adapters, other modules are not
supported and will not function.</p></li>
<li><p>For connections based on Intel(R) Ethernet Controller 700 Series,
support is dependent on your system board. Please see your vendor for details.</p></li>
<li><p>In all cases Intel recommends using Intel Ethernet Optics; other modules
may function but are not validated by Intel. Contact Intel for supported media types.</p></li>
</ul>
</div>
</div></blockquote>
</li>
</ul>
</section>
<section id="windows-prerequisites">
<h2><span class="section-number">27.3. </span>Windows Prerequisites</h2>
<ul class="simple">
<li><p>Follow the <a class="reference internal" href="../windows_gsg/run_apps.html"><span class="doc">guide for Windows</span></a>
to setup the basic DPDK environment.</p></li>
<li><p>Identify the Intel® Ethernet adapter and get the latest NVM/FW version.</p></li>
<li><p>To access any Intel® Ethernet hardware, load the NetUIO driver in place of existing built-in (inbox) driver.</p></li>
<li><p>To load NetUIO driver, follow the steps mentioned in <a class="reference external" href="https://git.dpdk.org/dpdk-kmods/tree/windows/netuio/README.rst">dpdk-kmods repository</a>.</p></li>
</ul>
</section>
<section id="kernel-driver-and-firmware-matching-list">
<h2><span class="section-number">27.4. </span>Kernel driver and Firmware Matching List</h2>
<p>It is highly recommended to upgrade the i40e kernel driver and firmware
to avoid the compatibility issues with i40e PMD.
The table below shows a summary of the DPDK versions
with corresponding out-of-tree Linux kernel drivers and firmware.
The full list of in-tree and out-of-tree Linux kernel drivers from kernel.org
and Linux distributions that were tested and verified
are listed in the Tested Platforms section of the Release Notes for each release.</p>
<p>For X710/XL710/XXV710,</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 42%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>DPDK version</p></th>
<th class="head"><p>Kernel driver version</p></th>
<th class="head"><p>Firmware version</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>23.07</p></td>
<td><p>2.22.20</p></td>
<td><p>9.20</p></td>
</tr>
<tr class="row-odd"><td><p>23.03</p></td>
<td><p>2.22.18</p></td>
<td><p>9.20</p></td>
</tr>
<tr class="row-even"><td><p>22.11</p></td>
<td><p>2.20.12</p></td>
<td><p>9.01</p></td>
</tr>
<tr class="row-odd"><td><p>22.07</p></td>
<td><p>2.19.3</p></td>
<td><p>8.70</p></td>
</tr>
<tr class="row-even"><td><p>22.03</p></td>
<td><p>2.17.15</p></td>
<td><p>8.30</p></td>
</tr>
<tr class="row-odd"><td><p>21.11</p></td>
<td><p>2.17.4</p></td>
<td><p>8.30</p></td>
</tr>
<tr class="row-even"><td><p>21.08</p></td>
<td><p>2.15.9</p></td>
<td><p>8.30</p></td>
</tr>
<tr class="row-odd"><td><p>21.05</p></td>
<td><p>2.15.9</p></td>
<td><p>8.30</p></td>
</tr>
<tr class="row-even"><td><p>21.02</p></td>
<td><p>2.14.13</p></td>
<td><p>8.00</p></td>
</tr>
<tr class="row-odd"><td><p>20.11</p></td>
<td><p>2.14.13</p></td>
<td><p>8.00</p></td>
</tr>
<tr class="row-even"><td><p>20.08</p></td>
<td><p>2.12.6</p></td>
<td><p>7.30</p></td>
</tr>
<tr class="row-odd"><td><p>20.05</p></td>
<td><p>2.11.27</p></td>
<td><p>7.30</p></td>
</tr>
<tr class="row-even"><td><p>20.02</p></td>
<td><p>2.10.19</p></td>
<td><p>7.20</p></td>
</tr>
<tr class="row-odd"><td><p>19.11</p></td>
<td><p>2.9.21</p></td>
<td><p>7.00</p></td>
</tr>
<tr class="row-even"><td><p>19.08</p></td>
<td><p>2.8.43</p></td>
<td><p>7.00</p></td>
</tr>
<tr class="row-odd"><td><p>19.05</p></td>
<td><p>2.7.29</p></td>
<td><p>6.80</p></td>
</tr>
<tr class="row-even"><td><p>19.02</p></td>
<td><p>2.7.26</p></td>
<td><p>6.80</p></td>
</tr>
<tr class="row-odd"><td><p>18.11</p></td>
<td><p>2.4.6</p></td>
<td><p>6.01</p></td>
</tr>
<tr class="row-even"><td><p>18.08</p></td>
<td><p>2.4.6</p></td>
<td><p>6.01</p></td>
</tr>
<tr class="row-odd"><td><p>18.05</p></td>
<td><p>2.4.6</p></td>
<td><p>6.01</p></td>
</tr>
<tr class="row-even"><td><p>18.02</p></td>
<td><p>2.4.3</p></td>
<td><p>6.01</p></td>
</tr>
<tr class="row-odd"><td><p>17.11</p></td>
<td><p>2.1.26</p></td>
<td><p>6.01</p></td>
</tr>
<tr class="row-even"><td><p>17.08</p></td>
<td><p>2.0.19</p></td>
<td><p>6.01</p></td>
</tr>
<tr class="row-odd"><td><p>17.05</p></td>
<td><p>1.5.23</p></td>
<td><p>5.05</p></td>
</tr>
<tr class="row-even"><td><p>17.02</p></td>
<td><p>1.5.23</p></td>
<td><p>5.05</p></td>
</tr>
<tr class="row-odd"><td><p>16.11</p></td>
<td><p>1.5.23</p></td>
<td><p>5.05</p></td>
</tr>
<tr class="row-even"><td><p>16.07</p></td>
<td><p>1.4.25</p></td>
<td><p>5.04</p></td>
</tr>
<tr class="row-odd"><td><p>16.04</p></td>
<td><p>1.4.25</p></td>
<td><p>5.02</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>For X722,</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 42%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>DPDK version</p></th>
<th class="head"><p>Kernel driver version</p></th>
<th class="head"><p>Firmware version</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>23.07</p></td>
<td><p>2.22.20</p></td>
<td><p>6.20</p></td>
</tr>
<tr class="row-odd"><td><p>23.03</p></td>
<td><p>2.22.18</p></td>
<td><p>6.20</p></td>
</tr>
<tr class="row-even"><td><p>22.11</p></td>
<td><p>2.20.12</p></td>
<td><p>6.00</p></td>
</tr>
<tr class="row-odd"><td><p>22.07</p></td>
<td><p>2.19.3</p></td>
<td><p>5.60</p></td>
</tr>
<tr class="row-even"><td><p>22.03</p></td>
<td><p>2.17.15</p></td>
<td><p>5.50</p></td>
</tr>
<tr class="row-odd"><td><p>21.11</p></td>
<td><p>2.17.4</p></td>
<td><p>5.30</p></td>
</tr>
<tr class="row-even"><td><p>21.08</p></td>
<td><p>2.15.9</p></td>
<td><p>5.30</p></td>
</tr>
<tr class="row-odd"><td><p>21.05</p></td>
<td><p>2.15.9</p></td>
<td><p>5.30</p></td>
</tr>
<tr class="row-even"><td><p>21.02</p></td>
<td><p>2.14.13</p></td>
<td><p>5.00</p></td>
</tr>
<tr class="row-odd"><td><p>20.11</p></td>
<td><p>2.13.10</p></td>
<td><p>5.00</p></td>
</tr>
<tr class="row-even"><td><p>20.08</p></td>
<td><p>2.12.6</p></td>
<td><p>4.11</p></td>
</tr>
<tr class="row-odd"><td><p>20.05</p></td>
<td><p>2.11.27</p></td>
<td><p>4.11</p></td>
</tr>
<tr class="row-even"><td><p>20.02</p></td>
<td><p>2.10.19</p></td>
<td><p>4.11</p></td>
</tr>
<tr class="row-odd"><td><p>19.11</p></td>
<td><p>2.9.21</p></td>
<td><p>4.10</p></td>
</tr>
<tr class="row-even"><td><p>19.08</p></td>
<td><p>2.9.21</p></td>
<td><p>4.10</p></td>
</tr>
<tr class="row-odd"><td><p>19.05</p></td>
<td><p>2.7.29</p></td>
<td><p>3.33</p></td>
</tr>
<tr class="row-even"><td><p>19.02</p></td>
<td><p>2.7.26</p></td>
<td><p>3.33</p></td>
</tr>
<tr class="row-odd"><td><p>18.11</p></td>
<td><p>2.4.6</p></td>
<td><p>3.33</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="configuration">
<h2><span class="section-number">27.5. </span>Configuration</h2>
<section id="compilation-options">
<h3><span class="section-number">27.5.1. </span>Compilation Options</h3>
<p>The following options can be modified in the <code class="docutils literal notranslate"><span class="pre">config/rte_config.h</span></code> file.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_LIBRTE_I40E_QUEUE_NUM_PER_PF</span></code> (default <code class="docutils literal notranslate"><span class="pre">64</span></code>)</p>
<p>Number of queues reserved for PF.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RTE_LIBRTE_I40E_QUEUE_NUM_PER_VM</span></code> (default <code class="docutils literal notranslate"><span class="pre">4</span></code>)</p>
<p>Number of queues reserved for each VMDQ Pool.</p>
</li>
</ul>
</section>
<section id="runtime-configuration">
<h3><span class="section-number">27.5.2. </span>Runtime Configuration</h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Reserved</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">Queues</span> <span class="pre">per</span> <span class="pre">VF</span></code> (default <code class="docutils literal notranslate"><span class="pre">4</span></code>)</p>
<p>The number of reserved queue per VF is determined by its host PF. If the
PCI address of an i40e PF is aaaa:bb.cc, the number of reserved queues per
VF can be configured with EAL parameter like -a aaaa:bb.cc,queue-num-per-vf=n.
The value n can be 1, 2, 4, 8 or 16. If no such parameter is configured, the
number of reserved queues per VF is 4 by default. If VF request more than
reserved queues per VF, PF will able to allocate max to 16 queues after a VF
reset.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Support</span> <span class="pre">multiple</span> <span class="pre">driver</span></code> (default <code class="docutils literal notranslate"><span class="pre">disable</span></code>)</p>
<p>There was a multiple driver support issue during use of 700 series Ethernet
Adapter with both Linux kernel and DPDK PMD. To fix this issue, <code class="docutils literal notranslate"><span class="pre">devargs</span></code>
parameter <code class="docutils literal notranslate"><span class="pre">support-multi-driver</span></code> is introduced, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 84:00.0,support-multi-driver=1
</pre></div>
</div>
<p>With the above configuration, DPDK PMD will not change global registers, and
will switch PF interrupt from IntN to Int0 to avoid interrupt conflict between
DPDK and Linux Kernel.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Support</span> <span class="pre">VF</span> <span class="pre">Port</span> <span class="pre">Representor</span></code> (default <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">enabled</span></code>)</p>
<p>The i40e PF PMD supports the creation of VF port representors for the control
and monitoring of i40e virtual function devices. Each port representor
corresponds to a single virtual function of that device. Using the <code class="docutils literal notranslate"><span class="pre">devargs</span></code>
option <code class="docutils literal notranslate"><span class="pre">representor</span></code> the user can specify which virtual functions to create
port representors for on initialization of the PF PMD by passing the VF IDs of
the VFs which are required.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a DBDF,representor=[0,1,4]
</pre></div>
</div>
<p>Currently hot-plugging of representor ports is not supported so all required
representors must be specified on the creation of the PF.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Enable</span> <span class="pre">validation</span> <span class="pre">for</span> <span class="pre">VF</span> <span class="pre">message</span></code> (default <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">enabled</span></code>)</p>
<p>The PF counts messages from each VF. If in any period of seconds the message
statistic from a VF exceeds maximal limitation, the PF will ignore any new message
from that VF for some seconds.
Format – “<a class="reference external" href="mailto:maximal-message&#37;&#52;&#48;period-seconds">maximal-message<span>&#64;</span>period-seconds</a>:ignore-seconds”
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 84:00.0,vf_msg_cfg=80@120:180
</pre></div>
</div>
</li>
</ul>
</section>
<section id="vector-rx-pre-conditions">
<h3><span class="section-number">27.5.3. </span>Vector RX Pre-conditions</h3>
<p>For Vector RX it is assumed that the number of descriptor rings will be a power
of 2. With this pre-condition, the ring pointer can easily scroll back to the
head after hitting the tail without a conditional check. In addition Vector RX
can use this assumption to do a bit mask using <code class="docutils literal notranslate"><span class="pre">ring_size</span> <span class="pre">-</span> <span class="pre">1</span></code>.</p>
</section>
</section>
<section id="driver-compilation-and-testing">
<h2><span class="section-number">27.6. </span>Driver compilation and testing</h2>
<p>Refer to the document <a class="reference internal" href="build_and_test.html#pmd-build-and-test"><span class="std std-ref">compiling and testing a PMD for a NIC</span></a>
for details.</p>
</section>
<section id="sr-iov-prerequisites-and-sample-application-notes">
<h2><span class="section-number">27.7. </span>SR-IOV: Prerequisites and sample Application Notes</h2>
<ol class="arabic">
<li><p>Load the kernel module:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">modprobe i40e</span>
</pre></div>
</div>
<p>Check the output in dmesg:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">i40e 0000:83:00.1 ens802f0: renamed from eth0</span>
</pre></div>
</div>
</li>
<li><p>Bring up the PF ports:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ifconfig ens802f0 up</span>
</pre></div>
</div>
</li>
<li><p>Create VF device(s):</p>
<p>Echo the number of VFs to be created into the <code class="docutils literal notranslate"><span class="pre">sriov_numvfs</span></code> sysfs entry
of the parent PF.</p>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo 2 &gt; /sys/devices/pci0000:00/0000:00:03.0/0000:81:00.0/sriov_numvfs</span>
</pre></div>
</div>
</li>
<li><p>Assign VF MAC address:</p>
<p>Assign MAC address to the VF using iproute2 utility. The syntax is:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ip link set &lt;PF netdev id&gt; vf &lt;VF id&gt; mac &lt;macaddr&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ip link set ens802f0 vf 0 mac a0:b0:c0:d0:e0:f0</span>
</pre></div>
</div>
</li>
<li><p>Assign VF to VM, and bring up the VM.
Please see the documentation for the <em>I40E/IXGBE/IGB Virtual Function Driver</em>.</p></li>
<li><p>Running testpmd:</p>
<p>Follow instructions available in the document
<a class="reference internal" href="build_and_test.html#pmd-build-and-test"><span class="std std-ref">compiling and testing a PMD for a NIC</span></a>
to run testpmd.</p>
<p>Example output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">...</span>
<span class="go">EAL: PCI device 0000:83:00.0 on NUMA socket 1</span>
<span class="go">EAL: probe driver: 8086:1572 rte_i40e_pmd</span>
<span class="go">EAL: PCI memory mapped at 0x7f7f80000000</span>
<span class="go">EAL: PCI memory mapped at 0x7f7f80800000</span>
<span class="go">PMD: eth_i40e_dev_init(): FW 5.0 API 1.5 NVM 05.00.02 eetrack 8000208a</span>
<span class="go">Interactive-mode selected</span>
<span class="go">Configuring Port 0 (socket 0)</span>
<span class="go">...</span>

<span class="go">PMD: i40e_dev_rx_queue_setup(): Rx Burst Bulk Alloc Preconditions are</span>
<span class="go">satisfied.Rx Burst Bulk Alloc function will be used on port=0, queue=0.</span>

<span class="go">...</span>
<span class="go">Port 0: 68:05:CA:26:85:84</span>
<span class="go">Checking link statuses...</span>
<span class="go">Port 0 Link Up - speed 10000 Mbps - full-duplex</span>
<span class="go">Done</span>

<span class="go">testpmd&gt;</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="sample-application-notes">
<h2><span class="section-number">27.8. </span>Sample Application Notes</h2>
<section id="vlan-filter">
<h3><span class="section-number">27.8.1. </span>Vlan filter</h3>
<p>Vlan filter only works when Promiscuous mode is off.</p>
<p>To start <code class="docutils literal notranslate"><span class="pre">testpmd</span></code>, and add vlan 10 to port 0:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./&lt;build_dir&gt;/app/dpdk-testpmd -l 0-15 -n 4 -- -i --forward-mode=mac</span>
<span class="go">...</span>

<span class="go">testpmd&gt; set promisc 0 off</span>
<span class="go">testpmd&gt; rx_vlan add 10 0</span>
</pre></div>
</div>
</section>
<section id="flow-director">
<h3><span class="section-number">27.8.2. </span>Flow Director</h3>
<p>The Flow Director works in receive mode to identify specific flows or sets of flows and route them to specific queues.
The Flow Director filters can match the different fields for different type of packet: flow type, specific input set per flow type and the flexible payload.</p>
<p>The default input set of each flow type is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4-other : src_ip_address, dst_ip_address
ipv4-frag  : src_ip_address, dst_ip_address
ipv4-tcp   : src_ip_address, dst_ip_address, src_port, dst_port
ipv4-udp   : src_ip_address, dst_ip_address, src_port, dst_port
ipv4-sctp  : src_ip_address, dst_ip_address, src_port, dst_port,
             verification_tag
ipv6-other : src_ip_address, dst_ip_address
ipv6-frag  : src_ip_address, dst_ip_address
ipv6-tcp   : src_ip_address, dst_ip_address, src_port, dst_port
ipv6-udp   : src_ip_address, dst_ip_address, src_port, dst_port
ipv6-sctp  : src_ip_address, dst_ip_address, src_port, dst_port,
             verification_tag
l2_payload : ether_type
</pre></div>
</div>
<p>The flex payload is selected from offset 0 to 15 of packet’s payload by default, while it is masked out from matching.</p>
<p>Start <code class="docutils literal notranslate"><span class="pre">testpmd</span></code> with <code class="docutils literal notranslate"><span class="pre">--disable-rss</span></code> and <code class="docutils literal notranslate"><span class="pre">--pkt-filter-mode=perfect</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./&lt;build_dir&gt;/app/dpdk-testpmd -l 0-15 -n 4 -- -i --disable-rss \</span>
<span class="go">              --pkt-filter-mode=perfect --rxq=8 --txq=8 --nb-cores=8 \</span>
<span class="go">              --nb-ports=1</span>
</pre></div>
</div>
<p>Add a rule to direct <code class="docutils literal notranslate"><span class="pre">ipv4-udp</span></code> packet whose <code class="docutils literal notranslate"><span class="pre">dst_ip=2.2.2.5,</span> <span class="pre">src_ip=2.2.2.3,</span> <span class="pre">src_port=32,</span> <span class="pre">dst_port=32</span></code> to queue 1:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 2.2.2.3 \</span>
<span class="go">         dst is 2.2.2.5 / udp src is 32 dst is 32 / end \</span>
<span class="go">         actions mark id 1 / queue index 1 / end</span>
</pre></div>
</div>
<p>Check the flow director status:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show port fdir 0</span>

<span class="gp">#</span><span class="c1">####################### FDIR infos for port 0      ####################</span>
<span class="go">  MODE:   PERFECT</span>
<span class="go">  SUPPORTED FLOW TYPE:  ipv4-frag ipv4-tcp ipv4-udp ipv4-sctp ipv4-other</span>
<span class="go">                        ipv6-frag ipv6-tcp ipv6-udp ipv6-sctp ipv6-other</span>
<span class="go">                        l2_payload</span>
<span class="go">  FLEX PAYLOAD INFO:</span>
<span class="go">  max_len:       16          payload_limit: 480</span>
<span class="go">  payload_unit:  2           payload_seg:   3</span>
<span class="go">  bitmask_unit:  2           bitmask_num:   2</span>
<span class="go">  MASK:</span>
<span class="go">    vlan_tci: 0x0000,</span>
<span class="go">    src_ipv4: 0x00000000,</span>
<span class="go">    dst_ipv4: 0x00000000,</span>
<span class="go">    src_port: 0x0000,</span>
<span class="go">    dst_port: 0x0000</span>
<span class="go">    src_ipv6: 0x00000000,0x00000000,0x00000000,0x00000000,</span>
<span class="go">    dst_ipv6: 0x00000000,0x00000000,0x00000000,0x00000000</span>
<span class="go">  FLEX PAYLOAD SRC OFFSET:</span>
<span class="go">    L2_PAYLOAD:    0      1      2      3      4      5      6  ...</span>
<span class="go">    L3_PAYLOAD:    0      1      2      3      4      5      6  ...</span>
<span class="go">    L4_PAYLOAD:    0      1      2      3      4      5      6  ...</span>
<span class="go">  FLEX MASK CFG:</span>
<span class="go">    ipv4-udp:    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv4-tcp:    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv4-sctp:   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv4-other:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv4-frag:   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv6-udp:    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv6-tcp:    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv6-sctp:   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv6-other:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    ipv6-frag:   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">    l2_payload:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span>
<span class="go">  guarant_count: 1           best_count:    0</span>
<span class="go">  guarant_space: 512         best_space:    7168</span>
<span class="go">  collision:     0           free:          0</span>
<span class="go">  maxhash:       0           maxlen:        0</span>
<span class="go">  add:           0           remove:        0</span>
<span class="go">  f_add:         0           f_remove:      0</span>
</pre></div>
</div>
</section>
<section id="floating-veb">
<h3><span class="section-number">27.8.3. </span>Floating VEB</h3>
<p>The Intel® Ethernet 700 Series support a feature called
“Floating VEB”.</p>
<p>A Virtual Ethernet Bridge (VEB) is an IEEE Edge Virtual Bridging (EVB) term
for functionality that allows local switching between virtual endpoints within
a physical endpoint and also with an external bridge/network.</p>
<p>A “Floating” VEB doesn’t have an uplink connection to the outside world so all
switching is done internally and remains within the host. As such, this
feature provides security benefits.</p>
<p>In addition, a Floating VEB overcomes a limitation of normal VEBs where they
cannot forward packets when the physical link is down. Floating VEBs don’t need
to connect to the NIC port so they can still forward traffic from VF to VF
even when the physical link is down.</p>
<p>Therefore, with this feature enabled VFs can be limited to communicating with
each other but not an outside network, and they can do so even when there is
no physical uplink on the associated NIC port.</p>
<p>To enable this feature, the user should pass a <code class="docutils literal notranslate"><span class="pre">devargs</span></code> parameter to the
EAL, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 84:00.0,enable_floating_veb=1
</pre></div>
</div>
<p>In this configuration the PMD will use the floating VEB feature for all the
VFs created by this PF device.</p>
<p>Alternatively, the user can specify which VFs need to connect to this floating
VEB using the <code class="docutils literal notranslate"><span class="pre">floating_veb_list</span></code> argument:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-a 84:00.0,enable_floating_veb=1,floating_veb_list=1;3-4
</pre></div>
</div>
<p>In this example <code class="docutils literal notranslate"><span class="pre">VF1</span></code>, <code class="docutils literal notranslate"><span class="pre">VF3</span></code> and <code class="docutils literal notranslate"><span class="pre">VF4</span></code> connect to the floating VEB,
while other VFs connect to the normal VEB.</p>
<p>The current implementation only supports one floating VEB and one regular
VEB. VFs can connect to a floating VEB or a regular VEB according to the
configuration passed on the EAL command line.</p>
<p>The floating VEB functionality requires a NIC firmware version of 5.0
or greater.</p>
</section>
<section id="dynamic-device-personalization-ddp">
<h3><span class="section-number">27.8.4. </span>Dynamic Device Personalization (DDP)</h3>
<p>The Intel® Ethernet 700 Series except for the Intel Ethernet Connection
X722 support a feature called “Dynamic Device Personalization (DDP)”,
which is used to configure hardware by downloading a profile to support
protocols/filters which are not supported by default. The DDP
functionality requires a NIC firmware version of 6.0 or greater.</p>
<p>Current implementation supports GTP-C/GTP-U/PPPoE/PPPoL2TP/ESP,
steering can be used with rte_flow API.</p>
<p>GTPv1 package is released, and it can be downloaded from
<a class="reference external" href="https://downloadcenter.intel.com/download/27587">https://downloadcenter.intel.com/download/27587</a>.</p>
<p>PPPoE package is released, and it can be downloaded from
<a class="reference external" href="https://downloadcenter.intel.com/download/28040">https://downloadcenter.intel.com/download/28040</a>.</p>
<p>ESP-AH package is released, and it can be downloaded from
<a class="reference external" href="https://downloadcenter.intel.com/download/29446">https://downloadcenter.intel.com/download/29446</a>.</p>
<p>Load a profile which supports GTP and store backup profile:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; ddp add 0 ./gtp.pkgo,./backup.pkgo</span>
</pre></div>
</div>
<p>Delete a GTP profile and restore backup profile:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; ddp del 0 ./backup.pkgo</span>
</pre></div>
</div>
<p>Get loaded DDP package info list:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; ddp get list 0</span>
</pre></div>
</div>
<p>Display information about a GTP profile:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; ddp get info ./gtp.pkgo</span>
</pre></div>
</div>
</section>
<section id="input-set-configuration">
<h3><span class="section-number">27.8.5. </span>Input set configuration</h3>
<p>Input set for any PCTYPE can be configured with user defined configuration,
For example, to use only 48bit prefix for IPv6 src address for IPv6 TCP RSS:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port config 0 pctype 43 hash_inset clear all</span>
<span class="go">testpmd&gt; port config 0 pctype 43 hash_inset set field 13</span>
<span class="go">testpmd&gt; port config 0 pctype 43 hash_inset set field 14</span>
<span class="go">testpmd&gt; port config 0 pctype 43 hash_inset set field 15</span>
</pre></div>
</div>
</section>
<section id="queue-region-configuration">
<h3><span class="section-number">27.8.6. </span>Queue region configuration</h3>
<p>The Intel® Ethernet 700 Series supports a feature of queue regions
configuration for RSS in the PF, so that different traffic classes or
different packet classification types can be separated to different
queues in different queue regions. There is an API for configuration
of queue regions in RSS with a command line. It can parse the parameters
of the region index, queue number, queue start index, user priority, traffic
classes and so on. Depending on commands from the command line, it will call
i40e private APIs and start the process of setting or flushing the queue
region configuration. As this feature is specific for i40e only private
APIs are used.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; set port (port_id) queue-region region_id (value) \</span>
<span class="go">             queue_start_index (value) queue_num (value)</span>
<span class="go">testpmd&gt; set port (port_id) queue-region region_id (value) flowtype (value)</span>
<span class="go">testpmd&gt; set port (port_id) queue-region UP (value) region_id (value)</span>
<span class="go">testpmd&gt; set port (port_id) queue-region flush (on|off)</span>
<span class="go">testpmd&gt; show port (port_id) queue-region</span>
</pre></div>
</div>
</section>
<section id="generic-flow-api">
<h3><span class="section-number">27.8.7. </span>Generic flow API</h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">RSS</span> <span class="pre">Flow</span></code></p>
<p>RSS Flow supports to set hash input set, hash function, enable hash
and configure queues.
For example:
Configure queues as queue 0, 1, 2, 3.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; flow create 0 ingress pattern end actions rss types end \</span>
<span class="go">  queues 0 1 2 3 end / end</span>
</pre></div>
</div>
<p>Enable hash and set input set for ipv4-tcp.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; flow create 0 ingress pattern eth / ipv4 / tcp / end \</span>
<span class="go">  actions rss types ipv4-tcp l3-src-only end queues end / end</span>
</pre></div>
</div>
<p>Set symmetric hash enable for flow type ipv4-tcp.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; flow create 0 ingress pattern eth / ipv4 / tcp / end \</span>
<span class="go">  actions rss types ipv4-tcp end queues end func symmetric_toeplitz / end</span>
</pre></div>
</div>
<p>Set hash function as simple xor.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; flow create 0 ingress pattern end actions rss types end \</span>
<span class="go">  queues end func simple_xor / end</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="limitations-or-known-issues">
<h2><span class="section-number">27.9. </span>Limitations or Known issues</h2>
<section id="mpls-packet-classification">
<h3><span class="section-number">27.9.1. </span>MPLS packet classification</h3>
<p>For firmware versions prior to 5.0, MPLS packets are not recognized by the NIC.
The L2 Payload flow type in flow director can be used to classify MPLS packet
by using a command in testpmd like:</p>
<blockquote>
<div><dl class="simple">
<dt>testpmd&gt; flow_director_filter 0 mode IP add flow l2_payload ether </dt><dd><p>0x8847 flexbytes () fwd pf queue &lt;N&gt; fd_id &lt;M&gt;</p>
</dd>
</dl>
</div></blockquote>
<p>With the NIC firmware version 5.0 or greater, some limited MPLS support
is added: Native MPLS (MPLS in Ethernet) skip is implemented, while no
new packet type, no classification or offload are possible. With this change,
L2 Payload flow type in flow director cannot be used to classify MPLS packet
as with previous firmware versions. Meanwhile, the Ethertype filter can be
used to classify MPLS packet by using a command in testpmd like:</p>
<blockquote>
<div><dl class="simple">
<dt>testpmd&gt; flow create 0 ingress pattern eth type is 0x8847 / end </dt><dd><p>actions queue index &lt;M&gt; / end</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="receive-packets-with-ethertype-0x88a8">
<h3><span class="section-number">27.9.2. </span>Receive packets with Ethertype 0x88A8</h3>
<p>Due to the FW limitation, PF can receive packets with Ethertype 0x88A8
only when floating VEB is disabled.</p>
</section>
<section id="incorrect-rx-statistics-when-packet-is-oversize">
<h3><span class="section-number">27.9.3. </span>Incorrect Rx statistics when packet is oversize</h3>
<p>When a packet is over maximum frame size, the packet is dropped.
However, the Rx statistics, when calling <cite>rte_eth_stats_get</cite> incorrectly
shows it as received.</p>
</section>
<section id="rx-tx-statistics-may-be-incorrect-when-register-overflowed">
<h3><span class="section-number">27.9.4. </span>RX/TX statistics may be incorrect when register overflowed</h3>
<p>The rx_bytes/tx_bytes statistics register is 48 bit length.
Although this limitation is enlarged to 64 bit length on the software side,
but there is no way to detect if the overflow occurred more than once.
So rx_bytes/tx_bytes statistics data is correct when statistics are
updated at least once between two overflows.</p>
</section>
<section id="vf-tc-max-bandwidth-setting">
<h3><span class="section-number">27.9.5. </span>VF &amp; TC max bandwidth setting</h3>
<p>The per VF max bandwidth and per TC max bandwidth cannot be enabled in parallel.
The behavior is different when handling per VF and per TC max bandwidth setting.
When enabling per VF max bandwidth, SW will check if per TC max bandwidth is
enabled. If so, return failure.
When enabling per TC max bandwidth, SW will check if per VF max bandwidth
is enabled. If so, disable per VF max bandwidth and continue with per TC max
bandwidth setting.</p>
</section>
<section id="tc-tx-scheduling-mode-setting">
<h3><span class="section-number">27.9.6. </span>TC TX scheduling mode setting</h3>
<p>There are 2 TX scheduling modes for TCs, round robin and strict priority mode.
If a TC is set to strict priority mode, it can consume unlimited bandwidth.
It means if APP has set the max bandwidth for that TC, it comes to no
effect.
It’s suggested to set the strict priority mode for a TC that is latency
sensitive but no consuming much bandwidth.</p>
</section>
<section id="dcb-function">
<h3><span class="section-number">27.9.7. </span>DCB function</h3>
<p>DCB works only when RSS is enabled.</p>
</section>
<section id="global-configuration-warning">
<h3><span class="section-number">27.9.8. </span>Global configuration warning</h3>
<p>I40E PMD will set some global registers to enable some function or set some
configure. Then when using different ports of the same NIC with Linux kernel
and DPDK, the port with Linux kernel will be impacted by the port with DPDK.
For example, register I40E_GL_SWT_L2TAGCTRL is used to control L2 tag, i40e
PMD uses I40E_GL_SWT_L2TAGCTRL to set vlan TPID. If setting TPID in port A
with DPDK, then the configuration will also impact port B in the NIC with
kernel driver, which don’t want to use the TPID.
So PMD reports warning to clarify what is changed by writing global register.</p>
</section>
<section id="cloud-filter">
<h3><span class="section-number">27.9.9. </span>Cloud Filter</h3>
<p>When programming cloud filters for IPv4/6_UDP/TCP/SCTP with SRC port only or DST port only,
it will make any cloud filter using inner_vlan or tunnel key invalid. Default configuration will be
recovered only by NIC core reset.</p>
</section>
<section id="mirror-rule-limitation-for-x722">
<h3><span class="section-number">27.9.10. </span>Mirror rule limitation for X722</h3>
<p>Due to firmware restriction of X722, the same VSI cannot have more than one mirror rule.</p>
</section>
</section>
<section id="testpmd-driver-specific-commands">
<span id="net-i40e-testpmd-commands"></span><h2><span class="section-number">27.10. </span>Testpmd driver specific commands</h2>
<p>Some i40e driver specific features are integrated in testpmd.</p>
<section id="rss-queue-region">
<h3><span class="section-number">27.10.1. </span>RSS queue region</h3>
<p>Set RSS queue region span on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) queue-region region_id (value) \
             queue_start_index (value) queue_num (value)
</pre></div>
</div>
<p>Set flowtype mapping on a RSS queue region on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) queue-region region_id (value) flowtype (value)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p>For the flowtype(pctype) of packet,the specific index for each type has
been defined in file i40e_type.h as enum i40e_filter_pctype.</p></li>
</ul>
<p>Set user priority mapping on a RSS queue region on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) queue-region UP (value) region_id (value)
</pre></div>
</div>
<p>Flush all queue region related configuration on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) queue-region flush (on|off)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code>: is just an enable function which server for other configuration,
it is for all configuration about queue region from up layer,
at first will only keep in DPDK software stored in driver,
only after “flush on”, it commit all configuration to HW.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;off</span></code>: is just clean all configuration about queue region just now,
and restore all to DPDK i40e driver default config when start up.</p></li>
</ul>
<p>Show all queue region related configuration info on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) queue-region
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Queue region only support on PF by now, so these command is
only for configuration of queue region on PF port.</p>
</div>
</section>
<section id="set-promisc-for-vf">
<h3><span class="section-number">27.10.2. </span>set promisc (for VF)</h3>
<p>Set the unicast promiscuous mode for a VF from PF.
It’s supported by Intel i40e NICs now.
In promiscuous mode packets are not dropped if they aren’t for the specified MAC address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf promisc (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="set-allmulticast-for-vf">
<h3><span class="section-number">27.10.3. </span>set allmulticast (for VF)</h3>
<p>Set the multicast promiscuous mode for a VF from PF.
It’s supported by Intel i40e NICs now.
In promiscuous mode packets are not dropped if they aren’t for the specified MAC address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf allmulti (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="set-broadcast-mode-for-vf">
<h3><span class="section-number">27.10.4. </span>set broadcast mode (for VF)</h3>
<p>Set broadcast mode for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf broadcast (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="vlan-set-tag-for-vf">
<h3><span class="section-number">27.10.5. </span>vlan set tag (for VF)</h3>
<p>Set VLAN tag for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan tag (port_id) (vf_id) (on|off)
</pre></div>
</div>
</section>
<section id="set-tx-max-bandwidth-for-vf">
<h3><span class="section-number">27.10.6. </span>set tx max bandwidth (for VF)</h3>
<p>Set TX max absolute bandwidth (Mbps) for a VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf tx max-bandwidth (port_id) (vf_id) (max_bandwidth)
</pre></div>
</div>
</section>
<section id="set-tc-tx-min-bandwidth-for-vf">
<h3><span class="section-number">27.10.7. </span>set tc tx min bandwidth (for VF)</h3>
<p>Set all TCs’ TX min relative bandwidth (%) for a VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf tc tx min-bandwidth (port_id) (vf_id) (bw1, bw2, ...)
</pre></div>
</div>
</section>
<section id="set-tc-tx-max-bandwidth-for-vf">
<h3><span class="section-number">27.10.8. </span>set tc tx max bandwidth (for VF)</h3>
<p>Set a TC’s TX max absolute bandwidth (Mbps) for a VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf tc tx max-bandwidth (port_id) (vf_id) (tc_no) (max_bandwidth)
</pre></div>
</div>
</section>
<section id="set-tc-strict-link-priority-mode">
<h3><span class="section-number">27.10.9. </span>set tc strict link priority mode</h3>
<p>Set some TCs’ strict link priority mode on a physical port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set tx strict-link-priority (port_id) (tc_bitmap)
</pre></div>
</div>
</section>
<section id="ddp-add">
<h3><span class="section-number">27.10.10. </span>ddp add</h3>
<p>Load a dynamic device personalization (DDP) profile and store backup profile:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ddp add (port_id) (profile_path[,backup_profile_path])
</pre></div>
</div>
</section>
<section id="ddp-del">
<h3><span class="section-number">27.10.11. </span>ddp del</h3>
<p>Delete a dynamic device personalization profile and restore backup profile:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ddp del (port_id) (backup_profile_path)
</pre></div>
</div>
</section>
<section id="ddp-get-list">
<h3><span class="section-number">27.10.12. </span>ddp get list</h3>
<p>Get loaded dynamic device personalization (DDP) package info list:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ddp get list (port_id)
</pre></div>
</div>
</section>
<section id="ddp-get-info">
<h3><span class="section-number">27.10.13. </span>ddp get info</h3>
<p>Display information about dynamic device personalization (DDP) profile:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ddp get info (profile_path)
</pre></div>
</div>
</section>
<section id="ptype-mapping">
<h3><span class="section-number">27.10.14. </span>ptype mapping</h3>
<p>List all items from the ptype mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping get (port_id) (valid_only)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">valid_only</span></code>: A flag indicates if only list valid items(=1) or all items(=0).</p></li>
</ul>
<p>Replace a specific or a group of software defined ptype with a new one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping replace  (port_id) (target) (mask) (pkt_type)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target</span></code>: A specific software ptype or a mask to represent a group of software ptypes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code>: A flag indicate if “target” is a specific software ptype(=0) or a ptype mask(=1).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pkt_type</span></code>: The new software ptype to replace the old ones.</p></li>
</ul>
<p>Update hardware defined ptype to software defined packet type mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping update (port_id) (hw_ptype) (sw_ptype)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hw_ptype</span></code>: hardware ptype as the index of the ptype mapping table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sw_ptype</span></code>: software ptype as the value of the ptype mapping table.</p></li>
</ul>
<p>Reset ptype mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping reset (port_id)
</pre></div>
</div>
</section>
<section id="show-port-pctype-mapping">
<h3><span class="section-number">27.10.15. </span>show port pctype mapping</h3>
<p>List all items from the pctype mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) pctype mapping
</pre></div>
</div>
</section>
</section>
<section id="high-performance-of-small-packets-on-40gbe-nic">
<h2><span class="section-number">27.11. </span>High Performance of Small Packets on 40GbE NIC</h2>
<p>As there might be firmware fixes for performance enhancement in latest version
of firmware image, the firmware update might be needed for getting high performance.
Check the Intel support website for the latest firmware updates.
Users should consult the release notes specific to a DPDK release to identify
the validated firmware version for a NIC using the i40e driver.</p>
<section id="use-16-bytes-rx-descriptor-size">
<h3><span class="section-number">27.11.1. </span>Use 16 Bytes RX Descriptor Size</h3>
<p>As i40e PMD supports both 16 and 32 bytes RX descriptor sizes, and 16 bytes size can provide helps to high performance of small packets.
In <code class="docutils literal notranslate"><span class="pre">config/rte_config.h</span></code> set the following to use 16 bytes size RX descriptors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define RTE_LIBRTE_I40E_16BYTE_RX_DESC 1
</pre></div>
</div>
</section>
<section id="input-set-requirement-of-each-pctype-for-fdir">
<h3><span class="section-number">27.11.2. </span>Input set requirement of each pctype for FDIR</h3>
<p>Each PCTYPE can only have one specific FDIR input set at one time.
For example, if creating 2 rte_flow rules with different input set for one PCTYPE,
it will fail and return the info “Conflict with the first rule’s input set”,
which means the current rule’s input set conflicts with the first rule’s.
Remove the first rule if want to change the input set of the PCTYPE.</p>
</section>
<section id="vlan-related-features-miss-when-fw-8-4">
<h3><span class="section-number">27.11.3. </span>Vlan related Features miss when FW &gt;= 8.4</h3>
<p>If FW version &gt;= 8.4, there’ll be some Vlan related issues:</p>
<ol class="arabic simple">
<li><p>TCI input set for QinQ  is invalid.</p></li>
<li><p>Fail to configure TPID for QinQ.</p></li>
<li><p>Need to enable QinQ before enabling Vlan filter.</p></li>
<li><p>Fail to strip outer Vlan.</p></li>
</ol>
</section>
</section>
<section id="example-of-getting-best-performance-with-l3fwd-example">
<h2><span class="section-number">27.12. </span>Example of getting best performance with l3fwd example</h2>
<p>The following is an example of running the DPDK <code class="docutils literal notranslate"><span class="pre">l3fwd</span></code> sample application to get high performance with a
server with Intel Xeon processors and Intel Ethernet CNA XL710.</p>
<p>The example scenario is to get best performance with two Intel Ethernet CNA XL710 40GbE ports.
See <a class="reference internal" href="#figure-intel-perf-test-setup"><span class="std std-numref">Fig. 27.1</span></a> for the performance test setup.</p>
<figure class="align-default" id="id1">
<span id="figure-intel-perf-test-setup"></span><img alt="../_images/intel_perf_test_setup.svg" src="../_images/intel_perf_test_setup.svg" /><figcaption>
<p><span class="caption-number">Fig. 27.1 </span><span class="caption-text">Performance Test Setup</span></p>
</figcaption>
</figure>
<ol class="arabic">
<li><p>Add two Intel Ethernet CNA XL710 to the platform, and use one port per card to get best performance.
The reason for using two NICs is to overcome a PCIe v3.0 limitation since it cannot provide 80GbE bandwidth
for two 40GbE ports, but two different PCIe v3.0 x8 slot can.
Refer to the sample NICs output above, then we can select <code class="docutils literal notranslate"><span class="pre">82:00.0</span></code> and <code class="docutils literal notranslate"><span class="pre">85:00.0</span></code> as test ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>82:00.0 Ethernet [0200]: Intel XL710 for 40GbE QSFP+ [8086:1583]
85:00.0 Ethernet [0200]: Intel XL710 for 40GbE QSFP+ [8086:1583]
</pre></div>
</div>
</li>
<li><p>Connect the ports to the traffic generator. For high speed testing, it’s best to use a hardware traffic generator.</p></li>
<li><p>Check the PCI devices numa node (socket id) and get the cores number on the exact socket id.
In this case, <code class="docutils literal notranslate"><span class="pre">82:00.0</span></code> and <code class="docutils literal notranslate"><span class="pre">85:00.0</span></code> are both in socket 1, and the cores on socket 1 in the referenced platform
are 18-35 and 54-71.
Note: Don’t use 2 logical cores on the same core (e.g core18 has 2 logical cores, core18 and core54), instead, use 2 logical
cores from different cores (e.g core18 and core19).</p></li>
<li><p>Bind these two ports to igb_uio.</p></li>
<li><p>As to Intel Ethernet CNA XL710 40GbE port, we need at least two queue pairs to achieve best performance, then two queues per port
will be required, and each queue pair will need a dedicated CPU core for receiving/transmitting packets.</p></li>
<li><p>The DPDK sample application <code class="docutils literal notranslate"><span class="pre">l3fwd</span></code> will be used for performance testing, with using two ports for bi-directional forwarding.
Compile the <code class="docutils literal notranslate"><span class="pre">l3fwd</span> <span class="pre">sample</span></code> with the default lpm mode.</p></li>
<li><p>The command line of running l3fwd would be something like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./dpdk-l3fwd -l 18-21 -n 4 -a 82:00.0 -a 85:00.0 \
        -- -p 0x3 --config &#39;(0,0,18),(0,1,19),(1,0,20),(1,1,21)&#39;
</pre></div>
</div>
<p>This means that the application uses core 18 for port 0, queue pair 0 forwarding, core 19 for port 0, queue pair 1 forwarding,
core 20 for port 1, queue pair 0 forwarding, and core 21 for port 1, queue pair 1 forwarding.</p>
</li>
<li><p>Configure the traffic at a traffic generator.</p>
<ul class="simple">
<li><p>Start creating a stream on packet generator.</p></li>
<li><p>Set the Ethernet II type to 0x0800.</p></li>
</ul>
</li>
</ol>
<section id="tx-bytes-affected-by-the-link-status-change">
<h3><span class="section-number">27.12.1. </span>Tx bytes affected by the link status change</h3>
<p>For firmware versions prior to 6.01 for X710 series and 3.33 for X722 series, the tx_bytes statistics data is affected by
the link down event. Each time the link status changes to down, the tx_bytes decreases 110 bytes.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DPDK_logo_vertical_rev_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Data Plane Development Kit</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mldevs/index.html">Machine Learning Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmadevs/index.html">DMA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpus/index.html">General-Purpose Graphics Processing Unit Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Network Interface Controller Drivers</a><ul>
      <li>Previous: <a href="hns3.html" title="previous chapter"><span class="section-number">26. </span>HNS3 Poll Mode Driver</a></li>
      <li>Next: <a href="ice.html" title="next chapter"><span class="section-number">28. </span>ICE Poll Mode Driver</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/nics/i40e.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>