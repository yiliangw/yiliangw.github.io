
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>26. Security Library &#8212; Data Plane Development Kit 23.11.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="27. Rawdevice Library" href="rawdev.html" />
    <link rel="prev" title="25. General-Purpose Graphics Processing Unit Library" href="gpudev.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="security-library">
<h1><span class="section-number">26. </span>Security Library</h1>
<p>The security library provides a framework for management and provisioning
of security protocol operations offloaded to hardware based devices. The
library defines generic APIs to create and free security sessions which can
support full protocol offload as well as inline crypto operation with
NIC or crypto devices. The framework currently only supports the IPsec, PDCP
and DOCSIS protocols and associated operations, other protocols will be added
in the future.</p>
<section id="design-principles">
<h2><span class="section-number">26.1. </span>Design Principles</h2>
<p>The security library provides an additional offload capability to an existing
crypto device and/or ethernet device.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">       +---------------+</span>
<span class="go">       | rte_security  |</span>
<span class="go">       +---------------+</span>
<span class="go">         \            /</span>
<span class="go">+-----------+    +--------------+</span>
<span class="go">|  NIC PMD  |    |  CRYPTO PMD  |</span>
<span class="go">+-----------+    +--------------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, the security library does not support the case of multi-process.
It will be updated in the future releases.</p>
</div>
<p>The supported offload types are explained in the sections below.</p>
<section id="inline-crypto">
<h3><span class="section-number">26.1.1. </span>Inline Crypto</h3>
<p>RTE_SECURITY_ACTION_TYPE_INLINE_CRYPTO:
The crypto processing for security protocol (e.g. IPsec) is processed
inline during receive and transmission on NIC port. The flow based
security action should be configured on the port.</p>
<p>Ingress Data path - The packet is decrypted in RX path and relevant
crypto status is set in Rx descriptors. After the successful inline
crypto processing the packet is presented to host as a regular Rx packet
however all security protocol related headers are still attached to the
packet. e.g. In case of IPsec, the IPsec tunnel headers (if any),
ESP/AH headers will remain in the packet but the received packet
contains the decrypted data where the encrypted data was when the packet
arrived. The driver Rx path check the descriptors and based on the
crypto status sets additional flags in the rte_mbuf.ol_flags field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The underlying device may not support crypto processing for all ingress packet
matching to a particular flow (e.g. fragmented packets), such packets will
be passed as encrypted packets. It is the responsibility of application to
process such encrypted packets using other crypto driver instance.</p>
</div>
<p>Egress Data path - The software prepares the egress packet by adding
relevant security protocol headers. Only the data will not be
encrypted by the software. The driver will accordingly configure the
tx descriptors. The hardware device will encrypt the data before sending the
packet out.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The underlying device may support post encryption TSO.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">  Egress Data Path</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|  egress IPsec   |</span>
<span class="go">|        |        |</span>
<span class="go">| +------V------+ |</span>
<span class="go">| | SADB lookup | |</span>
<span class="go">| +------|------+ |</span>
<span class="go">| +------V------+ |</span>
<span class="go">| |   Tunnel    | |   &lt;------ Add tunnel header to packet</span>
<span class="go">| +------|------+ |</span>
<span class="go">| +------V------+ |</span>
<span class="go">| |     ESP     | |   &lt;------ Add ESP header without trailer to packet</span>
<span class="go">| |             | |   &lt;------ Mark packet to be offloaded, add trailer</span>
<span class="go">| +------|------+ |            meta-data to mbuf</span>
<span class="go">+--------V--------+</span>
<span class="go">         |</span>
<span class="go">+--------V--------+</span>
<span class="go">|    L2 Stack     |</span>
<span class="go">+--------|--------+</span>
<span class="go">         |</span>
<span class="go">+--------V--------+</span>
<span class="go">|                 |</span>
<span class="go">|     NIC PMD     |   &lt;------ Set hw context for inline crypto offload</span>
<span class="go">|                 |</span>
<span class="go">+--------|--------+</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|  HW ACCELERATED |   &lt;------ Packet Encryption and</span>
<span class="go">|        NIC      |           Authentication happens inline</span>
<span class="go">|                 |</span>
<span class="go">+-----------------+</span>
</pre></div>
</div>
</section>
<section id="inline-protocol-offload">
<h3><span class="section-number">26.1.2. </span>Inline protocol offload</h3>
<p>RTE_SECURITY_ACTION_TYPE_INLINE_PROTOCOL:
The crypto and protocol processing for security protocol (e.g. IPsec)
is processed inline during receive and transmission.  The flow based
security action should be configured on the port.</p>
<p>Ingress Data path - The packet is decrypted in the RX path and relevant
crypto status is set in the Rx descriptors. After the successful inline
crypto processing the packet is presented to the host as a regular Rx packet
but all security protocol related headers are optionally removed from the
packet. e.g. in the case of IPsec, the IPsec tunnel headers (if any),
ESP/AH headers will be removed from the packet and the received packet
will contains the decrypted packet only. The driver Rx path checks the
descriptors and based on the crypto status sets additional flags in
<code class="docutils literal notranslate"><span class="pre">rte_mbuf.ol_flags</span></code> field. The driver would also set device-specific
metadata in <code class="docutils literal notranslate"><span class="pre">RTE_SECURITY_DYNFIELD_NAME</span></code> field.
This will allow the application to identify the security processing
done on the packet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The underlying device in this case is stateful. It is expected that
the device shall support crypto processing for all kind of packets matching
to a given flow, this includes fragmented packets (post reassembly).
E.g. in case of IPsec the device may internally manage anti-replay etc.
It will provide a configuration option for anti-replay behavior i.e. to drop
the packets or pass them to driver with error flags set in the descriptor.</p>
</div>
<p>Egress Data path - The software will send the plain packet without any
security protocol headers added to the packet. The driver will configure
the security index and other requirement in tx descriptors.
The hardware device will do security processing on the packet that includes
adding the relevant protocol headers and encrypting the data before sending
the packet out. The software should make sure that the buffer
has required head room and tail room for any protocol header addition. The
software may also do early fragmentation if the resultant packet is expected
to cross the MTU size. The software should also make sure that L2 header contents
are updated with the final L2 header which is expected post IPsec processing as
the IPsec offload will only update L3 and above in egress path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The underlying device will manage state information required for egress
processing. E.g. in case of IPsec, the seq number will be added to the
packet, however the device shall provide indication when the sequence number
is about to overflow. The underlying device may support post encryption TSO.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> Egress Data Path</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|  egress IPsec   |</span>
<span class="go">|        |        |</span>
<span class="go">| +------V------+ |</span>
<span class="go">| | SADB lookup | |</span>
<span class="go">| +------|------+ |</span>
<span class="go">| +------V------+ |</span>
<span class="go">| |   Desc      | |   &lt;------ Mark packet to be offloaded</span>
<span class="go">| +------|------+ |</span>
<span class="go">+--------V--------+</span>
<span class="go">         |</span>
<span class="go">+--------V--------+</span>
<span class="go">|    L2 Stack     |</span>
<span class="go">+--------|--------+</span>
<span class="go">         |</span>
<span class="go">+--------V--------+</span>
<span class="go">|                 |</span>
<span class="go">|     NIC PMD     |   &lt;------ Set hw context for inline crypto offload</span>
<span class="go">|                 |</span>
<span class="go">+--------|--------+</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|  HW ACCELERATED |   &lt;------ Add tunnel, ESP header etc header to</span>
<span class="go">|        NIC      |           packet. Packet Encryption and</span>
<span class="go">|                 |           Authentication happens inline.</span>
<span class="go">+-----------------+</span>
</pre></div>
</div>
</section>
<section id="lookaside-protocol-offload">
<h3><span class="section-number">26.1.3. </span>Lookaside protocol offload</h3>
<p>RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL:
This extends librte_cryptodev to support the programming of IPsec
Security Association (SA) as part of a crypto session creation including
the definition. In addition to standard crypto processing, as defined by
the cryptodev, the security protocol processing is also offloaded to the
crypto device.</p>
<p>Decryption: The packet is sent to the crypto device for security
protocol processing. The device will decrypt the packet and it will also
optionally remove additional security headers from the packet.
E.g. in case of IPsec, IPsec tunnel headers (if any), ESP/AH headers
will be removed from the packet and the decrypted packet may contain
plain data only.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case of IPsec the device may internally manage anti-replay etc.
It will provide a configuration option for anti-replay behavior i.e. to drop
the packets or pass them to driver with error flags set in descriptor.</p>
</div>
<p>Encryption: The software will submit the packet to cryptodev as usual
for encryption, the hardware device in this case will also add the relevant
security protocol header along with encrypting the packet. The software
should make sure that the buffer has required head room and tail room
for any protocol header addition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the case of IPsec, the seq number will be added to the packet,
It shall provide an indication when the sequence number is about to
overflow.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">  Egress Data Path</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|  egress IPsec   |</span>
<span class="go">|        |        |</span>
<span class="go">| +------V------+ |</span>
<span class="go">| | SADB lookup | |   &lt;------ SA maps to cryptodev session</span>
<span class="go">| +------|------+ |</span>
<span class="go">| +------|------+ |</span>
<span class="go">| |      \--------------------\</span>
<span class="go">| |    Crypto   | |           |  &lt;- Crypto processing through</span>
<span class="go">| |      /----------------\   |     inline crypto PMD</span>
<span class="go">| +------|------+ |       |   |</span>
<span class="go">+--------V--------+       |   |</span>
<span class="go">         |                |   |</span>
<span class="go">+--------V--------+       |   |  create   &lt;-- SA is added to hw</span>
<span class="go">|    L2 Stack     |       |   |  inline       using existing create</span>
<span class="go">+--------|--------+       |   |  session      sym session APIs</span>
<span class="go">         |                |   |    |</span>
<span class="go">+--------V--------+   +---|---|----V---+</span>
<span class="go">|                 |   |   \---/    |   | &lt;--- Add tunnel, ESP header etc</span>
<span class="go">|     NIC PMD     |   |   INLINE   |   |      header to packet.Packet</span>
<span class="go">|                 |   | CRYPTO PMD |   |      Encryption/Decryption and</span>
<span class="go">+--------|--------+   +----------------+      Authentication happens</span>
<span class="go">         |                                    inline.</span>
<span class="go">+--------|--------+</span>
<span class="go">|       NIC       |</span>
<span class="go">+--------|--------+</span>
<span class="go">         V</span>
</pre></div>
</div>
</section>
<section id="pdcp-flow-diagram">
<h3><span class="section-number">26.1.4. </span>PDCP Flow Diagram</h3>
<p>Based on 3GPP TS 36.323 Evolved Universal Terrestrial Radio Access (E-UTRA);
Packet Data Convergence Protocol (PDCP) specification</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Transmitting</span><span class="w"> </span><span class="n">PDCP</span><span class="w"> </span><span class="n">Entity</span><span class="w">          </span><span class="n">Receiving</span><span class="w"> </span><span class="n">PDCP</span><span class="w"> </span><span class="n">Entity</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                                   </span><span class="o">^</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                       </span><span class="o">+-----------|-----------+</span><span class="w"></span>
<span class="w">          </span><span class="n">V</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">delivery</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">Duplicate</span><span class="w"> </span><span class="n">detection</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Sequence</span><span class="w"> </span><span class="n">Numbering</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w">  </span><span class="p">(</span><span class="n">Data</span><span class="w"> </span><span class="n">Plane</span><span class="w"> </span><span class="n">only</span><span class="p">)</span><span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">            </span><span class="o">+-----------|-----------+</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                                   </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">            </span><span class="o">+-----------|----------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Header</span><span class="w"> </span><span class="n">Compression</span><span class="o">*|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">Header</span><span class="w"> </span><span class="n">Decompression</span><span class="o">*|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="o">-</span><span class="n">Plane</span><span class="w"> </span><span class="n">only</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="p">(</span><span class="n">Data</span><span class="w"> </span><span class="n">Plane</span><span class="w"> </span><span class="n">only</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">            </span><span class="o">+-----------|----------+</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                                   </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|-----------+</span><span class="w">           </span><span class="o">+-----------|----------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Integrity</span><span class="w"> </span><span class="n">Protection</span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="n">Integrity</span><span class="w"> </span><span class="n">Verification</span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">Control</span><span class="w"> </span><span class="n">Plane</span><span class="w"> </span><span class="n">only</span><span class="p">)</span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">Control</span><span class="w"> </span><span class="n">Plane</span><span class="w"> </span><span class="n">only</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|-----------+</span><span class="w">           </span><span class="o">+-----------|----------+</span><span class="w"></span>
<span class="o">+---------|-----------+</span><span class="w">            </span><span class="o">+----------|----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">     </span><span class="n">Ciphering</span><span class="w">       </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w">     </span><span class="n">Deciphering</span><span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|-----------+</span><span class="w">            </span><span class="o">+----------|----------+</span><span class="w"></span>
<span class="o">+---------|-----------+</span><span class="w">            </span><span class="o">+----------|----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">   </span><span class="n">Add</span><span class="w"> </span><span class="n">PDCP</span><span class="w"> </span><span class="n">header</span><span class="w">   </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">PDCP</span><span class="w"> </span><span class="n">Header</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|-----------+</span><span class="w">            </span><span class="o">+----------|----------+</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                                   </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">+-----------------&gt;&gt;----------------+</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Header Compression and decompression are not supported currently.</p></li>
</ul>
</div>
<p>Just like IPsec, in case of PDCP also header addition/deletion, cipher/
de-cipher, integrity protection/verification is done based on the action
type chosen.</p>
</section>
<section id="docsis-protocol">
<h3><span class="section-number">26.1.5. </span>DOCSIS Protocol</h3>
<p>The Data Over Cable Service Interface Specification (DOCSIS) support comprises
the combination of encryption/decryption and CRC generation/verification, for
use in a DOCSIS-MAC pipeline.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">       </span><span class="n">Downlink</span><span class="w">                       </span><span class="n">Uplink</span><span class="w"></span>
<span class="w">       </span><span class="o">--------</span><span class="w">                       </span><span class="o">------</span><span class="w"></span>

<span class="w">    </span><span class="n">Ethernet</span><span class="w"> </span><span class="n">frame</span><span class="w">                </span><span class="n">Ethernet</span><span class="w"> </span><span class="n">frame</span><span class="w"></span>
<span class="w">   </span><span class="n">from</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">network</span><span class="w">              </span><span class="n">to</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">network</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                              </span><span class="o">^</span><span class="w"></span>
<span class="w">          </span><span class="o">~</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                              </span><span class="o">~</span><span class="w">         </span><span class="o">----+</span><span class="w"></span>
<span class="w">          </span><span class="n">V</span><span class="w">                              </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">        </span><span class="o">+----------|---------+</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">   </span><span class="n">CRC</span><span class="w"> </span><span class="n">generation</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="o">|</span><span class="w">  </span><span class="n">CRC</span><span class="w"> </span><span class="n">verification</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">        </span><span class="o">+----------|---------+</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="n">combined</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                              </span><span class="o">|</span><span class="w">             </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Crypto</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CRC</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">        </span><span class="o">+----------|---------+</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">     </span><span class="n">Encryption</span><span class="w">     </span><span class="o">|</span><span class="w">        </span><span class="o">|</span><span class="w">     </span><span class="n">Decryption</span><span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="o">+---------|----------+</span><span class="w">        </span><span class="o">+----------|---------+</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                              </span><span class="o">^</span><span class="w">             </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">~</span><span class="w">                              </span><span class="o">|</span><span class="w">         </span><span class="o">----+</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w">                              </span><span class="o">~</span><span class="w"></span>
<span class="w">          </span><span class="n">V</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w">     </span><span class="n">DOCSIS</span><span class="w"> </span><span class="n">frame</span><span class="w">                  </span><span class="n">DOCSIS</span><span class="w"> </span><span class="n">frame</span><span class="w"></span>
<span class="w">    </span><span class="n">to</span><span class="w"> </span><span class="n">Cable</span><span class="w"> </span><span class="n">Modem</span><span class="w">               </span><span class="n">from</span><span class="w"> </span><span class="n">Cable</span><span class="w"> </span><span class="n">Modem</span><span class="w"></span>
</pre></div>
</div>
<p>The encryption/decryption is a combination of CBC and CFB modes using either AES
or DES algorithms as specified in the DOCSIS Security Specification (from DPDK
lib_rtecryptodev perspective, these are RTE_CRYPTO_CIPHER_AES_DOCSISBPI and
RTE_CRYPTO_CIPHER_DES_DOCSISBPI).</p>
<p>The CRC is Ethernet CRC-32 as specified in Ethernet/[ISO/IEC 8802-3].</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The offset and length of data for which CRC needs to be computed are
specified via the auth offset and length fields of the rte_crypto_sym_op.</p></li>
<li><p>Other DOCSIS protocol functionality such as Header Checksum (HCS)
calculation may be added in the future.</p></li>
</ul>
</div>
</section>
<section id="macsec-protocol">
<h3><span class="section-number">26.1.6. </span>MACSEC Protocol</h3>
<p>Media Access Control security (MACsec) provides point-to-point security
on Ethernet links and is defined by IEEE standard 802.1AE.
MACsec secures an Ethernet link for almost all traffic,
including frames from the Link Layer Discovery Protocol (LLDP),
Link Aggregation Control Protocol (LACP),
Dynamic Host Configuration Protocol (DHCP),
Address Resolution Protocol (ARP),
and other protocols that are not typically secured on an Ethernet link
because of limitations with other security solutions.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">         </span><span class="n">Receive</span><span class="w">                                                </span><span class="n">Transmit</span><span class="w"></span>
<span class="w">         </span><span class="o">-------</span><span class="w">                                                </span><span class="o">--------</span><span class="w"></span>

<span class="w">     </span><span class="n">Ethernet</span><span class="w"> </span><span class="n">frame</span><span class="w">                                          </span><span class="n">Ethernet</span><span class="w"> </span><span class="n">frame</span><span class="w"></span>
<span class="w">      </span><span class="n">from</span><span class="w"> </span><span class="n">network</span><span class="w">                                           </span><span class="n">towards</span><span class="w"> </span><span class="n">network</span><span class="w"></span>
<span class="w">            </span><span class="o">|</span><span class="w">                                                      </span><span class="o">^</span><span class="w"></span>
<span class="w">            </span><span class="o">~</span><span class="w">                                                      </span><span class="o">|</span><span class="w"></span>
<span class="w">            </span><span class="o">|</span><span class="w">                                                      </span><span class="o">~</span><span class="w"></span>
<span class="w">            </span><span class="n">V</span><span class="w">                                                      </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+</span><span class="w">      </span><span class="o">+------------------+</span><span class="w">      </span><span class="o">+-------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Secure</span><span class="w"> </span><span class="n">Frame</span><span class="w"> </span><span class="n">Verify</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Cipher</span><span class="w"> </span><span class="n">Suite</span><span class="p">(</span><span class="n">SA</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Secure</span><span class="w"> </span><span class="n">Frame</span><span class="w"> </span><span class="n">Generation</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+&lt;-----+------------------+-----&gt;+-------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">SecTAG</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ICV</span><span class="w"> </span><span class="n">remove</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="n">SECY</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="n">SC</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">SecTAG</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ICV</span><span class="w"> </span><span class="n">Added</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="o">+---+-------------------+</span><span class="w">      </span><span class="o">+------------------+</span><span class="w">      </span><span class="o">+-------------------------+</span><span class="w"></span>
<span class="w">            </span><span class="o">|</span><span class="w">                                                      </span><span class="o">^</span><span class="w"></span>
<span class="w">            </span><span class="o">|</span><span class="w">                                                      </span><span class="o">|</span><span class="w"></span>
<span class="w">            </span><span class="n">V</span><span class="w">                                                      </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="n">Packet</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Core</span><span class="o">/</span><span class="n">App</span><span class="w">                                     </span><span class="n">Packet</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Core</span><span class="o">/</span><span class="n">App</span><span class="w"></span>
</pre></div>
</div>
<p>To configure MACsec on an inline NIC device or a lookaside crypto device,
a security association (SA) and a secure channel (SC) are created
before creating rte_security session.</p>
<p>SA is created using API <code class="docutils literal notranslate"><span class="pre">rte_security_macsec_sa_create</span></code>
which allows setting SA keys, salt, SSCI, packet number (PN) into the PMD,
and the API returns a handle which can be used to map it with a secure channel,
using the API <code class="docutils literal notranslate"><span class="pre">rte_security_macsec_sc_create</span></code>.
Same SAs can be used for multiple SCs.
The Rx SC will need a set of 4 SAs for each of the association numbers (AN).
For Tx SC a single SA is set which will be used by hardware to process the packet.</p>
<p>The API <code class="docutils literal notranslate"><span class="pre">rte_security_macsec_sc_create</span></code> returns a handle for SC,
and this handle is set in <code class="docutils literal notranslate"><span class="pre">rte_security_macsec_xform</span></code>
to create a MACsec session using <code class="docutils literal notranslate"><span class="pre">rte_security_session_create</span></code>.</p>
</section>
<section id="tls-record-protocol">
<h3><span class="section-number">26.1.7. </span>TLS-Record Protocol</h3>
<p>The Transport Layer Protocol provides communications security over the Internet.
The protocol allows client/server applications to communicate in a way
that is designed to prevent eavesdropping, tampering, or message forgery.</p>
<p>TLS protocol is composed of two layers: the TLS Record Protocol and the TLS Handshake Protocol.
At the lowest level, layered on top of some reliable transport protocol (e.g., TCP),
is the TLS Record Protocol.
The TLS Record Protocol provides connection security that has two basic properties:</p>
<blockquote>
<div><ul class="simple">
<li><p>The connection is private.
Symmetric cryptography is used for data encryption (e.g., AES, DES, etc.).
The keys for this symmetric encryption are generated uniquely
for each connection and are based on a secret negotiated during TLS Handshake Protocol.
The Record Protocol can also be used without encryption.</p></li>
<li><p>The connection is reliable.
Message transport includes a message integrity check using a keyed MAC.
Secure hash functions (e.g., SHA-1, etc.) are used for MAC computations.
The Record Protocol can operate without a MAC when it is being used as a transport
for negotiating security parameters by another protocol.</p></li>
</ul>
</div></blockquote>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">Record</span><span class="w"> </span><span class="n">Write</span><span class="w">                   </span><span class="n">Record</span><span class="w"> </span><span class="n">Read</span><span class="w"></span>
<span class="w">      </span><span class="o">------------</span><span class="w">                   </span><span class="o">-----------</span><span class="w"></span>

<span class="w">      </span><span class="n">TLSPlaintext</span><span class="w">                  </span><span class="n">TLSCiphertext</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w">           </span><span class="o">~</span><span class="w">                              </span><span class="o">~</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w">           </span><span class="n">V</span><span class="w">                              </span><span class="n">V</span><span class="w"></span>
<span class="o">+----------|-----------+</span><span class="w">       </span><span class="o">+----------|-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">no</span><span class="p">.</span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">no</span><span class="p">.</span><span class="o">|</span><span class="w"></span>
<span class="o">+----------|-----------+</span><span class="w">       </span><span class="o">+----------------------+</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                   </span><span class="o">|</span><span class="w">    </span><span class="n">AR</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="p">(</span><span class="n">DTLS</span><span class="p">)</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="o">+----------|-----------+</span><span class="w">       </span><span class="o">+----------|-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="n">Insert</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">header</span><span class="w">   </span><span class="o">|</span><span class="w">                  </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">     </span><span class="o">&amp;</span><span class="w"> </span><span class="n">trailer</span><span class="p">.</span><span class="w">       </span><span class="o">|</span><span class="w">       </span><span class="o">+----------|-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">including</span><span class="w"> </span><span class="n">padding</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">Decrypt</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">MAC</span><span class="w"> </span><span class="n">verify</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+----------|-----------+</span><span class="w">       </span><span class="o">+----------|-----------+</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w"> </span><span class="o">+---------|-----------+</span><span class="w">       </span><span class="o">+----------|-----------+</span><span class="w"></span>
<span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="n">MAC</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="o">&amp;</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="n">Remove</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">header</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="n">Encrypt</span><span class="w">        </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">      </span><span class="o">&amp;</span><span class="w"> </span><span class="n">trailer</span><span class="p">.</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="w"> </span><span class="o">+---------|-----------+</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">including</span><span class="w"> </span><span class="n">padding</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                   </span><span class="o">+----------|-----------+</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w">           </span><span class="o">~</span><span class="w">                              </span><span class="o">~</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w">                              </span><span class="o">|</span><span class="w"></span>
<span class="w">           </span><span class="n">V</span><span class="w">                              </span><span class="n">V</span><span class="w"></span>
<span class="w">     </span><span class="n">TLSCiphertext</span><span class="w">                  </span><span class="n">TLSPlaintext</span><span class="w"></span>
</pre></div>
</div>
<p>TLS and DTLS header formation (in record write operation)
would depend on type of content.
It is a per packet variable and would need to be handled by the same session.
Application may pass this info to a cryptodev performing lookaside protocol offload
by passing the same in <code class="docutils literal notranslate"><span class="pre">rte_crypto_op.param1</span></code>.</p>
<p>In record read operation, application is required to preserve any info
it may need from the TLS/DTLS header (such as content type and sequence number)
as the cryptodev would remove the header and padding
as part of the lookaside protocol processing.
With TLS 1.3, the actual content type is part of the trailer (before padding)
and would be stripped by the PMD.
For applications that may need this info,
PMD would return the value in <code class="docutils literal notranslate"><span class="pre">rte_crypto_op.param1</span></code> field.</p>
<section id="supported-versions">
<h4><span class="section-number">26.1.7.1. </span>Supported Versions</h4>
<ul class="simple">
<li><p>TLS 1.2</p></li>
<li><p>TLS 1.3</p></li>
<li><p>DTLS 1.2</p></li>
</ul>
</section>
</section>
</section>
<section id="device-features-and-capabilities">
<h2><span class="section-number">26.2. </span>Device Features and Capabilities</h2>
<section id="device-capabilities-for-security-operations">
<h3><span class="section-number">26.2.1. </span>Device Capabilities For Security Operations</h3>
<p>The device (crypto or ethernet) capabilities which support security operations,
are defined by the security action type, security protocol, protocol
capabilities and corresponding crypto capabilities for security. For the full
scope of the Security capability see definition of rte_security_capability
structure in the <em>DPDK API Reference</em>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_capability</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Each driver (crypto or ethernet) defines its own private array of capabilities
for the operations it supports. Below is an example of the capabilities for a
PMD which supports the IPsec and PDCP protocol.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_capability</span><span class="w"> </span><span class="n">pmd_security_capabilities</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* IPsec Lookaside Protocol offload ESP Tunnel Egress */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_IPSEC</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">ipsec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">proto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_IPSEC_SA_PROTO_ESP</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_IPSEC_SA_MODE_TUNNEL</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_IPSEC_SA_DIR_EGRESS</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* IPsec Lookaside Protocol offload ESP Tunnel Ingress */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_IPSEC</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">ipsec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">proto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_IPSEC_SA_PROTO_ESP</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_IPSEC_SA_MODE_TUNNEL</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_IPSEC_SA_DIR_INGRESS</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* PDCP Lookaside Protocol offload Data Plane */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_PDCP</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">pdcp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PDCP_MODE_DATA</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">capa_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* PDCP Lookaside Protocol offload Control */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_PDCP</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">pdcp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PDCP_MODE_CONTROL</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">capa_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* PDCP Lookaside Protocol offload short MAC-I */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_PDCP</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">pdcp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PDCP_MODE_SHORT_MAC</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">capa_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_NONE</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_cryptodev_capabilities</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w">    </span><span class="cm">/* SHA1 HMAC */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_OP_TYPE_SYMMETRIC</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">xform_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_SYM_XFORM_AUTH</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">algo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_AUTH_SHA1_HMAC</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">block_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">key_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                </span><span class="p">},</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">digest_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                </span><span class="p">},</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">aad_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">iv_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w">    </span><span class="cm">/* AES CBC */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_OP_TYPE_SYMMETRIC</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">xform_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_SYM_XFORM_CIPHER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">algo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_CIPHER_AES_CBC</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">block_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">key_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">                </span><span class="p">},</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">iv_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Below is an example of the capabilities for a PMD which supports the DOCSIS
protocol.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_capability</span><span class="w"> </span><span class="n">pmd_security_capabilities</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* DOCSIS Uplink */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_DOCSIS</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">docsis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_DOCSIS_UPLINK</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* DOCSIS Downlink */</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_DOCSIS</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">docsis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_DOCSIS_DOWNLINK</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_NONE</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_cryptodev_capabilities</span><span class="w"> </span><span class="n">pmd_capabilities</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w">    </span><span class="cm">/* AES DOCSIS BPI */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_OP_TYPE_SYMMETRIC</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">xform_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_SYM_XFORM_CIPHER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">algo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_CRYPTO_CIPHER_AES_DOCSISBPI</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">block_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">key_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
<span class="w">                </span><span class="p">},</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">iv_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>

<span class="w">    </span><span class="n">RTE_CRYPTODEV_END_OF_CAPABILITIES_LIST</span><span class="p">()</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>Below is the example PMD capability for MACsec</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_capability</span><span class="w"> </span><span class="n">pmd_security_capabilities</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_ACTION_TYPE_INLINE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_PROTOCOL_MACSEC</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">macsec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">mtu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">alg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RTE_SECURITY_MACSEC_ALG_GCM_128</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max_nb_sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max_nb_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">max_nb_sess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">replay_win_sz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">relative_sectag_insert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">fixed_sectag_insert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">icv_include_da_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">ctrl_port_enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">preserve_sectag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">preserve_icv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">validate_frames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">re_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">anti_replay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">crypto_capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="capabilities-discovery">
<h3><span class="section-number">26.2.2. </span>Capabilities Discovery</h3>
<p>Discovering the features and capabilities of a driver (crypto/ethernet)
is achieved through the <code class="docutils literal notranslate"><span class="pre">rte_security_capabilities_get()</span></code> function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_capability</span><span class="w"> </span><span class="o">*</span><span class="n">rte_security_capabilities_get</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>This allows the user to query a specific driver and get all device
security capabilities. It returns an array of <code class="docutils literal notranslate"><span class="pre">rte_security_capability</span></code> structures
which contains all the capabilities for that device.</p>
</section>
<section id="security-session-create-free">
<h3><span class="section-number">26.2.3. </span>Security Session Create/Free</h3>
<p>Security Sessions are created to store the immutable fields of a particular Security
Association for a particular protocol which is defined by a security session
configuration structure which is used in the operation processing of a packet flow.
Sessions are used to manage protocol specific information as well as crypto parameters.
Security sessions cache this immutable data in a optimal way for the underlying PMD
and this allows further acceleration of the offload of Crypto workloads.</p>
<p>The Security framework provides APIs to create and free sessions for crypto/ethernet
devices, where sessions are mempool objects. It is the application’s responsibility
to create and manage two session mempools - one for session and other for session
private data. The private session data mempool object size should be able to
accommodate the driver’s private data of security session. The application can get
the size of session private data using API <code class="docutils literal notranslate"><span class="pre">rte_security_session_get_size</span></code>.
And the session mempool object size should be enough to accommodate
<code class="docutils literal notranslate"><span class="pre">rte_security_session</span></code>.</p>
<p>Once the session mempools have been created, <code class="docutils literal notranslate"><span class="pre">rte_security_session_create()</span></code>
is used to allocate and initialize a session for the required crypto/ethernet device.</p>
<p>Session APIs need an opaque handle to identify the crypto/ethernet
security ops. This parameter can be retrieved using the APIs
<code class="docutils literal notranslate"><span class="pre">rte_cryptodev_get_sec_ctx()</span></code> (for crypto device) or <code class="docutils literal notranslate"><span class="pre">rte_eth_dev_get_sec_ctx</span></code>
(for ethernet port).</p>
<p>Sessions already created can be updated with <code class="docutils literal notranslate"><span class="pre">rte_security_session_update()</span></code>.</p>
<p>When a session is no longer used, the user must call <code class="docutils literal notranslate"><span class="pre">rte_security_session_destroy()</span></code>
to free the driver private session data and return the memory back to the mempool.</p>
<p>For look aside protocol offload to hardware crypto device, the <code class="docutils literal notranslate"><span class="pre">rte_crypto_op</span></code>
created by the application is attached to the security session by the API
<code class="docutils literal notranslate"><span class="pre">rte_security_attach_session()</span></code>.</p>
<p>For Inline Crypto and Inline protocol offload, device specific defined metadata is
updated in the mbuf using <code class="docutils literal notranslate"><span class="pre">rte_security_set_pkt_metadata()</span></code> if
<code class="docutils literal notranslate"><span class="pre">RTE_ETH_TX_OFFLOAD_SEC_NEED_MDATA</span></code> is set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case of inline processed packets, <code class="docutils literal notranslate"><span class="pre">RTE_SECURITY_DYNFIELD_NAME</span></code> field
would be used by the driver to relay information on the security processing
associated with the packet. In ingress, the driver would set this in Rx
path while in egress, <code class="docutils literal notranslate"><span class="pre">rte_security_set_pkt_metadata()</span></code> would perform a
similar operation. The application is expected not to modify the field
when it has relevant info. For ingress, this device-specific 64 bit value
is required to derive other information (like userdata), required for
identifying the security processing done on the packet.</p>
</div>
</section>
<section id="security-session-configuration">
<h3><span class="section-number">26.2.4. </span>Security session configuration</h3>
<p>Security Session configuration structure is defined as <code class="docutils literal notranslate"><span class="pre">rte_security_session_conf</span></code></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_session_conf</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">enum</span><span class="w"> </span><span class="n">rte_security_session_action_type</span><span class="w"> </span><span class="n">action_type</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Type of action to be performed on the session */</span><span class="w"></span>
<span class="w">	</span><span class="k">enum</span><span class="w"> </span><span class="n">rte_security_session_protocol</span><span class="w"> </span><span class="n">protocol</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Security protocol to be configured */</span><span class="w"></span>
<span class="w">	</span><span class="k">union</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_ipsec_xform</span><span class="w"> </span><span class="n">ipsec</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_macsec_xform</span><span class="w"> </span><span class="n">macsec</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_pdcp_xform</span><span class="w"> </span><span class="n">pdcp</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_docsis_xform</span><span class="w"> </span><span class="n">docsis</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_security_tls_record_xform</span><span class="w"> </span><span class="n">tls_record</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">};</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Configuration parameters for security session */</span><span class="w"></span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">rte_crypto_sym_xform</span><span class="w"> </span><span class="o">*</span><span class="n">crypto_xform</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Security Session Crypto Transformations. NULL in case of MACsec. */</span><span class="w"></span>
<span class="w">	</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">userdata</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Application specific userdata to be saved with session */</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The configuration structure reuses the <code class="docutils literal notranslate"><span class="pre">rte_crypto_sym_xform</span></code> struct for crypto related
configuration. The <code class="docutils literal notranslate"><span class="pre">rte_security_session_action_type</span></code> struct is used to specify whether the
session is configured for Lookaside Protocol offload or Inline Crypto or Inline Protocol
Offload.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">rte_security_session_action_type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_ACTION_TYPE_NONE</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; No security actions */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_ACTION_TYPE_INLINE_CRYPTO</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Crypto processing for security protocol is processed inline</span>
<span class="cm">	 * during transmission</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_ACTION_TYPE_INLINE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; All security protocol processing is performed inline during</span>
<span class="cm">	 * transmission</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_ACTION_TYPE_LOOKASIDE_PROTOCOL</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; All security protocol processing including crypto is performed</span>
<span class="cm">	 * on a lookaside accelerator</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_ACTION_TYPE_CPU_CRYPTO</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; Similar to ACTION_TYPE_NONE but crypto processing for security</span>
<span class="cm">	 * protocol is processed synchronously by a CPU.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rte_security_session_protocol</span></code> is defined as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">rte_security_session_protocol</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_PROTOCOL_IPSEC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; IPsec Protocol */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_PROTOCOL_MACSEC</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; MACSec Protocol */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_PROTOCOL_PDCP</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; PDCP Protocol */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_PROTOCOL_DOCSIS</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; DOCSIS Protocol */</span><span class="w"></span>
<span class="w">	</span><span class="n">RTE_SECURITY_PROTOCOL_TLS_RECORD</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**&lt; TLS Record Protocol */</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>IPsec related configuration parameters are defined in <code class="docutils literal notranslate"><span class="pre">rte_security_ipsec_xform</span></code></p>
<p>MACsec related configuration parameters are defined in <code class="docutils literal notranslate"><span class="pre">rte_security_macsec_xform</span></code></p>
<p>PDCP related configuration parameters are defined in <code class="docutils literal notranslate"><span class="pre">rte_security_pdcp_xform</span></code></p>
<p>DOCSIS related configuration parameters are defined in <code class="docutils literal notranslate"><span class="pre">rte_security_docsis_xform</span></code></p>
<p>TLS record related configuration parameters are defined in <code class="docutils literal notranslate"><span class="pre">rte_security_tls_record_xform</span></code></p>
</section>
<section id="security-api">
<h3><span class="section-number">26.2.5. </span>Security API</h3>
<p>The rte_security Library API is described in the <em>DPDK API Reference</em> document.</p>
</section>
<section id="flow-based-security-session">
<h3><span class="section-number">26.2.6. </span>Flow based Security Session</h3>
<p>In the case of NIC based offloads, the security session specified in the
‘rte_flow_action_security’ must be created on the same port as the
flow action that is being specified.</p>
<p>The ingress/egress flow attribute should match that specified in the security
session if the security session supports the definition of the direction.</p>
<p>Multiple flows can be configured to use the same security session. For
example if the security session specifies an egress IPsec/MACsec SA, then multiple
flows can be specified to that SA. In the case of an ingress IPsec SA then
it is only valid to have a single flow to map to that security session.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> Configuration Path</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|    Add/Remove   |</span>
<span class="go">| IPsec/MACsec SA |   &lt;------ Build security flow action of</span>
<span class="go">|        |        |           IPsec/MACsec transform</span>
<span class="go">|--------|--------|</span>
<span class="go">         |</span>
<span class="go">+--------V--------+</span>
<span class="go">|   Flow API      |</span>
<span class="go">+--------|--------+</span>
<span class="go">         |</span>
<span class="go">+--------V--------+</span>
<span class="go">|                 |</span>
<span class="go">|     NIC PMD     |   &lt;------ Add/Remove SA to/from hw context</span>
<span class="go">|                 |</span>
<span class="go">+--------|--------+</span>
<span class="go">         |</span>
<span class="go">+--------|--------+</span>
<span class="go">|  HW ACCELERATED |</span>
<span class="go">|        NIC      |</span>
<span class="go">|                 |</span>
<span class="go">+--------|--------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Add/Delete IPsec SA flow:
To add a new inline SA construct a rte_flow_item for Ethernet + IP + ESP
using the SA selectors and the <code class="docutils literal notranslate"><span class="pre">rte_security_ipsec_xform</span></code> as the <code class="docutils literal notranslate"><span class="pre">rte_flow_action</span></code>.
Note that any rte_flow_items may be empty, which means it is not checked.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In its most basic form, IPsec flow specification is as follows:</span>
<span class="go">    +-------+     +----------+    +--------+    +-----+</span>
<span class="go">    |  Eth  | -&gt;  |   IP4/6  | -&gt; |   ESP  | -&gt; | END |</span>
<span class="go">    +-------+     +----------+    +--------+    +-----+</span>

<span class="go">However, the API can represent, IPsec crypto offload with any encapsulation:</span>
<span class="go">    +-------+            +--------+    +-----+</span>
<span class="go">    |  Eth  | -&gt;  ... -&gt; |   ESP  | -&gt; | END |</span>
<span class="go">    +-------+            +--------+    +-----+</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Add/Delete MACsec SA flow:
To add a new inline SA construct a rte_flow_item for Ethernet + SecTAG
using the SA selectors and the <code class="docutils literal notranslate"><span class="pre">rte_security_macsec_xform</span></code> as the <code class="docutils literal notranslate"><span class="pre">rte_flow_action</span></code>.
Note that any rte_flow_items may be empty, which means it is not checked.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In its most basic form, MACsec flow specification is as follows:</span>
<span class="go">    +-------+     +----------+     +-----+</span>
<span class="go">    |  Eth  | -&gt;  |  SecTag  |  -&gt; | END |</span>
<span class="go">    +-------+     +----------+     +-----+</span>

<span class="go">However, the API can represent, MACsec offload with any encapsulation:</span>
<span class="go">    +-------+            +--------+    +-----+</span>
<span class="go">    |  Eth  | -&gt;  ... -&gt; | SecTag | -&gt; | END |</span>
<span class="go">    +-------+            +--------+    +-----+</span>
</pre></div>
</div>
</section>
</section>
<section id="telemetry-support">
<h2><span class="section-number">26.3. </span>Telemetry support</h2>
<p>The Security library has support for displaying Crypto device information
with respect to its Security capabilities. Telemetry commands that can be used
are shown below.</p>
<ol class="arabic">
<li><p>Get the list of available Crypto devices by ID, that supports Security features:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--&gt; /security/cryptodev/list
{&quot;/security/cryptodev/list&quot;: [0, 1, 2, 3]}
</pre></div>
</div>
</li>
<li><p>Get the security capabilities of a Crypto device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--&gt; /security/cryptodev/sec_caps,0
    {&quot;/security/cryptodev/sec_caps&quot;: {&quot;sec_caps&quot;: [&lt;array of serialized bytes of
    capabilities&gt;], &quot;sec_caps_n&quot;: &lt;number of capabilities&gt;}}
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><ol class="arabic">
<li><p>Get the security crypto capabilities of a Crypto device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--&gt; /security/cryptodev/crypto_caps,0,0
    {&quot;/security/cryptodev/crypto_caps&quot;: {&quot;crypto_caps&quot;: [&lt;array of serialized bytes of
    capabilities&gt;], &quot;crypto_caps_n&quot;: &lt;number of capabilities&gt;}}
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>For more information on how to use the Telemetry interface, see
the <a class="reference internal" href="../howto/telemetry.html"><span class="doc">DPDK Telemetry User Guide</span></a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DPDK_logo_vertical_rev_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Data Plane Development Kit</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mldevs/index.html">Machine Learning Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmadevs/index.html">DMA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpus/index.html">General-Purpose Graphics Processing Unit Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Programmer’s Guide</a><ul>
      <li>Previous: <a href="gpudev.html" title="previous chapter"><span class="section-number">25. </span>General-Purpose Graphics Processing Unit Library</a></li>
      <li>Next: <a href="rawdev.html" title="next chapter"><span class="section-number">27. </span>Rawdevice Library</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/prog_guide/rte_security.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>